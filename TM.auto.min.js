Object.assign(MineTm,{appNameShort:"🚁",appNameLong:"Peppercore",basicTypingMindDisplayNameAlias:"App",sessionStorageMaybeActiveTaskId:"mine_active_task_id",isBeingScrolled:!1,Experiments:{FEAT_EAVESDROPPER_TTS:!0},getIsInPersonalEnvironment:()=>"personal"===Mine?.Environment?.Profile?.name,reloadCurrentChatFromIdbeAsync:async()=>{if(!MineTm.getCurrentChatId())return!1;const e=await MineTm.hideSidebarTemporarilyAsync();return Mine.qs('[data-element-id="workspace-tab-settings"]').click(),await Mine.getAnimationFrameAsync(),Mine.qs('[data-element-id="workspace-tab-chat"]').click(),await Mine.getAnimationFrameAsync(),(await MineTm.getSidebarToggleEleAsync()).click(),e(),!0},setWallpaperAsync:(()=>{let e=null;return async(t,{backgroundSizePercentInt:n=null,opacityPercentInt:a=30,transitionMs:o=800,enableTransition:i=!0,qualityPercentInt:s=85,isGrayscale:r=!1,blurPxInt:c=0,verticalOffsetPxInt:l=0,addCenteredDarkGradient:d=!0}={})=>{const m="mine_wallpaper_cache_json",p=localStorage.getItem(m);if(p){const{url:e,rawDataUrl:n}=JSON.parse(p);if(e===t)return void await g(n)}const u=await function(e,t){return new Promise((n,a)=>{const o=new Image,i=e.startsWith("blob:");i||(o.crossOrigin="anonymous"),o.onload=()=>{const a=document.createElement("canvas"),i=a.getContext("2d");a.width=o.width,a.height=o.height,i.drawImage(o,0,0);const s=a.toDataURL("image/webp",.95);try{localStorage.setItem(t,JSON.stringify({url:e,rawDataUrl:s,timestamp:Date.now()}))}catch(e){}n(s)},o.onerror=()=>a(new Error(`Failed to load: ${e}`)),o.src=i?e:`https://proxy-mine.fly.dev/?url=${encodeURIComponent(e)}`})}(t,m);function g(t){return new Promise((m,p)=>{const u=document.createElement("canvas"),g=u.getContext("2d"),h=new Image;h.onload=()=>{u.width=h.width,u.height=h.height;const t=[];c>0&&t.push(`blur(${c}px)`),r&&t.push("grayscale(100%)"),t.length>0&&(g.filter=t.join(" ")),g.globalAlpha=a/100,g.drawImage(h,0,0);const p=u.toDataURL("image/webp",s/100);e&&e(),e=Mine.isi(Mine.normalizeSpaceIndents(`\n              #nav-handler {\n                background: #000 url("${p}") repeat !important;\n                background-origin: padding-box !important;\n                background-clip: padding-box !important;\n                ${null!==n?`background-size: ${n}% !important;`:""}\n                background-position: center ${-l}px !important;\n                position: relative !important;\n                ${i?`transition: all ${o}ms cubic-bezier(0.4, 0, 0.2, 1) !important;`:""}\n              }\n\n              ${d?`\n              #nav-handler::before {\n                content: '';\n                position: absolute;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                background: ${MineTm.isMobile?"rgba(0, 0, 0, 0.5)":"linear-gradient(\n                      90deg,\n                      transparent 0%,\n                      transparent 10%,\n                      rgba(0, 0, 0, 0.25) 20%,\n                      rgba(0, 0, 0, 0.5) 25%,\n                      rgba(0, 0, 0, 0.5) 75%,\n                      rgba(0, 0, 0, 0.25) 80%,\n                      transparent 90%,\n                      transparent 100%)"};\n                pointer-events: none;\n                z-index: 0;\n              }`:""}\n            `)),setTimeout(m,i?o:0)},h.onerror=()=>p(new Error("Failed to process image")),h.src=t})}await g(u)}})(),isRegenInProgress:!1,regenLastResponseAsync:async()=>{if(MineTm.getIsAiResponding()&&await stopAiResponseAsync(),MineTm.isRegenInProgress)return;MineTm.isRegenInProgress=!0;const e=Mine.qsaa('[class*="message-index-"]:has([data-element-id="user-message"])').at(-1);if(!e)return;const t=Mine.isi('[data-element-id="scroll-padding"] {height:1000px;}');MineTm.scrollToMsgWithClearanceAsyncWIP(e);const n=Mine.qsaa('[class*="message-index-"]').reverse(),a=n.findIndex(e=>e.querySelector('[data-element-id="user-message"]'));n.slice(0,a).forEach(e=>{const t=e.querySelector('[data-element-id="ai-response"]');t&&(t.style.opacity=0)}),await Mine.sleep(500);const o=(await MineTm.getCurrentChatIdbMetaAsync()).idbe,i=o.messages.findLastIndex(e=>"user"===e.role),s=(i>=0?o.messages.slice(i+1):[]).some(e=>"tool"===e.role);s&&await MineTm.setPluginsStateAsync(!0);const r=Mine.qs('[data-element-id="regenerate-button"]');r?.click(),await Mine.sleep(500),t(),await MineTm.scrollToMsgWithClearanceAsyncWIP(e),s&&await MineTm.setPluginsStateAsync(!1),MineTm.isRegenInProgress=!1},getCurrentTargetChatModelFromUi:()=>{let e=Mine.qs('[data-element-id="current-character"]')?.innerText.split("\n")[0]||Mine.qs('.pb-1 button[aria-haspopup="menu"] .truncate')?.innerText?.split(" ")[0]||"";return e.endsWith(":")&&(e=e.substring(0,e.length-1)),e},ChatDecompressionsManager:{generateUniqueRefId(e){if(!window.crypto||!window.crypto.getRandomValues)throw alert("Secure random number generation not supported in this browser"),new Error("Crypto API not supported");let t,n=0;do{const e=new Uint8Array(6);if(window.crypto.getRandomValues(e),t=btoa(String.fromCharCode.apply(null,e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"").substring(0,8),n++,n>1&&Mine.toastWarning("hashing algorithm collided. might wanna increase hash size"),n>=10){Mine.toastError("couldnt get a unique ref. might overwrite.");break}}while(e?.Mine?.transcriptSegments&&t in e.Mine.transcriptSegments);return t},async storeTranscriptFragmentViaMutation(e,t){e.Mine||(e.Mine={}),e.Mine.transcriptSegments||(e.Mine.transcriptSegments={});const n=this.generateUniqueRefId(e);return e.Mine.transcriptSegments[n]={data:t,timestampMs:Date.now()},n},async getContextAsync(e){if(!e)return null;const{idbe:t}=await MineTm.getCurrentChatIdbMetaAsync(),n=t?.Mine?.transcriptSegments?.[e];return n?.data||null}},getCompressOlderMessagesReadonlyPreworkDataAsync:async e=>{const t=Math.max(1,.4*e.messages.length),n=e.messages.findIndex((e,n)=>n>=t&&"user"===e.role),a=e.messages.findIndex(e=>"user"===e.role&&!MineTm.getIdbeMessageObjText(e)?.includes("#compression-level-2"));return{tailStartIdx:n,anticipatedCompressionCount:n>0?n-a:0,firstNonCompressionLvl2UserMsgIdx:a}},compressOlderMessages:async e=>{if(!sessionStorage[MineTm.sessionStorageMaybeActiveTaskId]){const{idbe:e}=await MineTm.getCurrentChatIdbMetaAsync(),{tailStartIdx:t}=await MineTm.getCompressOlderMessagesReadonlyPreworkDataAsync(e),n=e.messages.splice(t);return sessionStorage.setItem(MineTm.sessionStorageMaybeActiveTaskId,"compressOlderMsgsFinal"),e.Mine=e.Mine||{},e.Mine.tailMsgs=n,await MineTm.setChatIndexedDbValueAsync(e),void window.location.reload()}const{idbe:t}=await MineTm.getCurrentChatIdbMetaAsync(),n=t.messages.findIndex(e=>"user"===e.role&&!MineTm.getIdbeMessageObjText(e).includes("#compression-level-2")),a=t.messages.length,o=t.messages.slice(n),i=o.length;e?.setStatus("getting summary");const s=await MineTm.getDetailedSummarizationViaPrompt(async()=>{if(await(e?.getShouldInterruptAsync()))throw"User interrupted"},{startMsgIdx:n,maybeCbConfig:e}),{idbe:r}=await MineTm.getCurrentChatIdbMetaAsync(),c=await MineTm.ChatDecompressionsManager.storeTranscriptFragmentViaMutation(r,o);MineTm.setIdbeMessageObjText(r.messages[a],MineTm.getCompressionSummaryPromptBlock(i,{uncompressedChatsRefId:c,compressionLevel:2})),MineTm.setIdbeMessageObjText(r.messages[a+1],s),r.messages.splice(n,i),r.messages.splice(n+2),r.messages.push(...r.Mine.tailMsgs),delete r.Mine.tailMsgs,await MineTm.setChatIndexedDbValueAsync(r),sessionStorage.removeItem(MineTm.sessionStorageMaybeActiveTaskId),console.log("estimated point to start the date reset",n),e?.setStatus("updating meta timestamps"),await MineTm.mutateCurrentIdbe(async e=>{const t=n,a=t?e.messages[t-1]:{createdAt:new Date("jan 1 2000"),updatedAt:new Date("jan 1 2000")};e.messages[t].createdAt=a.createdAt,e.messages[t].updatedAt=a.updatedAt,e.messages[t+1].createdAt=a.createdAt,e.messages[t+1].updatedAt=a.updatedAt}),e?.setStatus("reloading"),window.location.reload()},sectionRedactionCompletePrefix:'"""🗜️ Previous conversation compressed\n',getCompressionSummaryPromptBlock:(e,{forkedChatId:t="",uncompressedChatsRefId:n="",compressionLevel:a=0}={})=>`${MineTm.sectionRedactionCompletePrefix}${e} msg${1===e?"":"s"} were deleted and replaced with your summary below on ${((e=new Date)=>{const t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][e.getDay()],n=e.getMonth()+1,a=e.getDate(),o=e.getFullYear().toString().slice(-2);let i=e.getHours();const s=i>=12?"pm":"am";return i=i%12||12,`${t} ${n}/${a}/${o} ${i}:${e.getMinutes().toString().padStart(2,"0")}${s}`})()}.${n?`\nUncompressed chat stored with ID \`${n}\`.`:""}${t?`\nOriginal chat archived with ID \`${t}\`.`:""}\n#compression-level-${a}\n"""`,getContextAboutTopic:async(e=[])=>{const t=e.map(e=>e.toLowerCase()),n=await(async()=>{const e="keyval";return new Promise((n,a)=>{const o=indexedDB.open("keyval-store");o.onerror=e=>a(`IndexedDB error: ${e.target.error}`),o.onsuccess=o=>{const i=o.target.result,s=i.transaction([e],"readonly").objectStore(e).openCursor();s.onerror=e=>a(`Cursor error: ${e.target.error}`),s.onsuccess=e=>{const a=e.target.result;if(!a)return i.close(),void n(void 0);const o=a.key,s=a.value;if("string"==typeof o&&o.startsWith("CHAT_")){const e=((e,n)=>{if(Array.isArray(n.messages))for(const a of n.messages)if("user"===a.role&&Array.isArray(a.content)){const n=a.content.find(e=>"tm_text_file"===e.type&&t.every(t=>e.metadata.name.toLowerCase().includes(t)));if(n)return{id:e,messageCreatedAt:a.createdAt,attachment:n}}})(o,s);if(void 0!==e)return i.close(),void n(e)}a.continue()}}})})();return n?{chatId:id,attachment:n?.attachment,createdAt:n?.messageCreatedAt}:null},getIdbeMessageObjText:e=>{const t=e?.content;if(!t)return null;if("string"==typeof t)return t;if(Array.isArray(t)){const e=t.find(e=>"text"===e.type);if(e&&"text"in e){const t=e.text;if("string"!=typeof t)throw"unexpected text value";return t}return null}return t},setIdbeMessageObjText:(e,t)=>{const{content:n}=e;if("string"!=typeof n){if(Array.isArray(n)){const e=n.find(e=>"text"===e.type);if("text"in e)return void(e.text=t)}throw"Unable to set text: unknown idbe content structure"}e.content=t},generateBlock:(e,t)=>`"""${e}\n${t}\n"""`,getHumanizedTimeLabel:(e=new Date)=>{const t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][e.getDay()],n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()],a=e.getDate(),o=e.getHours();return`${t} ${n} ${a}, ${0===o?12:o>12?o-12:o}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}${o>=12?"pm":"am"}`},downloadAndGoToBufferedChatAsync:async()=>{const e=await MineTm.getMinePluginBasedSecretAsync("tmChatBufferPassword");if(!e)return Mine.toastWarning("Buffer password not found");const t=await fetch("https://pepperpotts.fly.dev/tm/download-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:e})});let n;try{n=await t.json()}catch(e){n={isSuccess:!1}}if(t.ok){if(!n.isSuccess)return Mine.toastError(`[fail] ${n.message}`);{const e=JSON.parse(n.chat),t=e.chatID,a=await MineTm.getChatIndexedDbValueAsync(t);if(a){const n=a.messages?.length,o=e.messages?.length;if(n<o&&a.messages?.every((t,n)=>JSON.stringify(t)===JSON.stringify(e.messages[n])));else{const i=a.messages?.find((t,n)=>JSON.stringify(t)===JSON.stringify(e.messages[n]));if(!confirm([`Overwrite existing chat '${t}' (${n} msgs) with new (${o})?`,"",`* (${o>n?"":"not "}recommended)`,`* differs starting with "${i?.content?.slice(0,100)}..."`].join("\n")))return}}await MineTm.setChatIndexedDbValueAsyncLegacy(t,e).catch(e=>alert("error saving buffer")),window.location.href=`${window.location.origin}${window.location.pathname}#chat=${t}`,window.location.reload()}}else n.message&&alert("[fail] "+n.message)},goToLastRecentChatAsync:async()=>{const e=await(async()=>{let e=null,t=0;return(async(e,t="keyval-store",n="keyval")=>new Promise((a,o)=>{const i=indexedDB.open(t);i.onerror=e=>o(`IndexedDB error: ${e.target.error}`),i.onsuccess=t=>{const i=t.target.result.transaction([n],"readonly").objectStore(n).openCursor();i.onerror=e=>o(`Cursor error: ${e.target.error}`),i.onsuccess=t=>{const n=t.target.result;return n?e(n.value,n.key)?a(n.value):void n.continue():a(null)}}}))((n,a)=>{if(a.startsWith("CHAT_")&&n?.messages?.length){const a=n.messages[n.messages.length-1];if(!a)return;const o=new Date(a.createdAt).getTime();o>t&&(t=o,e=n)}return null}).then(()=>e)})();if(!e)return Mine.toastWarning("No latest chat found");if(MineTm.isMobile)return void MineTm.goToChatIdWithHardReload(e.chatID);Mine.dim(document.body);const t=new URL(window.location);t.search="",t.hash=`#chat=${e.chatID}`,window.history.replaceState({},"",t.toString()),await Mine.getAnimationFrameAsync(),window.location.reload()},mutateCurrentIdbe:async(e=Mine.noop,{autoReloadPage:t=!0}={})=>{if(!MineTm.getCurrentChatId())throw"cant find current chat session";const{idbe:n}=await MineTm.getCurrentChatIdbMetaAsync();await e(n),await MineTm.setChatIndexedDbValueAsyncLegacy(n.chatID,n),t&&window.location.reload()},activateGuestMode:()=>{Mine.hideQs("#navbar"),Mine.hideQs(".hide-when-print"),Mine.hideQs('[placeholder="Search"]'),Mine.isi("#chat-input-textbox {border: 1px solid lightpink;}")},favoriteCurrentChatAsync:async(e=!0)=>{const t=(await MineTm.getCurrentChatIdbMetaAsync()).idbe;return!(!e||!t.favoritedAt)||!e&&!t.favoritedAt||(e?t.favoritedAt=(new Date).toISOString():delete t.favoritedAt,await MineTm.setChatIndexedDbValueAsyncLegacy(MineTm.getCurrentChatId(),t),!0)},startChatWithAgentFromHomeAsync:async e=>{(await MineTm.Mine.waitFor(()=>MineTm.Mine.qsaa("div:has(>button)").find(t=>t.innerText.toLowerCase()===e.toLowerCase()))).click(),await MineTm.Mine.waitForQs('[data-element-id="current-character"]')},getAnimationFrameAsync:async()=>new Promise(e=>requestAnimationFrame(e)),getMinePluginBasedSecretAsync:(()=>{let e=null,t=new Set;return async(n,a=!1)=>{if(!n)return;if(!a&&t.has(n))return;if(!e||a){const n=localStorage.TM_useUserPluginSettings;let o={};try{o=JSON.parse(n)}catch(e){}e=o?.["f589de3c-1b19-4a43-acf7-ebc0d3c8c66c"]||o?.mineSecrets||{},//! todo: should be in mineSecrets but TM fucks it up and puts it in weird places now?
a&&t.clear()}const o=e[n];return void 0===o&&t.add(n),o}})(),setPluginsStateAsync:async(e=!0,{desiredMaybePluginNames:t=["Personal Finance","Search Google","Multi Web Search","Text Me","[ENABLED]","Scrape website"]}={})=>{const n=await Mine.waitForQs('button:has([d="M10.75 1H14.25C15.767 1 17 2.233 17 3.75V7.25C17 7.664 16.664 8 16.25 8H10.75C10.336 8 10 7.664 10 7.25V1.75C10 1.336 10.336 1 10.75 1Z"]), button:has([data-element="enabled-plugins-indicator"])');console.log("setPluginsStateAsync start",e),Mine.simulateClick(n),await Mine.waitForQs('[id="headlessui-portal-root"] [role="menu"]');const a='[id="headlessui-portal-root"] [role="menuitem"]';await Mine.waitFor(()=>Mine.qs(a)?.innerText.trim().length),await MineTm.getAnimationFrameAsync();const o=Mine.qsaa(a),i=o[0]?.closest("[role=menu]");i&&(i.style.display="none"),o.filter(e=>t.some(t=>e.innerText.toLowerCase().includes(t.toLowerCase()))).forEach(t=>{const n=t.querySelector("button"),a="true"===n.getAttribute("aria-checked")?.toLowerCase();(a&&!e||!a&&e)&&n.click()}),await MineTm.getAnimationFrameAsync(),Mine.simulateClick(n),await MineTm.getAnimationFrameAsync(),console.log("setPluginsStateAsync done",e)},getChatIndexedDbValueAsync:async e=>await Mine.getIndexedDbValue(`CHAT_${e}`,"keyval-store","keyval"),setChatIndexedDbValueAsyncLegacy:async(e,t)=>await Mine.setIndexedDbValue(`CHAT_${e}`,t,"keyval-store","keyval"),setChatIndexedDbValueAsync:async e=>{if(!e.chatID)throw"chatid does not exist";return await Mine.setIndexedDbValue(`CHAT_${e.chatID}`,e,"keyval-store","keyval")},deleteChatIndexedDbValueAsync:async e=>await Mine.deleteIndexedDbValueAsync(`CHAT_${e}`,"keyval-store","keyval"),getCurrentChatId:()=>{const e=window.location.hash.match(/chat=([^&]+)/);return e?e[1]:null},sendMessageAsync:async(e,{append:t=!1,enablePlugins:n=!1,returnAiResponse:a=!1,sendOnlyAndPreventResponse:o=!1,attachment:i={text:"",filename:""}}={})=>{MineTm.getIsAiResponding()&&await MineTm.maybeClickStopButtonAsync();const s=await MineTm.getTaAsync(),r=s.value,c=s.value.trimEnd();let l=c;!!s.closest(".editing")||(l=t?`${c?`${c}\n\n`:""}${e}`:e),i?.text&&(await MineTm.simulateAddFileAttachment(i.text,i.filename),await Mine.getAnimationFrameAsync());const d=!s.value.trim();d&&s.classList.toggle("invisible-text",!0),Mine.updateReactTypableFormValue(s,l),d&&!MineTm.isMobile&&s.style.setProperty("height","51px","important");let m=0;if(a){const e=await MineTm.getCurrentChatIdbMetaAsync();if(e){const t=e.idbe;m=t?t.messages.length:0}}if(n?await MineTm.clickTaMaybeSubmitButtonWithPluginsEnabledEphemerallyAsync():(await MineTm.getSendButtonAsync()).click(),d&&(async()=>{await Mine.waitFor(()=>s.value!==l,{recheckIntervalMs:100}),s.classList.toggle("invisible-text",!1)})().then(),await Mine.waitFor(()=>MineTm.getCurrentChatId()),await Mine.waitFor(async()=>(await MineTm.getCurrentChatIdbMetaAsync()).idbe,{timeoutMs:1e4}),o&&(await Mine.waitFor(()=>MineTm.getStopButton()),await MineTm.maybeClickStopButtonAsync()),r&&!t&&Mine.updateReactTypableFormValue(s,r),a){await MineTm.waitForCompletedMsgCountAsync(m+2,3e5),await Mine.waitFor(()=>!MineTm.getIsAiResponding());const e=(await MineTm.getCurrentChatIdbMetaAsync()).idbe.messages.slice(-1)[0];return MineTm.getIdbeMessageObjText(e)}},getSendButtonAsync:async()=>await Mine.waitForQs('[data-element-id="send-button"]',{timeoutMs:3e4}),waitForCompletedMsgCountAsync:(e,t=2e4)=>Promise.race([new Promise(t=>{const n=a=>{a.detail.numMsgs>=e&&(document.removeEventListener("numMsgsInChatChanged",n),t(a.detail))};document.addEventListener("numMsgsInChatChanged",n)}),new Promise((e,n)=>setTimeout(()=>n(new Error("Timeout")),t))]),getAllChatMsgEles:()=>Mine.qsaa('[data-element-id="ai-response"],[data-element-id="user-message"]'),getIsAiResponding:()=>!!Mine.qs('[data-element-id="streaming-block"]')||!!MineTm.getStopButton(),getTaAsync:async(e={})=>await Mine.waitForQs("#chat-input-textbox",e),getStopButton:()=>Mine.qsaa('[data-element-id="chat-space-end-part"] button').find(e=>"Stop"===e.innerText||e.innerText.startsWith("Stop\n")),isEventModifierFree:e=>!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey),maybeClickStopButtonAsync:async()=>{const e=MineTm.getStopButton();return!!e&&(e.click(),await Mine.sleep(100),!0)},clickStopButtonAsync:async()=>{const e=await Mine.waitFor(MineTm.getStopButton);e&&(e.click(),await Mine.sleep(100))},getAllUserResponseBlocks:()=>Mine.qsaa('[data-element-id="response-block"]:has([data-element-id="user-message"])'),getAllResponseBlocks:()=>Mine.qsaa('[data-element-id="response-block"]'),getAllResponseBlocksLength:()=>document.querySelectorAll('[data-element-id="response-block"]').length,deleteRespBlockAsync:async e=>{const t=MineTm.getAllResponseBlocks().length,n=Mine.isi("#headlessui-portal-root{display:none;}");e.querySelector('[id^="headlessui-menu-button-:"]').click();const a=await Mine.waitFor(()=>{const e=Mine.qsaa('button[role="menuitem"]').filter(e=>"Delete"===e.innerText.trim());return 1===e.length?e[0]:null});a.click(),await Mine.waitFor(()=>"Sure?"===a.innerText,{timeoutMs:1e3}).catch(e=>null),a?.click(),await Mine.waitFor(()=>MineTm.getAllResponseBlocks().length<t),n()},actionFromResponseBlockMenu:async(e,t)=>{e.querySelector('[id^="headlessui-menu-button-:"]').click(),(await Mine.waitFor(()=>{const e=Mine.qsaa('button[role="menuitem"]').filter(e=>t(e));return 1===e.length?e[0]:null})).click()},forkResponseBlockAsync:async e=>{const t=MineTm.getCurrentChatId(),n=(await MineTm.getChatIndexedDbValueAsync(t)).messages.length;await MineTm.actionFromResponseBlockMenu(e,e=>e.innerText.trim().toLowerCase()==="Fork chat from here".toLowerCase()),await Mine.waitFor(()=>{const e=MineTm.getCurrentChatId();if(e?.trim())return e!==t});const a=MineTm.getCurrentChatId();return await Mine.waitFor(async()=>(await MineTm.getChatIndexedDbValueAsync(a))?.messages?.length===n),!0},goToChatIdWithHardReload:(e,t=!1)=>{const n=`chat=${e}`;return!(!t&&window.location.hash==="#"+n||(window.location.hash=n,window.location.reload(),0))},getMaybeCurrentLocationNameAsync:async()=>{const e=await MineTm.getMinePluginBasedSecretAsync("sLocationApiKey");if(!e)return null;const t=await fetch("https://sum-location.vercel.app/api/v1/status",{method:"POST",headers:{"x-api-key":e,"Content-Type":"application/json"}}).catch(()=>null);if(!t?.ok)return null;const n=await t.json().catch(()=>null);return n?._current?.locationDesc},getHighestEffectiveMsgIdx:()=>{const e=Mine.qsaa('[class*="message-index-"]'),t=Mine.qs('[data-element-id="streaming-block"]'),n=e.slice(-1)[0];if(n){const e="message-index-";return Number([...n.classList].find(t=>t.startsWith(e)).split(e)[1])+(t?1:0)}return t?0:null},getNumPinnedMsgs:async()=>(await MineTm.getCurrentChatIdbMetaAsync()).idbe.messages.filter(e=>e.isPinned).length,togglePinResponseBlockAsync:async e=>{const t=await MineTm.getNumPinnedMsgs();return await MineTm.actionFromResponseBlockMenu(e,e=>["Pin","Unpin"].includes(e.innerText)),await Mine.waitFor(async()=>t!==await MineTm.getNumPinnedMsgs()),await MineTm.getNumPinnedMsgs()>t},deleteLastExchangeAsync:async({enableScrolling:e=!0,maybeCbConfig:t}={})=>{await MineTm.maybeClickStopButtonAsync();const n=async e=>{await MineTm.scrollToLastMsgAsync({instantScroll:!0});const t=Mine.qs(`.message-index-${e}`),n=(MineTm.getAllResponseBlocks(),Mine.isi("#headlessui-portal-root{opacity: 0.01; pointer-events: none;}"));t.querySelector('[id^="headlessui-menu-button-:"]').click();const a=await Mine.waitFor(()=>{const e=Mine.qsaa('button[role="menuitem"]').filter(e=>"Delete"===e.innerText.trim());return 1===e.length?e[0]:null});a.click(),await Mine.waitFor(()=>"Sure?"===a.innerText,{timeoutMs:1e3}).catch(e=>null),a?.click(),n(),await MineTm.waitForCompletedMsgCountAsync(e)},{idbe:a}=await MineTm.getCurrentChatIdbMetaAsync();if(MineTm.isMobile)return a.messages=a.messages.slice(0,a.messages.length-2),await MineTm.setChatIndexedDbValueAsync(a),void window.location.reload();const o=a.messages.length-1,i="user"===a.messages[o].role;t?.setStatus("deleting last msg"),await n(o),i||(t?.setStatus("deleting second to last msg"),await n(o-1)),e&&await MineTm.scrollToLastMsgAsync({useUserMessage:!0,instantScroll:!1}),(await MineTm.getTaAsync()).focus()},getCurrentChatIdbMetaAsync:async()=>{const e=MineTm.getCurrentChatId();if(!e)return null;const t=await MineTm.getChatIndexedDbValueAsync(e);return t?{contextSize:t.chatParams.contextLimit,idbe:t}:{contextSize:null,idbe:null,success:!1}},simulateAddFileAttachment:async(e,t="",{shortenName:n=!1}={})=>{const a=await MineTm.getTaAsync();if(!t){const a=e=>{const t=e.trim().split("\n")[0].trim();if(n){const e=t.split(/\s+/),n=e.slice(0,4).join(" "),a=e.slice(4,14).map(e=>e[0].toLowerCase()).join("");return n+(a?` ${a}`:"")}return t};t=(a(e).replace(/[^a-zA-Z0-9\s\-_]/g,"").trim()||"text")+".txt"}const o=new File([e],t,{type:"text/plain"}),i=new DataTransfer;i.items.add(o);const s=new DragEvent("drop",{bubbles:!0,cancelable:!0,dataTransfer:i});a.dispatchEvent(s),await Mine.sleep(100)},searchChatsAsync:async(e="",{openFirstResult:t=!0,levelEnum:n="title",levelLabel:a="titles",preferRedirect:o=!1}={})=>{e=e||prompt(`Search ${n}\n* space separated terms\n* must match all terms`),e?.trim()&&await(async(e,t)=>{const n=await(async()=>{const e="keyval";return new Promise((t,n)=>{const a=indexedDB.open("keyval-store");a.onerror=e=>n(`Database error: ${e.target.error}`),a.onsuccess=n=>{const a=n.target.result.transaction([e],"readonly").objectStore(e),o=[];a.openCursor().onsuccess=e=>{const n=e.target.result;n?(n.key.startsWith("CHAT_")&&o.push({key:n.key,value:n.value}),n.continue()):t(o)}}})})(),a=e.toLowerCase().split(" ").filter(e=>e.length>0);return n.filter(e=>{const n=e.value;if(!n||"object"!=typeof n)return!1;if("title"===t){const e=n.chatTitle;if(!e)return!1;const t=e.toLowerCase();return a.every(e=>t.includes(e))}const o=n.messages;if(!Array.isArray(o))return!1;if("message"===t)return o.some(e=>{const t=MineTm.getIdbeMessageObjText(e)?.toLowerCase();if(t)return a.every(e=>t.includes(e))});{const e=o.map(e=>MineTm.getIdbeMessageObjText(e)?.toLowerCase()).join(" ");return a.every(t=>e.includes(t))}})})(e,n).then(n=>{if(!n.length)return Mine.toast("No results.");const i=(n=n.sort((e,t)=>t.value?.updatedAt-e.value?.updatedAt)).filter(e=>!e.value.chatTitle.toLowerCase().includes("@done("));if(1===i.length||t){const e=`${window.location.origin}/#chat=${i[0].value.chatID}`;if(o)return void(window.location.href=e);if(window.open(e),1===n.length)return}const s=n.map(e=>e.value).map(e=>`<tr><td>${e.messages.length}</td><td style="padding-left:5px;"><a href="${window.location.origin}/#chat=${e.chatID}" target="_blank">${e.chatTitle}</a></td></tr>`),r=`<table style="margin-top:5px;width:100%;"><caption style="color:gray;margin-bottom:10px;">${s.length} result${1===s.length?"":"s"} for "${e}" in ${a}</caption><tr><th style='text-align:left;'># msgs</th><th style='text-align:left;padding-left:5px;'>Title</th></tr>`+s.join("")+"</table>";Mine.showFloatingMiniWindow(r,`Search ${a}`)})},copyCurrentChatToServerAsync:async()=>{const e=await MineTm.getMinePluginBasedSecretAsync("tmChatBufferPassword");if(!e)return Mine.toastWarning("Buffer password not found");try{const t=await MineTm.getChatIndexedDbValueAsync(MineTm.getCurrentChatId());if(!t)return Mine.toastWarning("No chat data found");const n=JSON.stringify(t),a=await fetch("https://pepperpotts.fly.dev/tm/upload-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat:n,apiKey:e})}),{isSuccess:o,message:i}=await a.json();return o?MineTm.Mine.toastSuccess(i):Mine.toastError(`${i}`),o}catch(e){return Mine.toastError("Failed to upload chat."),!1}},renameChatAsync:async(e,t,{deleteLastTwoMessages:n=!1}={})=>{const a=await MineTm.getChatIndexedDbValueAsync(e);if(!a)throw"not found in db";a.chatTitle=t,n&&(a.messages=a.messages.slice(0,-2)),await MineTm.setChatIndexedDbValueAsyncLegacy(e,a)},scrollToMsgWithClearanceAsyncWIP:async(e,t=7)=>{const n=Mine.qs('[data-element-id="chat-space-middle-part"]'),a=n.getBoundingClientRect(),o=e.getBoundingClientRect();n.scrollTo({top:o.top+n.scrollTop-a.top-t,behavior:"smooth"}),await Mine.sleep(500)},finalizedResponseBlocksQs:'[data-element-id="response-block"]:not([data-element-id="streaming-block"] [data-element-id="response-block"])',scrollToLastMsgAsync:async({useUserMessage:e=!1,instantScroll:t=!1}={})=>{const{idbe:n}=await MineTm.getCurrentChatIdbMetaAsync(),a="message-index-"+(n.messages.length-1);for(;!Mine.qs(`.${a}`);)Mine.qs('[data-element-id="chat-space-middle-part"]').scrollTo({top:99999999,behavior:"smooth"}),await Mine.sleep(500);Mine.qsaa('[data-element-id="response-block"]').pop().scrollIntoView({behavior:t?"instant":"smooth"}),e&&Mine.qsaa('[data-element-id="response-block"]').slice(-2)[0].scrollIntoView({behavior:t?"instant":"smooth"}),await Mine.sleep(50),await Mine.waitFor(()=>!MineTm.isBeingScrolled)},getChatEngagedDurationLabel:e=>{const t=((e,t=30)=>{if(e.length<2)return 0;const n=60*t*1e3,a=e.sort((e,t)=>e-t);let o=0;for(let e=1;e<a.length;e++){const t=a[e]-a[e-1];o+=t<n?t:0}return o})(e?.messages.map(e=>new Date(e.createdAt))||[]);return MineTm.formatDurationLabel(t)},formatDurationLabel:e=>{const t=864e5,n=31104e6,a=[{div:10*n,mod:10,label:"dec"},{div:n,mod:10,label:"y"},{div:30*t,mod:12,label:"mo"},{div:t,mod:30,label:"d"},{div:36e5,mod:24,label:"h"},{div:6e4,mod:60,label:"m"},{div:1e3,mod:60,label:"s"}];if(!e||e<0)return"0s";if(e<1e3)return"0s";const o=[];let i=e,s=!0;for(const e of a){const t=Math.floor(i/e.div);i%=e.div,t&&s&&(o.push(`${t}${e.label}`),s=o.length<2&&!o.some(e=>e.includes("dec")))}return o.join("")},clickTaMaybeSubmitButtonWithPluginsEnabledEphemerallyAsync:async()=>{const e=await MineTm.getSendButtonAsync();e&&(await MineTm.setPluginsStateAsync(!0),e.click(),await Mine.sleep(2e3),await MineTm.setPluginsStateAsync(!1))},getSidebarToggleEleAsync:async()=>await Mine.waitForQs('button[aria-label="Open sidebar"]')}),(async()=>{if(!window.Mine){const e=()=>{const e={click:t=>e.qs(t)?e.qs(t).click():null,clickLast:t=>{const n=e.qsaa(t);return!!n.length&&(n[n.length-1].click(),!0)},autoLogin:()=>{const t=e.qsaa("input[type=password]").filter(e=>!!e.offsetParent);if(1!==t.length)return;const n=t[0];n.value.length>3&&n?.closest("form")?.querySelector("[type=submit]")?.click()},updateReactTypableFormValue:(e,t)=>{const n={INPUT:"HTMLInputElement",TEXTAREA:"HTMLTextAreaElement",SELECT:"HTMLSelectElement"};if(!(e.tagName in n))return;Object.getOwnPropertyDescriptor(window[n[e.tagName]].prototype,"value").set.call(e,t);const a="numeric"===e.inputMode||"number"===e.type?new InputEvent("input",{bubbles:!0,cancelable:!0,inputType:"insertFromPaste",data:t}):"SELECT"===e.tagName?new Event("input",{bubbles:!0,cancelable:!0}):new InputEvent("input",{bubbles:!0,cancelable:!0,inputType:"insertText",data:t});e.dispatchEvent(a),e.dispatchEvent(new Event("change",{bubbles:!0,cancelable:!0}))},Utils:{allLetterCombinations:(e,t=[])=>{if("number"!=typeof e)throw Error("numLetters must be a number");if(e<0)throw Error("numLetters must be greater than or equal to zero");if(0===e)return[];const n="abcdefghijklmnopqrstuvwxyz".split(""),a=e=>n.map(t=>e+t),o=(e,t=n,i=1)=>e==i?t:o(e,(e=>e.map(a).reduce((e,t)=>e.concat(t),[]))(t),i+1);return o(e).filter(e=>!t.length||t.includes(e[0]))},findGalleries:()=>e.qsaa("span,div").filter(e=>{const t=Array.from(e.children).filter(e=>e.offsetHeight>0&&e.offsetWidth>0);if(t.length<3)return!1;const n=new Set;return t.map(e=>`${e.offsetHeight}x${e.offsetWidth}`).forEach(e=>n.add(e)),Array.from(n).every(e=>e.split("x").map(e=>Number(e)).every(e=>e>100))}),animateGalleryPreviews:t=>{Array.from(t.children).map(e=>e.querySelector("img")).filter(e=>!!e).forEach(e.simulateHover)},getIsElementVisible:e=>e.offsetWidth>0&&e.offsetHeight>0,openTemporaryWindow:e=>{const t=window.open(e);return!t||t.closed||void 0===t.closed?(alert("[noop] couln't open window to send message"),!1):(setTimeout(()=>t.close(),1e4),!0)},addCssLinkIfNeeded:e=>{if(Array.from(document.head.querySelectorAll("link")).map(e=>e.href).includes(e))return;const t=window.document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,document.getElementsByTagName("HEAD")[0].appendChild(t)},getMostCommonUnitElements:(e,t)=>{const n={};e.map(t).filter(e=>!!e).forEach(e=>n[e]=(n[e]||0)+1);const a=Object.keys(n).reduce((e,t)=>n[e]>n[t]?e:t);return e.filter(e=>t(e)===a)}},qs:(e,t=document)=>t.querySelector(e),qsa:(e,t=document)=>t.querySelectorAll(e),qsaArray:(t,n=document)=>Array.from(e.qsa(t,n)),qsaa:(t,n=document)=>e.qsaArray(t,n),qsOnly:(t,n=document)=>{const a=e.qsaa(t,n);return 1===a.length?a[0]:null},qso:(t,n=document)=>e.qsOnly(t,n),lmkr:async e=>{const t=`https://sum-notifier.vercel.app/api/v1/notify?message=${encodeURIComponent(e)}&title=Chrome%20Helper`;return await fetch(t,{mode:"no-cors"}),!0},runSteps:async(t,n="",a=1e3)=>{try{for(let n=0;n<t.length;n++)t[n](),await e.sleep(a)}catch(e){n&&alert(n)}},lmkrWhenSelectedElementChanges:()=>{const t=()=>Math.round((new Date).getTime()/1e3),n=t(),a=$0;if(!a)return alert("[noop] select an element using element inspector an try again."),!1;const o=e=>[e.value||"",e.outerHTML||""].join(":"),i=o(a),s=e=>e.length>30?e.substr(0,29)+"…":e,r=(a,i)=>{const c=o(a);if(a&&c===i){const e=t()-n;e%60==0&&console.log(`[${Math.round(e/60)}m] still checking every 500ms...`),setTimeout(()=>r(a,i),500)}else e.lmkr(`Watched element changed:\n🏁: ${s(c)}\n🏳: ${s(i)}`),console.log("notified element change")};return e.lmkr(`Watching for element changes:\n🏳: ${s(i)}`)?(r(a,i),window.MineElement=a,a):(alert("Unable to send messages. Fix that and try again."),!1)},colorElementsByValue:(e,t,n={})=>{const a=(e=e.filter(e=>!isNaN(t(e)))).map(t),o=n.filterOutliers?((e=[])=>{if(e.length<4)return{};let t,n,a,o,i;return t=e.slice().sort((e,t)=>e-t),t.length/4%1==0?(n=.5*(t[t.length/4]+t[t.length/4+1]),a=.5*(t[t.length*(3/4)]+t[t.length*(3/4)+1])):(n=t[Math.floor(t.length/4+1)],a=t[Math.ceil(t.length*(3/4)+1)]),o=a-n,i=1.5,{min:n-1.5*o,max:a+1.5*o}})(a):{},i=Math.min(...a),s=(o.max||Math.max(...a))-i;e.forEach(e=>{const a=[255,0,0],o=[0,255,0],r=n.invertColors?a:o,c=n.invertColors?o:a,l=(t(e)-i)/s,d=((e,t=[],n=[])=>{const a=(2*(1-e)-1+1)/2,o=1-a;return[parseInt(t[0]*a+n[0]*o),parseInt(t[1]*a+n[1]*o),parseInt(t[2]*a+n[2]*o)]})(l,r,c),m=0===l||l>=1;e.style[m?"border":"borderBottom"]=`4px RGB(${d.join(",")}) solid`,m&&(e.style.background=`RGB(${d.join(",")})`),m&&(e.style.color="white"),e.style.borderRadius="3px";const p=`Relative efficiency: ${Math.round(100*(n.invertColors?l:1-l))}%\n`;e.title=`${p}${e.title}`.trim()})},sleep:async(e=1e3)=>new Promise(t=>setTimeout(t,e)),colorColumnByValue:(t,n="",a,o={})=>{if(!t)return!1;const i=Array.from(t?.tHead?.children[0]?.children||[]).findIndex(e=>e.innerText.trim().toLowerCase()===n.trim().toLowerCase()),s=Array.from(t.querySelectorAll(`tbody tr td:nth-child(${i+1})`));e.colorElementsByValue(s,a,o)},scrollToTop:(e=!1)=>window.scroll({top:0,left:0,behavior:e?"auto":"smooth"}),scrollToBottom:(e=!1)=>window.scroll({top:document.body.scrollHeight,left:0,behavior:e?"auto":"smooth"}),scrollToElement:(e,t=0)=>new Promise(n=>{const a=(window.pageYOffset||document.documentElement.scrollTop)+e.getBoundingClientRect().top-100+t;Math.round(window.scrollY)!==Math.round(a)?(window.scrollTo({top:a,left:0,behavior:"smooth"}),((e=()=>{})=>{const t=(n=null)=>{clearTimeout(n),n=setTimeout(()=>{n=null,removeEventListener("scroll",t),e()},100)};addEventListener("scroll",t);const n=window.scrollY;setTimeout(()=>{window.scrollY===n&&(removeEventListener("scroll",t),e())},100)})(n)):n()}),miniSpotlightElementWithCallback:async(t,n=e.noop)=>{if(!t)return;await e.scrollToElement(t);const a=t.getBoundingClientRect(),o=a.left+window.scrollX,i=a.top+window.scrollY,s=a.width,r=a.height,c="__CommandBarMine_circler__",l=()=>e.qs(`#${c}`);((e,t)=>{const n=l();n&&n.remove();const a=document.createElement("div");a.id=c,a.style.position="absolute",a.style.border="10px solid slateblue",a.style.borderRadius="20px",a.style.boxShadow="rgba(0, 0, 0, 0.45) 0px 0px 50px",a.style.width=e+30+"px",a.style.height=t+30+"px",a.style.pointerEvents="none",a.style.opacity="0",a.style.transition="opacity 500ms",a.style.zIndex="100000000",document.body.append(a)})(s,r);const d=l(),m=d.offsetWidth;d.style.top=i-(d.offsetHeight-r)/2+"px",d.style.left=o-(m-s)/2+"px",d.style.opacity="1",await e.sleep(500),await n(),await e.sleep(200),d.style.opacity="0",await e.sleep(500)},simulateClickWithHint:async t=>{t&&await e.miniSpotlightElementWithCallback(t,()=>e.simulateClick(t))},simulateRightClick:e=>{const t=new MouseEvent("contextmenu",{bubbles:!0,cancelable:!0,view:window,button:2,buttons:2,clientX:e.getBoundingClientRect().left+e.offsetWidth/2,clientY:e.getBoundingClientRect().top+e.offsetHeight/2});e.dispatchEvent(t)},simulateClick:(e,t=[])=>{if(!e)return;const n=t.includes("left_quarter"),a=e.getBoundingClientRect(),o=a.left+(a.right-a.left)*(n?.2:.5),i=a.top+.5*(a.bottom-a.top);["mousedown","mouseup","click"].forEach(t=>((e,t,n,a)=>e.dispatchEvent(new MouseEvent(t,{view:window,bubbles:!0,cancelable:!0,clientX:n,clientY:a,button:0})))(e,t,o,i))},simulateHover:e=>e.dispatchEvent(new Event("mouseover",{view:window,bubbles:!0,cancelable:!1})),assertTruthy:e=>{if(e)return e;throw"assertion failed"},waitFor:async(t,{timeoutMs:n=5e3,recheckIntervalMs:a=null,shouldPadDelay:o=!1,debugMsg:i=""}={})=>{const s=Date.now();for(;;){const r=await t();if(r)return o&&await e.sleep(25),r;const c=Date.now()-s;if(c>=n)throw new Error("Timeout"+(i.trim()?`: ${i.trim()}`:""));if(null==a){const t=c<=500;await e.sleep(t?0:5)}else await e.sleep(Number(a))}},waitForQs:async(t,n={})=>await e.waitFor(()=>e.qs(t),n),waitForQsaa:async(t,n={})=>await e.waitFor(()=>{const e=document.querySelectorAll(t);return e.length?[...e]:null},n),getQueryParam:e=>{const t=window.location.search,n=new URLSearchParams(t);return n.has(e)?n.get(e):null},noop:()=>{},injectStylesheetIdempotent:(t="")=>{const n=t.trim();if(e.qsaa("style").map(e=>e.textContent).some(e=>e===n))return e.noop;const a=document.createElement("style");return a.textContent=n,document.head.appendChild(a),()=>a.remove()},injectStylesheetIdempotentCspFriendly:(t="")=>{const n=t.trim(),a=`style-${o=n,o.split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0),0)}`;var o;if(document.getElementById(a))return e.noop;const i=document.createElement("style");i.id=a;const s=new Blob([n],{type:"text/css"}),r=URL.createObjectURL(s);return i.href=r,document.head.appendChild(i),()=>{URL.revokeObjectURL(r),document.getElementById(a)?.remove()}},injectScriptIdempotent:async(t,n=!1)=>new Promise((a,o)=>{if(e.qsaa("script").map(e=>e.src).some(e=>e===t))return a();const i=document.createElement("script");i.type="text/javascript",i.async=!0,i.onload=a,i.onerror=o;try{i.src=t}catch(e){if(!n)throw e;if(!window.trustedTypes||!trustedTypes.createPolicy)throw new Error("[Mine] [Pepper] Trusted Types not supported and direct assignment failed");{const e=trustedTypes.createPolicy("injectPolicy",{createScriptURL:e=>e});i.src=e.createScriptURL(t)}}document.getElementsByTagName("head")[0].appendChild(i)}),wrapAddEventListenerWithBlockers:(e=[])=>{Object.getOwnPropertyNames(window).filter(e=>/^HTML/.test(e)).map(e=>window[e]).forEach(t=>{var n;n=t.prototype.addEventListener,t.prototype.addEventListener=function(t,a,o){const i=this;if(!e.some(e=>t===e.type&&i.matches(e.querySelector)))return n.apply(this,arguments)}})},PepperAgent:class{constructor(e,t=[]){this.name=e,this.commands=t,this.connectionFailed=!1,this.#e(),this.#t()}#e(){this.commands.push({title:"restart",description:"",run:async()=>{window.open("http://reload.extensions"),setTimeout(()=>location.reload(),3e3)}})}async#t(){const t=["https://www.youtube.com","https://open.spotify.com"].includes(window.location.origin)&&["personal","personal-assistant"].includes(e.Environment?.Profile?.name);return await e.injectScriptIdempotent("https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.js",t).catch(()=>!1)?(this.socket=io("https://pepperpotts.fly.dev:443",{query:{name:this.name,commands:this.commands}}),this.socket.on("connect",()=>{console.log("[Mine] [Pepper] connected"),this.socket.emit("register-commands",this.commands)}),this.socket.on("connect_error",e=>{console.log("[Mine] [Pepper] connection error:",e.message),this.connectionFailed=!0,this.socket.disconnect()}),this.socket.on("disconnect",e=>{console.log("[Mine] [Pepper] disconnected:"),"io server disconnect"!==e||this.connectionFailed?this.connectionFailed&&console.log("[Mine] [Pepper] not reconnecting due to previous connection failure"):(console.log("[Mine] [Pepper] trying to reconnect..."),this.socket.connect())}),this.commands.forEach(({title:e,run:t})=>{this.socket.on(e,async(e,n)=>{n(await t()||{success:!0})})}),window.addEventListener("focus",()=>{this.socket&&this.socket.connected&&!this.connectionFailed&&(this.socket.disconnect(),this.socket.connect())}),!0):(console.log("[Mine] [Pepper] aborted due to script injection failure"),this.connectionFailed=!0,!1)}async ask(e,t=[],n=()=>{},a=6e4){if(this.connectionFailed||!this.socket||!this.socket.connected)return void n({error:"Connection unavailable"});const o={questionObj:e,responseOptions:t,timeoutMs:a};this.socket.timeout(a).emit("ask",o,n)}},randomItemFromArray:e=>e[Math.floor(Math.random()*e.length)],setIntervalAndNow:(e,t=1e3)=>{e(),setInterval(e,t)},_getPuiDataKey:e=>"data-mine-processed"+(e?`-${e}`:""),processUnprocessedItems:(t=[],n,a="")=>{const o=e._getPuiDataKey(a),i=Array.from(t).filter(Boolean).filter(e=>!("true"===e.getAttribute(o))),s=e=>e.setAttribute(o,"true"),r=e=>"AsyncFunction"===e.constructor.name;for(let t=0;t<i.length;t++){const a=i[t];if(r(a))n(a).then(()=>s(a)).catch(e.noop);else{try{n(a)}catch(e){continue}s(a)}}},setQueryParam:(e,t)=>{const n=new URL(window.location);n.searchParams.set(e,t),window.location=n.href},setQueryParams:(e={})=>{const t=new URL(window.location);Object.entries(e).forEach(([e,n])=>{null==n?t.searchParams.delete(e):t.searchParams.set(e,n)}),window.location=t.href},dim:(e,{hoverDelayMs:t=500}={})=>{if(!e)return;(e=>{const t=e.style.transition.split(",").map(e=>e.trim()).filter(e=>e.length).filter(e=>!e.includes("opacity"));t.push("opacity 0.2s ease"),e.style.transition=t.join(", ")})(e);const n="0.05";let a;const o=()=>{a=setTimeout(()=>{e.style.removeProperty("opacity")},t)},i=()=>{clearTimeout(a),e.style.opacity=n},s="data-mine-dimmed";return e.setAttribute(s,"true"),e.style.setProperty("opacity",n),e.addEventListener("mouseover",o),e.addEventListener("mouseout",i),()=>{e.removeAttribute(s),e.style.removeProperty("opacity"),e.removeEventListener("mouseover",o),e.removeEventListener("mouseout",i)}}};e.updateElementValueWithLifecycles=e.updateReactTypableFormValue,e.quietElement=e.dim,e.quietElementCompletelyAsync=async e=>{if(e&&e instanceof Element)return e.style.transition="opacity 200ms ease-out",e.style.opacity="0",new Promise(t=>{setTimeout(()=>{e.style.visibility="hidden",t(e)},200)})},e.getIndexedDbCountAsync=async(e,t)=>new Promise((n,a)=>{const o=indexedDB.open(e);o.onerror=e=>a(`An error occurred while accessing the database: ${e.target.errorCode}`),o.onsuccess=e=>{const o=e.target.result.transaction([t],"readonly").objectStore(t).count();o.onerror=e=>a(`An error occurred while counting items: ${e.target.errorCode}`),o.onsuccess=e=>n(e.target.result)}}),e.getIndexedDbValueAsync=async(e,t,n)=>new Promise((a,o)=>{const i=indexedDB.open(t);i.onerror=e=>o(`An error occurred while accessing the database: ${e.target.errorCode}`),i.onsuccess=t=>{const i=t.target.result.transaction([n],"readonly").objectStore(n).get(e);i.onerror=e=>o(`An error occurred while retrieving the data: ${e.target.errorCode}`),i.onsuccess=e=>a(e.target.result)}}),e.getIndexedDbValue=e.getIndexedDbValueAsync,e.DELETE_SENTINEL=Symbol("IndexedDB Delete Sentinel"),e.setIndexedDbValueAsync=async(t,n,a,o)=>new Promise((i,s)=>{if(!t||!a||!o)return s("Required arguments missing");const r=indexedDB.open(a);r.onerror=e=>s(`Database access error: ${e.target.error}`),r.onsuccess=a=>{const r=a.target.result,c=r.transaction([o],"readwrite"),l=c.objectStore(o),d=n===e.DELETE_SENTINEL?l.delete(t):l.put(n,t);d.onerror=e=>s(`Operation error: ${e.target.error}`),d.onsuccess=()=>i(n===e.DELETE_SENTINEL?`Key ${t} deleted`:`Key ${t} set`),c.oncomplete=()=>r.close()}}),e.setIndexedDbValue=e.setIndexedDbValueAsync,e.deleteIndexedDbValueAsync=async(t,n,a)=>await e.setIndexedDbValueAsync(t,e.DELETE_SENTINEL,n,a),e.addEventListenerForSubtreeAddOrRemove=(e,t)=>{const n=new MutationObserver((e,n)=>{for(let n of e)"childList"===n.type&&t()});return n.observe(e,{childList:!0,subtree:!0}),()=>n.disconnect()},e.onElementRemoval=(e,t)=>{new MutationObserver((n,a)=>{e.isConnected||(a.disconnect(),t())}).observe(document,{childList:!0,subtree:!0})},e.onElementRemove=e.onElementRemoval,e.colorizeByContent=(t=[],n=e=>e.innerText,a="content")=>e.pui(t,async t=>{const a=n(t),o=await e.getHashedStringToHexAsync(a);t.style.transition||(t.style.transition="color 0.1s ease-in-out"),t.style.setProperty("color",o,"important")},`${a}-colorizer`),e.colorizeElementsByContent=e.colorizeByContent,e.colorizeElementByContent=(t,...n)=>e.colorizeByContent([t],...n),e.withCacheInSession=e=>{const t=e.name||e.toString().slice(0,100);return async(...n)=>{const a=`mine.cached.${encodeURIComponent(t)}.${encodeURIComponent(JSON.stringify(n))}`,o=window.sessionStorage.getItem(a);if(o)return JSON.parse(o);const i=await e(...n);return void 0!==i&&window.sessionStorage.setItem(a,JSON.stringify(i)),i}},e.isi=e.injectStylesheetIdempotent,e.withCacheInMemory=e=>{const t=new Map;return async(...n)=>{const a=JSON.stringify(n);if(t.has(a))return t.get(a);const o=await e(...n);return t.set(a,o),o}};const t=e.withCacheInMemory(e=>{if("string"!=typeof e)throw new Error("Color input must be a string");const t=e=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},n={black:"#000000",white:"#ffffff",red:"#ff0000",lime:"#00ff00",blue:"#0000ff",yellow:"#ffff00",cyan:"#00ffff",magenta:"#ff00ff",silver:"#c0c0c0",gray:"#808080",maroon:"#800000",olive:"#808000",green:"#008000",purple:"#800080",teal:"#008080",navy:"#000080"};if(e.startsWith("#"))return t(e);if(e.toLowerCase().startsWith("rgb("))return(e=>{const t=/rgb\((\d+),\s*(\d+),\s*(\d+)\)/i.exec(e);return t?{r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10)}:null})(e.toLowerCase());if(e.toLowerCase()in n)return(e=>{const a=n[e.toLowerCase()];return a?t(a):null})(e);if(e.toLowerCase().startsWith("rgba("))return(e=>{const t=/rgba\((\d+),\s*(\d+),\s*(\d+),\s*[\d.]+\)/i.exec(e);return t?{r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10)}:null})(e.toLowerCase());throw new Error(`Invalid color format provided: ${e}. Accepts hex string, RGB string, or named HTML color.`)}),n=e.withCacheInMemory(e=>{const t=[e.r,e.g,e.b].map(e=>e/255).map(e=>e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4));return.2126*t[0]+.7152*t[1]+.0722*t[2]}),a=e.withCacheInMemory(async(e,t)=>{const a=await n(e),o=await n(t);return(Math.max(a,o)+.05)/(Math.min(a,o)+.05)}),o=e.withCacheInMemory(e=>{let t=0;for(let n=0;n<e.length;n++)t=Math.imul(31,t)+e.charCodeAt(n)|0;let n="#";for(let e=0;e<3;e++)n+=(t>>8*e&255).toString(16).padStart(2,"0");return n});e.getHashedStringToHexAsync=e.withCacheInMemory(async(e,n)=>{let i=await o(e);if(n){const s=4.5;let r=0;const c=10,l=await t(n);let d=0,m=i;const p=async e=>{const n=await a(await t(e),l);return n>d&&(d=n,m=e),n};let u=await p(i);for(;u<s&&r<c;)r++,i=await o(e+r),u=await p(i);i=m}return i}),e.getCssToHide=t=>e.normalizeSpaceIndents(`\n    ${t} {\n      display: none !important;\n    }\n    `),e.getCssToQuietQs=(t,{delayMs:n=1e3}={})=>e.normalizeSpaceIndents(`\n    ${t} {\n      opacity: 0.2;\n      transition: opacity 0.2s ease-in-out !important;\n    }\n    ${t}:hover {\n      transition-delay: ${n/1e3}s !important;\n      opacity: 1;\n    }\n    `).trim(),e.bindHotkey=(e,t=document,n)=>{const a=e.split("+").map(e=>e.trim().toLowerCase());let o="";const i={shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!1};a.forEach(e=>{const t=Object.keys(i).find(t=>t.toLowerCase()===e);t?i[t]=!0:o=e});const s=e=>{const a=t!==document||!["input","textarea","select","button"].includes(e.target.tagName?.toLowerCase())&&!e.target.isContentEditable,s=e.key.toLowerCase()===o;Object.keys(i).every(t=>i[t]===e[t])&&s&&a&&n(e)};return t.addEventListener("keydown",s),()=>t.removeEventListener("keydown",s)},e.Ollama={getIsStatementTrueOrFalse:async t=>await e.Ollama.getDoesPassageAnswerQuestion(t,"Is this true?"),getDoesPassageAnswerQuestion:async(t="I like apples",n="Do they like fruits?")=>{const a=`\n  ${n} Respond with "YES" or "NO".\n\n  Passage (in triple quotes):\n  """\n  ${(t=String(t)).split("\n").map(e=>`> ${e}`).join("\n")}\n  """\n  `.trim();return((e="")=>{const t=e.trim().toLowerCase().startsWith("yes,"),n="yes"===e.replace(/[^a-zA-Z]/g,"").toLowerCase().split(" ")[0];return t||n})(await e.Ollama.getResponseText(a).then(e=>e.trim()))},_getResponseTextUnmanagedAsync:async(t,{model:n="phi4:latest",systemPrompt:a="",jsonMode:o=!1,startResponseWith:i="",keep_alive:s=9e5}={})=>{const r=[{role:"user",content:t}];a&&r.unshift({role:"system",content:a}),i&&r.push({role:"assistant",content:i});const c={model:n,messages:r,stream:!1,options:{temperature:0},keep_alive:s};o&&(c.format="json");const l=JSON.stringify(c),d=await e.Extension.fetchText("http://127.0.0.1:11434/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:l});if(!d)throw new Error("error fetching");return i+d.split("\n").filter(Boolean).map(e=>JSON.parse(e))[0].message.content},_getResponseJsonUnmanagedAsync:async(t,n={})=>{n.jsonMode=!0;const a=await e.Ollama._getResponseTextUnmanagedAsync(t,n);let o=null;try{o=JSON.parse(a.trim())}catch(e){}return o},getResponseText:async(t,n={})=>await e.withCacheInSession(e.Ollama._getResponseTextUnmanagedAsync)(t,n),getResponseJsonAsync:async(t,n={})=>await e.withCacheInSession(e.Ollama._getResponseJsonUnmanagedAsync)(t,n),_getResponseObjs:async(t="",n=!0)=>{const a=JSON.stringify({model:"openhermes:7b-mistral-v2.5-q6_K",prompt:t,temperature:0}),o=await e.Extension.fetchText("http://127.0.0.1:11434/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:a});if(!o)throw new Error("error fetching");return o.split("\n").filter(Boolean).map(e=>JSON.parse(e))}},e.Ai={getResponseText:async(...t)=>await e.withCacheInSession(e.Ai._getResponseTextRaw)(...t),_getResponseTextRaw:async(t,n="",{imageDataBase64:a=null,brand:o="anthropic",options:i={}}={})=>{let s=t;a&&(s=[{type:"text",text:t},{type:"image",source:{type:"base64",media_type:"image/png",data:a}}]);const r=[{role:"user",content:s}];let c="";const l=await(async t=>"anthropic"===t?await e.Extension.getItem("commandbar-anthropic-key").catch(()=>null):"cerebras"===t?await e.Extension.getItem("commandbar-cerebras-key").catch(()=>null):"groq"===t?(c=e.randomItemFromArray(["commandbar-groq-key"]),await e.Extension.getItem(c).catch(()=>null)):"sambanova"===t?await e.Extension.getItem("commandbar-sambanova-key").catch(()=>null):null)(o);if(!l)return e.toastError(`No AI key for "${o}"`);let d;return"anthropic"===o?d=await(async t=>{const a={model:"claude-sonnet-4-0",temperature:1,stream:!1,messages:t,max_tokens:4096,system:n,...i};return(await e.Extension.fetchJson("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json",accept:"*/*","accept-language":"en-US,en;q=0.9","anthropic-beta":"max-tokens-3-5-sonnet-2024-07-15,prompt-caching-2024-07-31","anthropic-dangerous-direct-browser-access":"true","anthropic-version":"2023-06-01","x-api-key":l},body:JSON.stringify(a)})).content[0].text})(r):"cerebras"===o?d=await(async t=>{const n=await e.Extension.fetchJson("https://api.cerebras.ai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({model:"llama3.1-70b",temperature:1,stream:!1,messages:t,max_completion_tokens:-1,seed:0,top_p:1,...i})});if("too_many_requests_error"===n.type)throw"too_many_requests_error";const a=n.choices?.[0]?.message;if(!a)throw"no message in response";return a.content})(r):"groq"===o?d=await(async t=>{const n=await e.Extension.fetchJson("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({model:"llama-3.2-90b-vision-preview",temperature:1,stream:!1,messages:t,seed:0,top_p:1,...i})});if(n.type)throw`error "${n.type}"`;const a=n.choices?.[0]?.message;if(!a)throw console.log(`ai failed w key '${c}'`,n),"unexpected ai response";return a.content})(r):"sambanova"===o&&(d=await(async t=>{const n=await e.Extension.fetchJson("https://api.sambanova.ai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({stream:!1,model:"Meta-Llama-3.1-405B-Instruct",messages:t,...i})}),a=n.choices?.[0]?.message;if(!a)throw"no message in response";return a.content})(r)),d}},e.spotlightElement=t=>{let n,a;t||(t=document.createElement("button"));try{n=t.getBoundingClientRect()}catch(e){return console.warn("Failed to get element bounds"),()=>{}}const o=()=>{e.qsaa(".mine-wall").forEach(e=>{e.style.opacity="0",setTimeout(()=>e.remove(),200)}),a?.disconnect(),a=null};a=new MutationObserver(e=>{e.forEach(e=>{if("style"===e.attributeName){const e=t.getBoundingClientRect();e.left===n.left&&e.top===n.top||o()}else"childList"!==e.type||document.body.contains(t)||o()})}),a.observe(t,{attributes:!0,attributeFilter:["style"],childList:!0,subtree:!0});const i=document.createElement("div");return i.classList.add("mine-wall"),Object.assign(i.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.8)",zIndex:"10000",opacity:"0",transition:"opacity 100ms",clipPath:(e=>`polygon(\n      0px 0px, 100% 0px,\n      100% ${e.top}px,\n      ${e.left}px ${e.top}px,\n      ${e.left}px ${e.bottom}px,\n      ${e.right}px ${e.bottom}px,\n      ${e.right}px ${e.top}px,\n      100% ${e.top}px,\n      100% 100%, 0px 100%\n    )`)(n)}),i.addEventListener("click",o),document.body.append(i),requestAnimationFrame(()=>requestAnimationFrame(()=>i.style.opacity="1")),o},e.pui=e.processUnprocessedItems,e.normalizeSpaceIndents=e=>{if(!e)return e;const t=e.split("\n"),n=Math.min(...t.filter(e=>e.trim()).map(e=>e.match(/^\s*/)[0].length));return t.map(e=>e.slice(n)).join("\n")},e.nsi=e.normalizeSpaceIndents,e.addEventListenerForDirectChildrenChange=(e,t)=>{const n=new MutationObserver(e=>{for(let n of e)if("childList"===n.type){const e=[],a=[];for(let t of n.addedNodes)t.nodeType===Node.ELEMENT_NODE&&e.push(t);for(let e of n.removedNodes)e.nodeType===Node.ELEMENT_NODE&&a.push(e);(e.length>0||a.length>0)&&t({added:e,removed:a,mutation:n})}});return n.observe(e,{childList:!0}),()=>n.disconnect()};let i=0;e.processUnprocessedItemsContinuallyAsync=async(t,n,a="")=>{a=a||`puic-${i++}-${Date.now()}`;const o=`not([${e._getPuiDataKey(a)}])`,s=[];let r=500;const c=()=>{const i=t({nypf:o});return e.pui(i,n,a),i.length};let l=!0;const d=async()=>{if(l){try{const e=c();s.push({count:e}),s.length>5&&s.shift(),r=(()=>{if(s.length<3)return r;const e=s.reduce((e,t)=>e+t.count,0)/s.length,t=Math.max(200,Math.min(1e3,1e3-80*e));return 50*Math.round(t/50)})()}catch(e){}setTimeout(d,r)}};return d(),{deconstruct:()=>l=!1,trigger:c}},e.processUnprocessedItemsContinually=e.processUnprocessedItemsContinuallyAsync,e.puic=e.processUnprocessedItemsContinually,e.puica=e.processUnprocessedItemsContinuallyAsync,e.hideQs=t=>e.isi(e.getCssToHide(t)),e.quietQs=(t,n={})=>e.isi(e.getCssToQuietQs(t,n)),e.removeElementAsync=async e=>new Promise(t=>{if(!e)return void t();const n=window.getComputedStyle(e),a=n.height;e.style.width=n.width,e.style.height=a,requestAnimationFrame(()=>{e.style.transition="opacity 150ms, width 150ms, height 150ms",e.style.opacity="0",e.style.width="0",e.style.height="0",e.style.overflow="hidden",e.addEventListener("transitionend",function n(a){"opacity"===a.propertyName&&(e.removeEventListener("transitionend",n),e.remove(),t())})})}),e.removeElement=e.removeElementAsync,e.removeEle=e.removeElement,e.collapse=(e,t="100px")=>{if(!e)return;const n=document.createElement("div");n.style="position: relative; overflow: hidden; transition: max-height 0.1s ease;",n.style.maxHeight=`${e.offsetHeight}px`;const a=document.createElement("div");a.title="Expand collapsed item",a.style="position: absolute; bottom: 0; left: 0; right: 0; height: 100%; background: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.2)); cursor: pointer; border-radius: 5px;",e.parentNode.insertBefore(n,e),n.appendChild(e),n.appendChild(a),setTimeout(()=>n.style.maxHeight=t,0),a.addEventListener("click",()=>{const e=n.style.maxHeight===t;n.style.maxHeight=e?`${n.scrollHeight}px`:t,a.style.display=e?"none":"block"});const o=new MutationObserver(e=>{e.forEach(e=>{if("childList"===e.type){for(a.remove();n.firstChild;)n.parentNode.insertBefore(n.firstChild,n);n.parentNode.removeChild(n),o.disconnect()}})});o.observe(n,{childList:!0})},e.attachToElementContinuouslyAsync=async(t=()=>{},n=()=>{},a={})=>{const o=async()=>{const i=await t().catch(()=>null);if(!i)return void(a.onElementNotFound&&await a.onElementNotFound());const s=await n(i);e.onElementRemoval(i,async()=>{a.onElementGone&&await a.onElementGone(i),s&&await s(),o()})};await o()},e.attachToElementContinuously=e.attachToElementContinuouslyAsync,e.throttle=(e,t=1e3)=>{let n=0;return(...a)=>{const o=Date.now();o-n<t||(n=o,e(...a))}},e.debounce=(e,t=1e3,n=null)=>(...a)=>(clearTimeout(n),n=setTimeout(()=>e(...a),t)),e.throttleAndDebounce=(t=e.noop,{throttleMs:n=100,debounceMs:a=250}={})=>{let o,i=0;return(...e)=>{const s=Date.now();s-i>n&&(t(...e),i=s),clearTimeout(o),o=setTimeout(()=>t(...e),a)}};const s=[];return e.toastAsync=(e="",t,n={})=>new Promise(a=>{e=e.toString(),t||(t=Math.min(3e3+1e3*e.split(" ").length*.75,2e4));const{severity:o="none"}=n,i=o.toLowerCase();let r="";"none"!==i&&(r=`box-shadow: inset 0 0 0 2px ${{info:"lightblue",error:"red",warning:"orange",success:"limegreen"}[i]||"transparent"};`);const c=document.createElement("div");c.className="mine-hud-msg",c.textContent=e,c.style.cssText=`\n      position: fixed;\n      bottom: 20px;\n      right: 20px;\n      padding: 10px 20px;\n      background: rgba(0,0,0,0.9);\n      color: white;\n      ${r}\n      border-radius: 5px;\n      transition: all 0.3s;\n      opacity: 0;\n      transform: translateY(100%);\n      z-index: 10000;\n      max-width: 300px;\n      word-wrap: break-word;\n      user-select: text;\n      touch-action: pan-x;\n      text-align: left;\n    `,document.body.appendChild(c);const l=()=>{s.forEach((e,t)=>{e.style.bottom=20+t*(e.offsetHeight+10)+"px"})},d=()=>{if(document.hidden)return void setTimeout(d,1e3);c.style.transition="all 0.3s",c.style.transform="translateX(100%)",c.style.opacity="0";const e=s.indexOf(c);e>-1&&s.splice(e,1),l(),setTimeout(()=>{c.remove(),a()},300)};let m,p;const u=()=>{const e=window.getSelection();return e.toString().length>0&&c.contains(e.anchorNode)};c.addEventListener("touchstart",e=>{u()||(m=e.touches[0].clientX,p=Date.now(),c.style.transition="none")}),c.addEventListener("touchmove",e=>{if(!m||u())return;const t=e.touches[0].clientX-m;t>0&&(e.preventDefault(),c.style.transform=`translateX(${t}px)`)}),c.addEventListener("touchend",e=>{if(!m||u())return;const t=e.changedTouches[0].clientX-m,n=Date.now()-p;t>50&&n<300?d():(c.style.transition="transform 0.3s",c.style.transform="translateY(0)"),m=null}),s.push(c),l(),requestAnimationFrame(()=>{c.style.opacity="1",c.style.transform="translateY(0)"}),setTimeout(d,t)}),e.toast=(t,n)=>e.toastAsync(t,n,{severity:""}),e.toastInfo=(t,n)=>e.toastAsync(t,n,{severity:"info"}),e.toastWarning=(t,n)=>e.toastAsync(t,n,{severity:"warning"}),e.toastError=(t,n)=>e.toastAsync(t,n,{severity:"error"}),e.toastSuccess=(t,n)=>e.toastAsync(t,n,{severity:"success"}),e.toastGlobalAsync=async e=>{try{return(await fetch("http://localhost:3305/alert",{method:"POST",headers:{"Content-Type":"application/json"},body:e})).ok}catch(e){return!1}},e.getAnimationFrameAsync=async()=>new Promise(e=>requestAnimationFrame(e)),e.deduplicate=e=>[...new Set(e)],e.Obfuscator={_key:71,_xor:(()=>{const t=new Map;return n=>{if(t.has(n))return t.get(n);const a=String.fromCharCode(...n.split("").map(t=>t.charCodeAt(0)^e.Obfuscator._key));return t.set(n,a),a}})(),_process:t=>{if("string"==typeof t)return e.Obfuscator._xor(t);if("object"!=typeof t||null===t)return t;const n=Object.entries(t);for(let a=n.length-1;a>=0;a--){const[o,i]=n[a];delete t[o],t[e.Obfuscator._xor(o)]="object"==typeof i&&null!==i?e.Obfuscator._process(i):"string"==typeof i?e.Obfuscator._xor(i):i}return t},obfuscate:t=>e.Obfuscator._process(t),deobfuscate:t=>e.Obfuscator._process(t)},e.Extension={_remoteDistachedFunctionRequestCounter:0,serveRemoteDispatchedFunction:(t,n)=>{document.addEventListener(e.Obfuscator.obfuscate(t),async a=>{const o=e.Obfuscator.deobfuscate(a.detail);let i,s;try{s=await n(o)}catch(a){i=a}const r={data:s,_requestId:o._requestId,error:i};document.dispatchEvent(new CustomEvent(e.Obfuscator.obfuscate(`${t}Response`),{bubbles:!1,detail:e.Obfuscator.obfuscate(r)}))})},callRemoteDispatchedFunction:async(t,n={})=>new Promise((a,o)=>{const i=e.Extension._remoteDistachedFunctionRequestCounter++,s=e.Obfuscator.obfuscate(`${t}Response`),r=async t=>{const n=e.Obfuscator.deobfuscate(t.detail);return n._requestId===i?(document.removeEventListener(s,r),n.error?o(n.error):a(n.data)):null};document.addEventListener(s,r),document.dispatchEvent(new CustomEvent(e.Obfuscator.obfuscate(t),{bubbles:!1,detail:e.Obfuscator.obfuscate({...n,_requestId:i})}))}),runCommand:async(t,n={})=>await e.Extension.callRemoteDispatchedFunction("executeMineForExtensionCommand",{commandName:t,commandConfig:n}),getCurrentFocusedTabUrl:t=>e.Extension.runCommand("getCurrentFocusedTabUrl",t),getCurrentFocusedTabInfo:t=>e.Extension.runCommand("getCurrentFocusedTabInfo",t),openTab:async t=>await e.Extension.runCommand("openTab",t),closeTab:async t=>await e.Extension.runCommand("closeTab",t),copyText:t=>e.Extension.runCommand("copyText",{text:t}),getItems:async t=>await e.Extension.runCommand("getItems",{keys:t}),getItem:async t=>await e.Extension.runCommand("getItem",{key:t}),setItem:async(t,n)=>await e.Extension.runCommand("setItem",{key:t,value:n}),getIsHiddenMode:async()=>await e.Extension.runCommand("getIsHiddenMode"),setIsHiddenMode:async(t=!0)=>await e.Extension.runCommand("setIsHiddenMode",{isHidden:t}),fetchJson:async(t,n={})=>await e.Extension.runCommand("fetchJson",{url:t,options:n}),fetchText:async(t,n={})=>await e.Extension.runCommand("fetchText",{url:t,options:n}),askActiveChatAsync:async(t,n={})=>await e.Extension.runCommand("askActiveChatAsync",{message:t,options:n}),serveRemotePageApiAsync:async(t,n)=>{const a=document.createElement("div");a.id="__mine-page-api-bridge-host",a.style.display="none",document.body.appendChild(a);const o=a.attachShadow({mode:"open"}),i=document.createElement("textarea");i.style.display="none",i.value="",o.appendChild(i);const s=new MutationObserver(()=>{if(!i.value)return;const e=JSON.parse(i.value);if("call"!==e.type)return;const t=(e,t)=>{i.value=JSON.stringify({type:"response",ok:e,...e?{result:t}:{error:t}}),i.dataset.updated=Date.now().toString()},a=n[e.fnName];if(!a)return t(!1,`Unsupported API method: ${e.fnName}`);Promise.resolve(a(e.args)).then(e=>t(!0,e)).catch(e=>t(!1,e.message))});s.observe(i,{attributes:!0,attributeFilter:["data-call"]});const r=await e.Extension.runCommand("registerRemotePageApi",{serviceNameId:t});return!!r?.success||(s.disconnect(),a.remove(),!1)},askRemotePageApiAsync:async(t,n,a)=>await e.Extension.runCommand("askRemotePageApi",{serviceNameId:t,fnName:n,argsMap:a})},e.CommandBar={_getCommandsFns:[],runCommandEphemerallyAsync:async t=>{let n=!1;t.title=`🤖 ${t.title}`,e.CommandBar.serveGetCommandsFnAsync(()=>n?[]:[t].filter(Boolean)),await e.CommandBar.executeCommandAsUserAsync(t.title),n=!0},executeFunctionAsStandaloneProcessAsync:async(t,n)=>{await e.CommandBar.runCommandEphemerallyAsync({title:t,run:n})},serveGetCommandsFnAsync:async t=>{const n=!e.CommandBar._getCommandsFns.length;if(e.CommandBar._getCommandsFns.push(t),n){let t=[];e.Extension.serveRemoteDispatchedFunction("getCommandBarCommands",async n=>(t=await Promise.all(e.CommandBar._getCommandsFns.map(async e=>{let t=[];try{t=await e()}catch(e){t.push({title:"⚠️ Error loading commands",subtitle:"Show error log",run:async()=>console.log(e)})}return t})).then(e=>e.flat()),{commandsLite:t.map(e=>({site:e.site,title:e.title,subtitle:e.subtitle,analytics:e.analytics,showHintNotToInteract:e.showHintNotToInteract,isStatusBar:e.isStatusBar,isForUnhandledCommand:e.isForUnhandledCommand,hideFromAi:e.hideFromAi,hotkeySequence:e.hotkeySequence}))})),e.Extension.serveRemoteDispatchedFunction("executeCommandBarCommand",async n=>{const{commandName:a,context:o={}}=n,i=t.find(e=>e.title===a);return o.getShouldInterruptAsync=async()=>await e.Extension.callRemoteDispatchedFunction("getCommandBarShouldInterruptForCommand",{commandName:a}),o.setStatus=async t=>await e.Extension.callRemoteDispatchedFunction("setCommandBarStatusForCommand",{commandName:a,statusText:t}),await i.run(o)})}const a=e.Obfuscator.obfuscate("minePageHasNewCommandBarCommands");document.dispatchEvent(new CustomEvent(a,{bubbles:!1})),sessionStorage.setItem(a,!0)},_servePageApiAlreadyInit:!1,serveGetPageApiWrapperFnAsync:async t=>{if(e.CommandBar._servePageApiAlreadyInit)throw"already initiated pageApi wrapper";let n;e.CommandBar._servePageApiAlreadyInit=!0;const a=e=>{const t=JSON.stringify(e,(e,t)=>"function"==typeof t?t.toString():t,2),n=JSON.parse(t);return Object.entries(n).map(([e,t])=>`${e}: ${t.split("=>")[0].trim()}`).map(e=>`* ${e}`).join("\n")};e.Extension.serveRemoteDispatchedFunction("getCommandBarPageApiWrapper",async e=>{const o=await t();return n=await o.getPageApi(),{site:o.site,aiBrand:o.aiBrand,pageInitialContext:await o.getPageInitialContext(),pageApiStr:a(n)}}),e.Extension.serveRemoteDispatchedFunction("executeCommandBarPageApiFn",async e=>{const{function_name:t,function_argument_object:a={}}=e,o=n[t];if(!o)throw"command not found";return await o(a)});const o=e.Obfuscator.obfuscate("minePageHasCommandBarPageApi");document.dispatchEvent(new CustomEvent(o,{bubbles:!1})),sessionStorage.setItem(o,!0)}},e.CommandBar.sgcfa=e.CommandBar.serveGetCommandsFnAsync,e.CommandBar.isCurrentUrlMatchedByPattern=(e="")=>window.location.href.toLowerCase().startsWith(e.toLowerCase())||window.location.href.match(new RegExp(e,"i")),e.CommandBar.buildCommandsIfAtSite=async(t,n)=>{if(!e.CommandBar.isCurrentUrlMatchedByPattern(t))return[];const a=await n();return a.forEach(e=>e.site=t),a},e.CB=e.CommandBar,e.waitForMaybeElement=t=>new Promise(async n=>{const a=await e.waitFor(t,{recheckIntervalMs:500,timeoutMs:1e4}).catch(()=>null);a&&n(a)}),e.TypingMind={_setChatStarter:async(t="",n="")=>{const a=await e.Extension.getItem("pepperSetDataKey");return!!a&&await(async()=>{const o=e=>btoa(String.fromCharCode(...(new TextEncoder).encode(e))),i=JSON.stringify({key:"chatStarterBuffer",data:{query:o(t.trim()),context:o((n??"").trim()),createdDate:Date.now()}}),s={method:"POST",headers:{"Content-Type":"application/json","pepper-api-key":a},body:i};return(await e.Extension.fetchJson("https://pepperpotts.fly.dev/apps/setData",s)).success})()},startChat:async(t="",n="")=>{await e.TypingMind._setChatStarter(t,n),window.open("https://www.typingmind.com/")}},e.TM=e.TypingMind,e.showFloatingMiniWindow=(e,t="Info")=>{const n=e instanceof Element,a=n?e:document.createElement("div");n||(a.innerHTML=e);const o=(e,t,n="")=>{const a=document.createElement(e);return a.style.cssText=t,a.textContent=n,a},i=o("div","\n      position: fixed;\n      background: #2c2c2c;\n      border: 1px solid #444;\n      border-radius: 8px;\n      box-shadow: 0 10px 25px rgba(0,0,0,0.5);\n      min-width: 260px;\n      max-width: 80vw;\n      width: max-content;\n      overflow: hidden;\n      max-height: 80vh;\n      display: flex;\n      flex-direction: column;\n      z-index: 1000;\n      opacity: 0;\n      transition: opacity .15s ease-out;\n    "),s=i.attachShadow({mode:"open"}),r=document.createElement("style");r.textContent="\n      :host {color: #e0e0e0; font-family: Arial, sans-serif;}\n      .handle {\n        background: #383838;\n        padding: 3px 12px 2px;\n        cursor: move;\n        user-select: none;\n        font-size: 14px;\n        font-weight: bold;\n        border-bottom: 1px solid #444;\n      }\n      .close-btn {\n        float: right;\n        cursor: pointer;\n        font-size: 18px;\n        line-height: 18px;\n        color: #888;\n        transition: opacity .1s ease-out, color .2s;\n        opacity: 0;\n      }\n      .content-wrapper {\n        padding: 10px;\n        overflow-y: auto;\n        flex-grow: 1;\n      }\n    ";const c=o("div","",t);c.className="handle";const l=o("span","","×");l.className="close-btn";const d=o("div","");d.className="content-wrapper",l.onmouseover=()=>l.style.color="#fff",l.onmouseout=()=>l.style.color="#888",l.onclick=()=>{i.style.opacity="0",setTimeout(()=>document.body.removeChild(i),200)},c.appendChild(l),d.appendChild(a),s.appendChild(r),s.appendChild(c),s.appendChild(d),document.body.appendChild(i);const m=i.getBoundingClientRect();i.style.left=(window.innerWidth-m.width)/2+"px",i.style.top=(window.innerHeight-m.height)/2+"px",setTimeout(()=>i.style.opacity="1",10);let p,u,g,h,y=!1;return c.addEventListener("mousedown",e=>{y=!0,p=e.clientX,u=e.clientY,g=i.offsetLeft,h=i.offsetTop,i.style.transition="none"}),document.addEventListener("mousemove",e=>{if(y){const t=e.clientY-u;i.style.left=`${g+(e.clientX-p)}px`,i.style.top=`${h+t}px`}}),document.addEventListener("mouseup",()=>{y=!1,i.style.transition="opacity .2s ease-out"}),c.addEventListener("mouseenter",()=>l.style.opacity="1"),c.addEventListener("mouseleave",()=>l.style.opacity="0"),i},e.CommandBar.executeCommandAsUserAsync=async t=>{const n=e.Obfuscator.obfuscate("minePageHasNewCommandBarCommands");await e.waitFor(()=>!window.sessionStorage.getItem(n)),await e.Extension.callRemoteDispatchedFunction("executeCommandBarCommandVisibly",{commandName:t})},e.debugSoon=async()=>{await e.sleep(3e3)},e.Agent=class{constructor({systemPrompt:e,tools:t={}}){this.systemPrompt=e,this.tools=t,this.apiKey=null}async init(){return this.apiKey=await e.Extension.getItem("commandbar-anthropic-key").catch(()=>null),!!this.apiKey}async processQueryAsync(e){if(!this.apiKey)throw new Error("Agent not initialized - call agent.init() first");const t=[{role:"user",content:e}],n=Object.entries(this.tools).map(([e,t])=>({name:e,description:t.description,input_schema:t.input_schema}));return await this.#n(t,n)}async#n(e,t){const n={model:"claude-sonnet-4-0",temperature:1,stream:!1,messages:e,max_tokens:4096,system:this.systemPrompt,tools:t},a=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json",accept:"*/*","accept-language":"en-US,en;q=0.9","anthropic-dangerous-direct-browser-access":"true","anthropic-version":"2023-06-01","x-api-key":this.apiKey},body:JSON.stringify(n)}).then(e=>e.json()),o=a.content.filter(e=>"tool_use"===e.type);if(o.length){const n=await Promise.all(o.map(async({name:e,input:t,id:n})=>{const a=await this.tools[e].handler(t);return{type:"tool_result",tool_use_id:n,content:this.#a(a)}}));return e.push({role:"assistant",content:a.content},{role:"user",content:n}),await this.#n(e,t)}return a.content[0]?.text||"(no response)"}#a(e){try{return"function"==typeof e?"[Function]":"symbol"==typeof e?e.toString():"bigint"==typeof e?e.toString()+"n":"object"==typeof e?JSON.stringify(e,null,2):String(e)}catch(e){return`[Serialization Error: ${e.message}]`}}},e.pluralize=(e,t,n)=>{const a=1===e?t:n||`${t}s`;return`${e.toLocaleString()} ${a}`},e};window.Mine=e()}MineTm.Mine=Mine;const MSG_ENRICH_PUIC_ID_BODY="enrich-msg-presentation";let enrichMessagesPresenationIdemp_lazyHydrated=Mine.noop;const isAiTyping=()=>!!MineTm.getStopButton(),isMobile=MineTm.isMobile,getIsChatScrolledToNearBottom=(e=0)=>{const t=Mine.qs('[data-element-id="chat-space-middle-part"]');return t.scrollHeight-t.scrollTop<=t.clientHeight+e+1};MineTm.mapEachNonEmptyLine=(e,t)=>e.split("\n").filter(e=>!!e.trim()).map(t).join("\n");const postProcessTaForSubmissionAsync=async()=>{const e=await MineTm.getTaAsync();let t=e.value;const n=(e=>{const t=e.match(/ -([a-zA-Z0-9]+)$/);return t?t[1]:null})(t);if(n){const a=(e,t)=>e.endsWith(t)?e.slice(0,-t.length):e;let o=[];const i={gc:async()=>{t=function(e){const t=e.match(/"""([\s\S]*?)"""/);return t?function(e){let t=new Map,n=new Map;return t.set("You","S"),n.set("S","You"),e.split("\n").map(e=>(e=e.replace(/[^\x00-\x7F\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{1F1E0}-\u{1F1FF}]/gu,"")).replace(/^(.+?),/,(e,a)=>`Person ${function(e){if("You"===e.trim())return"S";if(t.has(e))return t.get(e);let a=e[0].toUpperCase();if(n.has(a)&&(a=e.split(" ").map(e=>e[0].toUpperCase()).join("")),n.has(a)){let e=2;for(;n.has(`${a}${e}`);)e++;a=`${a}${e}`}return t.set(e,a),n.set(a,e),a}(a)},`)).join("\n")}(t[1].trim()):e}(t)},max:async()=>{const e=(await Mine.Ai.getResponseText(`\nReproduce the entire following text (in triple quotes) verbatim but instead of first person, make it a third party perspective as Max. leave everything else (including grammar, punctuation, casing, etc) as is. return just the text in a code block denoted by three tickmarks:\n"""\n${t}\n"""\n`.trim())).split("\n"),n=e=>e.trim().startsWith("```"),a=e.findIndex(n)+1,o=e.findLastIndex(n),i=e.slice(a,o).join("\n");t=i},p:async()=>o.push('answer, then add an hr and state "✨ <the answer in pretty format in one line>". if using google search, keep searching until you have a satisfactory rich answer to report.'),q:async()=>o.push("respond as concisely as possible"),n:async()=>o.push("respond normally"),v:async()=>o.push("elaborate")};for(let e=0;e<n.length;e++){const t=n[e];t in i&&await i[t]()}const s=o.length?"\n\nNote: "+o.join(". "):"",r=a(t," -"+n)+s;Mine.updateReactTypableFormValue(e,r)}},appendTaTextAsync=async(e,t)=>{const n=await MineTm.getTaAsync();return Mine.updateReactTypableFormValue(n,n.value?`${n.value}\n\n${e}`:e),Mine.qs('button:has([d="M12 7.59 7.05 2.64 5.64 4.05 12 10.41l6.36-6.36-1.41-1.41L12 7.59zM5.64 19.95l1.41 1.41L12 16.41l4.95 4.95 1.41-1.41L12 13.59l-6.36 6.36z"])')?.click(),n.blur(),n.scrollTo({top:n.scrollHeight,behavior:"smooth"}),t&&(await MineTm.getSendButtonAsync()).click(),!0},globalSelectorClickEventHandlers=new Map,bindOnSelectorClick=(e,t)=>{globalSelectorClickEventHandlers.size>0||["touchend","click"].forEach(e=>{document.body.addEventListener(e,async e=>{for(const[t,n]of globalSelectorClickEventHandlers){const a=e.target.closest(t);a&&n.forEach(t=>t(a,e))}},{passive:!0})}),globalSelectorClickEventHandlers.has(e)||globalSelectorClickEventHandlers.set(e,new Set),globalSelectorClickEventHandlers.get(e).add(t)},origWindowScroll=window.scrollTo,origElemScroll=Element.prototype.scrollTo,origElemScrollIntoView=Element.prototype.scrollIntoView,origScrollTopDesc=Object.getOwnPropertyDescriptor(Element.prototype,"scrollTop"),defineScrollingFunctions=e=>{window.scrollTo=e?origWindowScroll:()=>{},Element.prototype.scrollTo=e?origElemScroll:()=>{},Element.prototype.scrollIntoView=e?origElemScrollIntoView:()=>{},Object.defineProperty(Element.prototype,"scrollTop",e?origScrollTopDesc:{set:e=>e,get:()=>0})};MineTm.turnOffJsScrollingInstantly=()=>defineScrollingFunctions(!1),MineTm.turnOnJsScrollingInstantly=()=>defineScrollingFunctions(!0);const installRemoteChatControlAsync=async(e=!1)=>{const t=await MineTm.getMinePluginBasedSecretAsync("pepperAppsApiKey"),n=await fetch("https://pepperpotts.fly.dev/apps/getData",{method:"POST",headers:{"Content-Type":"application/json","pepper-api-key":t},body:JSON.stringify({key:"chatStarterBuffer"})});if(!n.ok)return Mine.toastWarning(`Unable to fetch possible remote chat starter: HTTP error ${n.status}`);const a=await n.json();if(!a.success||!a.data)return Mine.toastWarning("Unable to fetch possible remote chat starter: No data available");const o=a.data,i=e=>atob(e),s=i(o.query),r=i(o.context);if(!(Date.now()-new Date(o.createdDate).getTime()<=5e3))return;if(!s&&r.startsWith("GO_TO_CHAT:")){const e=r.trim().split(":")[1];return"USE_LAST_CHAT"===e?void await MineTm.goToLastRecentChatAsync():e?await MineTm.getChatIndexedDbValueAsync(e)?void MineTm.goToChatIdWithHardReload(e):Mine.toastError(`Chat "${e}" not found`):void 0}if(e)return;let c=s;"discuss-with-tida"===r?await MineTm.startChatWithAgentFromHomeAsync("Tida"):r&&(c+=`\n\n"""Context\n${r}\n"""`),(await MineTm.getTaAsync()).value||await appendTaTextAsync(c,!0)};installRemoteChatControlAsync(),isMobile&&document.addEventListener("visibilitychange",()=>{document.hidden||installRemoteChatControlAsync(!0)});const installChatSeededMessageSender=async()=>{const e="mineRequest",t=Mine.getQueryParam(e),n=await MineTm.getMinePluginBasedSecretAsync("alfredTypingMindRequestPassword"),a=sessionStorage.getItem("pendingRequestToSend");if(a){await MineTm.getTaAsync({recheckIntervalMs:500}),await Mine.sleep(1e3);const e=(e=>{try{const t=decodeURIComponent(e),a=((e,t)=>{let n="";for(let a=0;a<e.length;a++)n+=String.fromCharCode(e.charCodeAt(a)^t.charCodeAt(a%t.length));return n})(atob(t),n);return JSON.parse(a)}catch(e){return console.error("Failed to decrypt request:",e),null}})(a);if(e){const t=e.query;sessionStorage.removeItem("pendingRequestToSend"),await MineTm.sendMessageAsync(t)}return}if(t){sessionStorage.setItem("pendingRequestToSend",t);const n=new URL(window.location.href);return n.searchParams.delete(e),void(window.location.href=n.toString())}};installChatSeededMessageSender(),Mine.hideQs('[class*="message-index-"] div:has(>.animate-spin)'),Mine.quietQs('[data-element-id="additional-actions-of-response-container"]'),Mine.quietQs('[data-element-id="pinned-characters-container"]',{delayMs:0}),Mine.quietQs('[data-element-id="chat-date-info"]'),Mine.quietQs('summary:has([d="M8.99999 13.5C8.80799 13.5 8.61599 13.4271 8.46999 13.2801L2.21999 7.03005C1.92699 6.73705 1.92699 6.26202 2.21999 5.96902C2.51299 5.67602 2.98799 5.67602 3.28099 5.96902L9.00099 11.689L14.721 5.96902C15.014 5.67602 15.489 5.67602 15.782 5.96902C16.075 6.26202 16.075 6.73705 15.782 7.03005L9.53199 13.2801C9.38599 13.4261 9.19399 13.5 9.00199 13.5H8.99999Z"])'),Mine.isi(`\n\n.post-message-content {display: none;}\n\n[data-element-id="ai-response"] details summary .animate-spin {display: none;}\n\n\ndiv:has(>button:first-child polyline[points="6.5 2.75 12.75 9 6.5 15.25"]):has(>button:last-child polyline[points="6.5 2.75 12.75 9 6.5 15.25"]) {\n  display: none;\n}\n\n[data-element-id="chat-minimap-button"],[data-element-id="list-more-button"],[data-element-id="new-chat-button"],[data-element-id="voice-input-button"]{\n  display: none;\n}\n\n\n[data-element-id="ai-response"]:has(>details:only-child) {opacity: 0.2}\n[data-element-id="ai-response"]:has(>details:only-child):hover {opacity: 1}\n\n[data-element-id="prompt-library-small-button"],\n[data-element-id="workspace-tab-teams"],\n[data-element-id="workspace-tab-prompts"] {\n  display:none !important;\n}\n\n[id="elements-in-action-buttons"] > button, [data-element-id="config-buttons"] {scale: 0.8;}\n[id="elements-in-action-buttons"] {\n  gap: 0.1rem;\n  margin-bottom: ${isMobile?"28px":"0"};\n\n  -webkit-user-select: none !important;\n  user-select: none !important;\n}\n\n[data-element-id="user-message"] hr {\n  margin-bottom: -18px;\n  opacity: 0.7;\n}\n\n[data-element-id="ai-response"] hr {\n  margin: 10px 0;\n}\n\n\n[data-element-id="chat-space-end-part"]:has([data-element-id="edit-message-label"]) > [role="presentation"] { overflow: hidden; }\n\n[data-element-id="chat-space-end-part"] { padding-top: 3px; }\n\n\n:root {\n  --mine-bg-color: rgb(8,8,8);\n}\nbody {\n\t--workspace-color: black !important;\n\t--sidebar-color: black !important;\n}\n\n\n[data-element-id="chat-space-middle-part"] {\n  background: transparent;\n}\ndiv:has(>[data-element-id="chat-space-middle-part"])  \n{\n  background: transparent;\n}\n[data-element-id="chat-space-background"] {\n  background: transparent !important;\n}\n#nav-handler {\n  background: var(--mine-bg-color);\n}\n\n[data-element-id="chat-space-end-part"] {\n  border: 0;\n  background: var(--mine-bg-color) !important;\n  box-shadow: 0px 0px 10px 10px var(--mine-bg-color);\n}\n\n[data-element-id="chat-avatar-container"] {display: none;}\n[data-element-id="response-block"] {padding-left: 0.5rem;}\n\n\n.pb-1 button[aria-haspopup="menu"] .truncate {display: none;}\n\ndiv:has(>[data-element-id="chat-space-end-part"]) {\n  padding: 0 23px;\n}\n\n@media (max-width: 900px) {\n  div:has(>[data-element-id="chat-space-end-part"]) {\n    padding: 0 9px 0 9px;\n  }\n\n  \n  div:has(>[data-element-id="response-block"]) {\n    padding-right: 9px;\n    padding-left: 9px;\n  }\n  [data-element-id="response-block"] {padding-left: 0;}\n\n  [data-element-id="search-shortcut-button"] {display: none;}\n  [id="chat-input-textbox"] {padding-left: 10px;}\n\n  .enter-to-send {display: none;}\n\n  \n  [data-element-id="chat-space-end-part"]:not(:has([data-element-id="edit-message-label"])) [data-element-id="message-input"] {margin-top: -20px;}\n\n  #chat-input-textbox {padding: 7px;}\n  [data-element-id="chat-input-textbox-container"] button {opacity: 0.7;}\n  [data-element-id="response-block"] {padding:0;padding-top:10px;}\n}\n\ndiv:has(> div > img[src="/logo.png"]) {display: none;}\n.prose {\n  background: rgb(39, 39, 42);\n  border-radius: 16px;\n  border-bottom-left-radius: 3px;\n  padding: 10px;\n  color: white;\n}\n[data-element-id="user-message"] {\n  padding: 10px;\n  border-radius: 16px;\n  border-bottom-right-radius: 3px;\n}\n[data-element-id="response-block"]:has([data-element-id="user-message"]) [data-element-id="chat-avatar-container"] {display: none;}\n\ndiv:has(>.bg-blue-500) {\n  display: flex;\n  justify-content: flex-end;\n}\ndiv > button:has(.user-avatar) {visibility: hidden;}\n\nbody {background: var(--mine-bg-color) !important;}\n.response-block:hover {background: none !important;}\n\n\n.response-block li,\n.response-block p\n{\n  border-radius: 5px;\n  margin: 2px;\n  padding-left: 2px;\n  padding-right: 2px;\n}\n\n.response-block li, .response-block li *\n.response-block p, .response-block p *\n{\n  color: white;\n  transition: color 0.1s ease-in-out;\n}\n.response-block li:hover, .response-block li:hover *,\n.response-block p:hover, .response-block p:hover *\n{\n  color: hotpink;\n  transition: color 0s;\n}\ncode span {\n  transition: color 0.1s ease-in-out;\n}\ncode span:hover {\n  color: hotpink !important;\n  transition: color 0s;\n}\n\n[data-element-id="ai-response"]:has(>details:only-child) {\n  border-radius: 3px 3px 16px 16px;\n  margin-top: ${isMobile?"-14px":"-20px"};\n}\n\n.response-block li ul {margin-top: 0;}\n.response-block li:nth-child(even), .response-block p:nth-child(even) {background-color: RGBA(0,0,0,0.3);}\n\n[data-element-id="chat-space-end-part"] div:has(label) {display:none;}\n\nbutton[aria-label="Open sidebar"] {margin-top:55px;}\n\n[data-element-id="chat-input-actions"] {\n  padding-right: 2px;\n  padding-bottom: 2px;\n} \n[data-element-id="chat-space-end-part"]>div:has(img) {margin-bottom:25px} \n\ndiv:has(>[data-element-id="send-button"]) {opacity: 0.2;}\n\n[data-element-id="chat-space-end-part"] div:has([data-element-id="message-input"]) {padding-bottom: 0;}\n.hide-when-print:has([data-element-id="chat-space-beginning-part"]) {height:0;} \n\n[data-element-id="push-pin-symbol"] {display:none;}\n[data-element-id="response-block"].is-pinned {\n  background:transparent;\n  margin-top:0;\n  margin-bottom:0;\n}\n[data-element-id="user-message"],[data-element-id="ai-response"] {transition: box-shadow 0.2s, background 0.5s;}\n.is-pinned [data-element-id="user-message"], .is-pinned [data-element-id="ai-response"] {box-shadow: inset 0 0 0 2px rgba(80, 200, 120, 0.8);}\n\npre:has(.sticky) {margin:0;}\n.sticky {overflow:auto}\ndiv:has(>.sticky) .sticky {\n  background: darkslategrey;\n  border-radius: 7px 7px 0 0;\n}\n[data-element-id="ai-response"] pre button {\n  background:transparent !important;\n}\n\n[data-element-id="user-message"],[data-element-id="ai-response"] {\n  max-width: 98%;\n}\n\n\n#chat-input-textbox {\n  --recording-color: rgb(255, 0, 0); /* red */\n  --finalizing-color: rgb(255, 105, 180); /* pink */\n  --border-color: var(--recording-color);\n  border-radius: 9px;\n  transition: background 0.15s, height 0.15s, border 0.15s;\n  border-top: 1.5px solid transparent;\n  border-top-style: solid;\n  border-bottom: 1.5px solid transparent;\n}\n#chat-input-textbox.invisible-text {\n  color: transparent !important;\n}\n#chat-input-textbox.recording {\n  border-top-style: solid;\n  border-top-color: rgba(255, 0, 0, 0.5);  /* #ref-w51qjo */\n}\n#chat-input-textbox.recording.recording-lock {\n  background: #2D1B1B !important;\n}\n#chat-input-textbox.recording.recordingReleasedAndFinalizing {\n  --border-color: var(--finalizing-color);\n  border-top-color: rgba(255, 192, 203, 0.5);\n}\n#chat-input-textbox.recording:not(.recordingReleasedAndFinalizing).speech-activity-indicator {\n  animation: speechPulseRed 1s ease-out forwards;\n}\n#chat-input-textbox.recording.recordingReleasedAndFinalizing.speech-activity-indicator {\n  animation: speechPulsePink 1s ease-out forwards;\n}\n@keyframes speechPulseRed {\n  0% { border-top-color: rgba(255, 0, 0, 0.5); } /* needs to be in sync w #ref-w51qjo */\n  10% { border-top-color: rgba(255, 0, 0, 1); }\n  100% { border-top-color: rgba(255, 0, 0, 0.5); }\n}\n@keyframes speechPulsePink {\n  0% { border-top-color: rgba(255, 192, 203, 0.5); }\n  10% { border-top-color: rgba(255, 192, 203, 1); }\n  100% { border-top-color: rgba(255, 192, 203, 0.5); }\n}\n#chat-input-textbox.jamieProcessing {\n  border-bottom: 1.5px solid royalblue;\n}\n\n#chat-input-textbox:not(:focus):placeholder-shown {\n  background: var(--mine-bg-color);\n}\n\n[data-element-id="user-message"] {\n  background: rgb(39 46 78);\n}\n\n#chat-input-textbox {\n  background: #1a1a1a;\n}\n\n[aria-modal]:focus {\n  outline: none !important;\n}\n\n\n[data-element-id="response-block"] + div:has(svg:not(.animate-spin)) {display:none;}\n[data-element-id="response-block"] + div:has(svg.animate-spin) {\n  visibility: hidden;\n}\n\n\n\n\n\n\n:root {\n  --response-indicator-rgb-original: 147, 112, 219;\n  --response-indicator-rgb: var(--response-indicator-rgb-original);\n}\n\nbody:has([data-element="enabled-plugins-indicator"]) {\n  --response-indicator-rgb: 0, 255, 0;\n}\n\n\n[data-element-id="ai-response"]::after,\n[data-element-id="user-message"]::after {\n  transition: box-shadow 0.3s ease-out;\n}\n\n[class*="message-index-"]:has(svg.animate-spin:not(summary svg)):last-of-type [data-element-id="user-message"]:last-child,\n[class*="message-index-"]:has(svg.animate-spin:not(summary svg)):last-of-type [data-element-id="ai-response"]:last-child {\n  box-shadow: inset 0 -7px 9px -8px rgba(var(--response-indicator-rgb), 0.8); \n  position: relative;\n}\n[class*="message-index-"]:has(svg.animate-spin:not(summary svg)):last-of-type [data-element-id="user-message"]:last-child::after,\n[class*="message-index-"]:has(svg.animate-spin:not(summary svg)):last-of-type [data-element-id="ai-response"]:last-child::after {\n  content: '';\n  position: absolute;\n  inset: 0;\n  pointer-events: none;\n  box-shadow: inset 0 -7px 9px -8px rgba(var(--response-indicator-rgb), 0.9);\n  opacity: 1;\n}\n\n\n[data-element-id="ai-response"] {\n  box-shadow: inset 0 7px 9px -8px rgba(var(--response-indicator-rgb), 0.9);\n}\n[data-element-id="response-block"]:not(.is-pinned) [data-element-id="ai-response"] {\n  animation: shadowFadeOut 0.4s forwards;\n}\n[data-element-id="streaming-block"] [data-element-id="ai-response"] {\n  animation: none;\n  position: relative;\n}\n[data-element-id="streaming-block"] [data-element-id="ai-response"]::after {\n  content: '';\n  position: absolute;\n  inset: 0;\n  pointer-events: none;\n  box-shadow: inset 0 8px 9px -8px rgba(var(--response-indicator-rgb), 0.9);\n  opacity: 0.8;\n}\n@keyframes shadowFadeOut {\n  from {\n    box-shadow: inset 0 7px 9px -8px rgba(var(--response-indicator-rgb), 0.9);  \n  }\n  to {\n    box-shadow: none;\n  }\n}\n\n\n\n[data-element-id="streaming-block"]:not(.opacity-0), \n[data-element-id="response-block"]:has([data-element-id="user-message"]) {\n  animation: macStyleAnimation 0.4s cubic-bezier(0.2, 1.1, 0.3, 1) forwards;\n  transform-origin: bottom center;\n}\n@keyframes macStyleAnimation {\n  from {\n    opacity: 0;\n    transform: scale(0.95) translateY(10px);\n  }\n  to {\n    opacity: 1;\n    transform: scale(1) translateY(0);\n  }\n}\n\n\n\n[data-element-id="response-block"] {\n  em, p > strong:first-child {\n    color: lightsteelblue;\n  }\n  li > strong:first-child {\n    color: lightslategray;\n  }\n}\n\n\n[data-element-id="chat-space-middle-part"] {outline: none;}\n\n\n\n\n\n\ndiv:has(>[data-element-id="user-message"]) {\n  justify-content: center !important;\n  align-items: center !important; \n}\n[data-element-id="user-message"] {\n  border-radius: 16px 16px 5px 5px;\n  max-width: calc(100% - 32px);\n  border-bottom: 2px solid RGBA(0, 0, 0, 0.3);\n}\n[data-element-id="ai-response"] {\n  border-radius: 16px;\n  max-width: 100%;\n}\n[class*="message-index-"]:has([data-element-id="user-message"]) {\n  margin-bottom: 0;\n}\n[data-element-id="response-block"]:has([data-element-id="user-message"]) {\n  padding-bottom: 0;\n}\n[data-element-id="response-block"]:has([data-element-id="ai-response"]) {\n  padding-top: 0;\n}\ndiv:has(>[data-element-id="edit-message-button"]) {\n  bottom: 11px;\n}\n\n[class*="group/attachment"] img {max-height: 100px;}\n[data-element-id="ai-response"] img {max-height: 500px;}\n`),Mine.quietQs('[data-element-id="ai-response"] pre button',{delayMs:0});let notifiedAboutContextSizeMaxed=!1;const installNumMsgsInChatChangedFirer=async()=>{(()=>{const e=IDBObjectStore.prototype.put;IDBObjectStore.prototype.put=function(...t){const n=e.apply(this,t);if("keyval"===this.name){const[e,n]=t;n.replace("CHAT_","")===MineTm.getCurrentChatId()&&(e=>{const t=e.key;var n;n={lastMessage:t.messages.at(-1)??null,numMsgs:t.messages.length},document.dispatchEvent(new CustomEvent("numMsgsInChatChanged",{detail:n}))})({key:e,value:n})}return n}})()};installNumMsgsInChatChangedFirer();const installPluginBreakfreeServerV1Async=async()=>{const e={SCRAPE:async({url:e})=>await window.mineScrapeUrlAsync(e),SEARCH:async({queries:e,lookbackDays:n})=>{for(let a=0;a<e.length;a++){const o=e[a],i=await t(o,n);if(i.length)return i}return[]},ASK_REMOTE_PAGE_API:async({apiName:e,fnName:t,argsMap:n})=>await Mine.Extension.askRemotePageApiAsync(e,t,n),ASK_CHAT_AGENT:async({chatId:e,queries:t=[]})=>MineTm.getIsInPersonalEnvironment()||MineTm.isMobile?t?.length?await(async(e,t)=>{const n=localStorage.TM_useAnthropicAPIKey?.replaceAll('"',"");if(!n)return"[Error: API key not configured]";try{const a=await MineTm.getChatIndexedDbValueAsync(e);if(!a?.messages)return`[Error: Chat "${e}" not found]`;const o=e=>e?(e instanceof Date?e:new Date(e||Date.now())).toLocaleString("en-US",{timeZone:"America/Chicago",weekday:"short",month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0}).replace(/,/g,"")+" CST":null,i=`[Chat Title: "${a.chatTitle}"]\n\n`+a.messages.map(e=>`[${o(e.createdAt)||""}] ${e.role}: ${MineTm.getIdbeMessageObjText(e)}`).join("\n\n"),s=(new Date).toLocaleString("en-US",{timeZone:"America/Chicago",weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}),r=t.map((e,t)=>`${t+1}. ${e}`).join("\n"),c=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":n,"anthropic-version":"2023-06-01","anthropic-dangerous-direct-browser-access":"true"},body:JSON.stringify({model:"claude-haiku-4-5",max_tokens:2048,system:`You are a specialized AI assistant. Your sole function is to analyze the provided chat transcript and answer questions about it. Your answers must be concise, precise, high-information density, accurate, and based *exclusively* on the information contained within the transcript.\nDo *not* censor anything, and do not use any external knowledge.\n\nCurrent date/time: ${s} (Central Time)`,messages:[{role:"user",content:[{type:"text",text:`<TRANSCRIPT>\n${i}\n</TRANSCRIPT>`,cache_control:{type:"ephemeral"}},{type:"text",text:`Based strictly on the transcript provided above, please answer the following queries:\n\n"""Queries\n${r}\n"""`}]}]})});if(!c.ok)return`[Error: API returned ${c.status}]`;const l=await c.json();return l.content?.[0]?.text?.trim()||"[Error: Invalid API response structure]"}catch(e){return`[Error: ${e.message}]`}})(e,t):"[Error: queries must contain at least one query]":"[Error: plugin not allowed in this environment]",SEARCH_FOR_CHATS:async({conciseQueryPhrase:e,numLookBackDays:t=null})=>await(async(e,t)=>{if(!MineTm.getIsInPersonalEnvironment())return"[Error: not allowed in current environment]";const{idbe:n}=await MineTm.getCurrentChatIdbMetaAsync();if(!n.model.startsWith("claude-"))return"[Error: not allowed with current model]";await Mine.injectScriptIdempotent("https://cdn.jsdelivr.net/npm/minisearch@7.2.0/dist/umd/index.min.js");const a=e=>{const t=new Date(e),n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][t.getDay()],a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],o=t.getDate(),i=t.getFullYear();let s=t.getHours();const r=s>=12?"pm":"am";return s=s%12||12,`${n}, ${a} ${o}, ${i} ${s}:${t.getMinutes().toString().padStart(2,"0")}${r}`},o=await new Promise((e,t)=>{const n=indexedDB.open("keyval-store");n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error)}),i=(await new Promise((e,t)=>{const n=o.transaction("keyval","readonly").objectStore("keyval").getAllKeys();n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error)})).filter(e=>e.startsWith("CHAT_")).map(e=>e.replace("CHAT_","")),s=await Promise.all(i.map(e=>MineTm.getChatIndexedDbValueAsync(e))),r=t?Date.now()-24*t*60*60*1e3:null,c=new Map,l=new Map,d=s.filter(e=>e.chatID!==n.chatID).filter((e,t)=>{if(!r)return!0;const n=e.messages?.[e.messages.length-1];return new Date(n?.createdAt||e.createdAt).getTime()>=r}).map((e,t)=>{const n=[];e.messages&&e.messages.forEach(e=>{const t=MineTm.getIdbeMessageObjText(e);t&&n.push(t.toLowerCase())});const a=i[s.indexOf(e)];c.set(a,n);const o=e.messages?.[e.messages.length-1];return l.set(a,{lastMessageAt:o?.createdAt||e.createdAt,messageCount:e.messages?.length||0}),{id:a,title:e.chatTitle||"Untitled",content:n.join(" "),createdAt:e.createdAt}}),m=new MiniSearch({fields:["title","content"],storeFields:["title","createdAt"],searchOptions:{boost:{title:3},prefix:!0,fuzzy:.2}});m.addAll(d);const p=m.search(e,{boost:{title:3},prefix:!0,fuzzy:.2}),u=e.toLowerCase().match(/\b[\w']+\b/g)||[],g=p.map(e=>{const t=c.get(e.id);if(!t||u.length<2)return e;const n=Math.max(...t.map(e=>u.filter(t=>e.includes(t)).length)),a=n===u.length?2.5:n>=2?1.5:1.2;return{...e,score:e.score*a}});g.sort((e,t)=>t.score-e.score);const h=g[0]?.score||1;return g.slice(0,3).map(e=>{const t=l.get(e.id);return{chatId:e.id,title:e.title,relevance:(e.score/h*100).toFixed(1)+"%",messageCount:t.messageCount,createdAt:a(e.createdAt),lastMessageAt:a(t.lastMessageAt)}})})(e,t)},t=async(e,t)=>{const n="keyval",a=[],o=new Date;return o.setDate(o.getDate()-t),new Promise((t,i)=>{const s=indexedDB.open("keyval-store");s.onerror=e=>i(`IndexedDB error: ${e.target.error}`),s.onsuccess=s=>{const r=s.target.result.transaction([n],"readonly").objectStore(n).openCursor();r.onerror=e=>i(`Cursor error: ${e.target.error}`),r.onsuccess=n=>{const i=n.target.result;if(i){const t=i.value;if(i.key.startsWith("CHAT_")&&Array.isArray(t.messages)){const n=new RegExp(`\\b${e}\\b`,"i"),i=t.messages.filter(e=>"user"===e.role&&n.test(e.content)&&new Date(e.createdAt)>=o);if(n.test(t.chatTitle)){const e=t.messages.find(e=>"user"===e.role);e&&new Date(e.createdAt)>=o&&!i.some(t=>t.createdAt===e.createdAt)&&i.push(e)}const s=i.map(e=>({content:e.content,createdAt:e.createdAt})).filter(e=>{const t=(new Date).toUTCString(),n=e.createdAt,a=new Date(t),o=new Date(n),i=a.getTime()-o.getTime(),s=Math.round(i/1e3);return!Math.abs(s<10)});a.push(...s)}i.continue()}else t(a)}}})},n=await MineTm.getMinePluginBasedSecretAsync("memoryPluginPassword"),a=(()=>{const e=new Uint8Array([99,114,121,112,116,111,115,97,108,116,49,50,51,52,53,54]),t=n;async function a(t){const n=(new TextEncoder).encode(t),a=await window.crypto.subtle.importKey("raw",n,{name:"PBKDF2"},!1,["deriveBits","deriveKey"]);return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:e,iterations:1e5,hash:"SHA-256"},a,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}return{encrypt:async function(e){const n=await a(t),o=(new TextEncoder).encode(JSON.stringify(e)),i=window.crypto.getRandomValues(new Uint8Array(12)),s=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},n,o);return{iv:Array.from(i),data:Array.from(new Uint8Array(s))}},decrypt:async function(e){const n=await a(t),o=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(e.iv)},n,new Uint8Array(e.data));return JSON.parse((new TextDecoder).decode(o))}}})();window.addEventListener("message",async t=>{const{encryptedData:o}=t.data;if(o)try{const i=await a.decrypt(o),{id:s,func:r,request:c}=i,l=async()=>{const e=await a.encrypt({id:s,error:"Function not found"});t.source.postMessage({encryptedError:e},"*")};if(!n)return alert('memory plugin password not found. start a new chat and send a message "memoryPluginPassword=<the-password-no-quotes>" with no quotes'),void await l();if("function"==typeof e[r]){const n=await e[r](c),o=await a.encrypt({id:s,result:n});t.source.postMessage({encryptedResult:o},"*")}else await l()}catch(e){console.error("Decryption error:",e)}})};installPluginBreakfreeServerV1Async();const installSelectionPopoversAsync=async()=>{const e=e=>async({selectedText:t,isLongPressed:n})=>{const a=(o=e,`${MineTm.mapEachNonEmptyLine(t.trim(),e=>`> ${e}`)}\n${o}`);var o;return await appendTaTextAsync(a,n)},t={elab:e("elaborate"),"?":e("?"),"👍🏻":e("👍🏻"),"👎🏻":e("👎🏻"),"♥️":e("♥️"),"“”":async({selectedText:t,isLongPressed:n})=>{const a=prompt(`> ${t}`);if(!a)return!1;const o=e(a);return await o({selectedText:t,isLongPressed:n})}},n=document.createElement("div");n.id="custom-popover",n.className="custom-popover",n.innerHTML=Object.keys(t).map(e=>`<button class="popover-button">${e}</button>`).join(""),document.body.appendChild(n);const a=document.createElement("style");a.textContent="\n:root {\n  --popover-bg: #333;\n  --popover-text: #fff;\n  --popover-active: #555;\n  --popover-border: #444;\n}\n\n.custom-popover {\n  display: none;\n  position: fixed;\n  background-color: var(--popover-bg);\n  border-radius: 6px;\n  box-shadow: 0 8px 19px rgba(0,0,0,0.6);\n  padding: 2px;\n  z-index: 1000;\n  border: 1px solid var(--popover-border);\n  opacity: 0;\n  transition: opacity 0.1s ease-in-out;\n}\n\n.custom-popover::before {\n  content: '';\n  position: absolute;\n  top: -8px;\n  left: 50%;\n  transform: translateX(-50%);\n  border-left: 8px solid transparent;\n  border-right: 8px solid transparent;\n  border-bottom: 8px solid var(--popover-bg);\n  z-index: 1001;\n}\n\n.custom-popover::after {\n  content: '';\n  position: absolute;\n  top: -9px;\n  left: 50%;\n  transform: translateX(-50%);\n  border-left: 9px solid transparent;\n  border-right: 9px solid transparent;\n  border-bottom: 9px solid var(--popover-border);\n  z-index: 1000;\n}\n\n.custom-popover.show {\n  opacity: 1;\n}\n\n.popover-button:hover {\n  background: rgb(0,0,0,0.25);\n}\n\n.popover-button {\n  background-color: transparent;\n  border: none;\n  color: var(--popover-text);\n  font-size: 14px;\n  padding: 6px 8px;\n  margin: 0 2px;\n  cursor: pointer;\n  transition: background-color 0.1s;\n  border-radius: 6px;\n}\n\n.popover-button:active {\n  background-color: var(--popover-active);\n}\n    ".trim(),document.head.appendChild(a);let o=null,i=!1;const s=()=>{i&&(n.classList.remove("show"),setTimeout(()=>{n.style.display="none",o=null,i=!1,r()},100))},r=Mine.debounce(()=>{const e=window.getSelection();if(e.toString().length>0&&(!i||o!==e.toString())){o=e.toString();const t=e.getRangeAt(0),a=t.getBoundingClientRect();if(a.bottom<0||a.top>window.innerHeight||a.right<0||a.left>window.innerWidth)return;if(!(t.commonAncestorContainer.nodeType===Node.TEXT_NODE?t.commonAncestorContainer.parentElement:t.commonAncestorContainer).closest('[data-element-id="response-block"]'))return;n.style.display="flex",n.classList.remove("show"),i=!0,(e=>{const t=window.innerWidth,a=window.innerHeight;setTimeout(()=>{n.style.visibility="hidden",n.style.display="flex";const o=n.getBoundingClientRect();let i=e.left+(e.width-o.width)/2,s=e.bottom+10;(s<=0||s>=a)&&(s=a/2);const r=()=>{i+o.width>t&&(i=t-o.width-10),i<10&&(i=10),s+o.height>a&&(s=e.top-o.height-10),s<10&&(s=10),s+=10,n.style.left=`${i}px`,n.style.top=`${s}px`;const c=n.getBoundingClientRect();(c.right>t||c.bottom>a)&&r()};r(),n.style.visibility="visible",n.classList.add("show")},50)})(a)}else 0!==e.toString().length||n.contains(document.activeElement)||s()},150);document.addEventListener("mouseup",r),document.addEventListener("touchend",r),document.addEventListener("mousedown",e=>!n.contains(e.target)&&s()),document.addEventListener("scroll",e=>!n.contains(e.target)&&s()),document.addEventListener("touchstart",e=>!n.contains(e.target)&&s()),n.addEventListener("touchstart",e=>e.preventDefault()),setTimeout(()=>{const e=Mine.throttle(s,200);Mine.qs('[data-element-id="chat-space-middle-part"]').addEventListener("scroll",()=>e())},1e3),n.querySelectorAll(".popover-button").forEach(e=>{let n=!1;const a=async n=>{const a=e.textContent.toLowerCase(),i=o;let r=!1;t[a]&&(r=await t[a]({selectedText:i,isLongPressed:n})),r&&s()},i=((e,t=500)=>{let n,a=!1;return{start:o=>{a=!1,n=setTimeout(()=>{a=!0,e(!0)},t)},cancel:()=>{clearTimeout(n)},isLongPressDetected:()=>a}})(()=>a(!0)),r=async e=>{e.preventDefault(),e.stopPropagation(),"touchend"===e.type&&(n=!0),"click"===e.type&&n||(i.cancel(),i.isLongPressDetected()||await a(!1))};e.addEventListener("touchstart",e=>{e.preventDefault(),i.start(e)}),e.addEventListener("touchend",r),e.addEventListener("touchcancel",i.cancel),e.addEventListener("mousedown",i.start),e.addEventListener("click",r),e.addEventListener("mouseleave",i.cancel)}),document.addEventListener("click",e=>{1===e.detail&&(r(),setTimeout(()=>r(),500)),3===e.detail&&setTimeout(()=>r(),500)})};setTimeout(installSelectionPopoversAsync,1e3);const installPluginsNoiseHiderAsync=async()=>{bindOnSelectorClick('[data-element-id="chat-space-beginning-part"] button:has([d="M11.25 5.337c0-.355-.186-.676-.401-.959a1.647 1.647 0 01-.349-1.003c0-1.036 1.007-1.875 2.25-1.875S15 2.34 15 3.375c0 .369-.128.713-.349 1.003-.215.283-.401.604-.401.959 0 .332.278.598.61.578 1.91-.114 3.79-.342 5.632-.676a.75.75 0 01.878.645 49.17 49.17 0 01.376 5.452.657.657 0 01-.66.664c-.354 0-.675-.186-.958-.401a1.647 1.647 0 00-1.003-.349c-1.035 0-1.875 1.007-1.875 2.25s.84 2.25 1.875 2.25c.369 0 .713-.128 1.003-.349.283-.215.604-.401.959-.401.31 0 .557.262.534.571a48.774 48.774 0 01-.595 4.845.75.75 0 01-.61.61c-1.82.317-3.673.533-5.555.642a.58.58 0 01-.611-.581c0-.355.186-.676.401-.959.221-.29.349-.634.349-1.003 0-1.035-1.007-1.875-2.25-1.875s-2.25.84-2.25 1.875c0 .369.128.713.349 1.003.215.283.401.604.401.959a.641.641 0 01-.658.643 49.118 49.118 0 01-4.708-.36.75.75 0 01-.645-.878c.293-1.614.504-3.257.629-4.924A.53.53 0 005.337 15c-.355 0-.676.186-.959.401-.29.221-.634.349-1.003.349-1.036 0-1.875-1.007-1.875-2.25s.84-2.25 1.875-2.25c.369 0 .713.128 1.003.349.283.215.604.401.959.401a.656.656 0 00.659-.663 47.703 47.703 0 00-.31-4.82.75.75 0 01.83-.832c1.343.155 2.703.254 4.077.294a.64.64 0 00.657-.642z"])',async()=>{await Mine.waitForQs('[data-element-id="current-chat-title"] [role="menuitem"]'),await MineTm.getAnimationFrameAsync();const e=Mine.qsaa('[data-element-id="current-chat-title"] [role="menuitem"]');e.forEach(e=>e.style.display="");const t=["Web Search","Bin entries search","Bin Project Add Note","Bin Project Search-ish","Bin Project Details","[DEMO] Google Maps","Query screenshot","TaskPaper active doc","TypingMind","Mermaid Diagram","LocalCoder","Domain checker","Search Google knowledge graph","JavaScript Interpreter","Perplexity Search","DALL-E 3","Simple Calculator","Stable Diffusion v2 Image","Stable Diffusion v3 Image","Image Search","Web Page Reader","Market News","Azure AI Search","Render Chart","Render HTML"].map(e=>e.toLowerCase());e.filter(e=>t.some(t=>e.innerText.toLowerCase().includes(t.toLowerCase()))).forEach(e=>e.style.display="none")},{mustBeExactElement:!0})};setTimeout(installPluginsNoiseHiderAsync,1e3),isMobile&&Mine.isi('\n#chat-input-textbox {\n  min-height: 65px;\n}\n\n[data-element-id="send-button"] {\n  -webkit-user-select: none !important;\n  user-select: none !important;\n\n  width:fit-content;\n  overflow:hidden;\n  border-radius:5px;\n  padding:4px;\n}\n\ndiv:has(>[data-element-id="send-button"]) > div {display:none;}\ndiv:has(>[data-element-id="send-button"]) {\n  position: absolute;\n  bottom: 1px;\n  right: 1px;\n}\n\n.dynamic-chat-content-container {padding: 0;}\n'),Mine.isi('form[action="https://codepen.io/pen/define"] {display: none !important;}'),isMobile||(Mine.isi('\n[data-element-id="message-input"] .pt-2 {\n  padding-top: 0;\n}\n\n/* voice recognition dialog */\n[data-element-id="pop-up-modal"]:has(option[value="en-AU"]) {\n  right: 10px;\n  top: 100px;\n  position: absolute;\n  transform: scale(0.7);\n  transform-origin: top left;\n}\n'),Mine.quietQs('a[href="https://custom.typingmind.com"]'),Mine.isi('[data-element-id="response-block"] div:has(>audio):has(button), [data-element-id="response-block"] div:has(>[data-element-id="in-message-play-button"]) {display: none;}'),Mine.isi('\n[data-element-id="ai-characters-system-instruction-input"] {\n  height: 300px;\n}\n\n.enter-to-send {display:none;}\n\n[data-headlessui-state] button {\n  border-radius: 10px;\n}\n\n.firstLookbackMessage:before {\n  margin-bottom: 10px;\n  content: "——— context lookback starts ———";\n  opacity: 0;\n  display: block;\n  text-align: center;\n  color: gray;\n  font-style: italic;\n  transition: opacity 0.25s ease-in-out;\n}\n.firstLookbackMessage.visible:before {\n  opacity: 0.5;\n}\n\n/* pretty tables */\ntable {\n  padding: 2px;\n}\ntable thead {\n  background-color: rgba(0, 0, 0, 0.2);\n}\ntable tr td:first-child {\n  background-color: rgba(0, 0, 0, 0.2);\n}\n\n[data-element-id="response-block"] td,\n[data-element-id="response-block"] th {\n  padding: 6px !important;\n}\n\ntable tr:hover {\n  background-color: rgba(0, 0, 0, 0.4) !important;\n}\ntable tr:nth-child(even) {\n  background-color: rgba(0, 0, 0, 0.1);\n}\ntable tr th:first-child,\ntable tr td:first-child {\n  padding: 10px;\n}\n')),Mine.isi(".transition {transition-duration: 0s !important;}");const ensureSidebarClosedAsync=async()=>{getIsSideBarOpen()&&(document.body.clientWidth>1e3?(await MineTm.getSidebarToggleEleAsync()).click():Mine.qs('button:has([d="M6 18L18 6M6 6l12 12"])')?.click())},stopAiResponseAsync=async()=>{const e=await MineTm.getTaAsync(),t=e.value;t&&Mine.updateReactTypableFormValue(e,""),await Mine.getAnimationFrameAsync(),await MineTm.maybeClickStopButtonAsync(),t&&Mine.updateReactTypableFormValue(e,t),await Mine.sleep(100)},getIsSideBarOpen=()=>0===Mine.qs("#navbar")?.getBoundingClientRect().left,navigateMessageInDirection=e=>{const t=MineTm.getAllChatMsgEles();let n=t.findIndex(e=>{const t=e.getBoundingClientRect();return t.top>=0&&t.top<window.innerHeight});-1===n&&(n=0),n="up"===e?(n-1+t.length)%t.length:(n+1)%t.length,t[n]?.scrollIntoView({behavior:"smooth"})},cssForAttachmentIconWrapper='div:has(>svg):has([d="M15.758,9.134c-.293-.293-.768-.293-1.061,0l-4.773,4.773c-1.416,1.416-3.887,1.416-5.303,0-.708-.708-1.099-1.65-1.099-2.652s.391-1.943,1.099-2.651L9.57,3.654c.876-.876,2.305-.877,3.183,0,.877,.877,.877,2.305,0,3.182l-4.95,4.95c-.293,.292-.768,.292-1.061,0-.292-.292-.292-.769,0-1.061l4.772-4.773c.293-.293,.293-.768,0-1.061s-.768-.293-1.061,0l-4.772,4.773c-.425,.425-.659,.99-.659,1.591s.234,1.167,.659,1.591c.878,.877,2.306,.877,3.182,0l4.95-4.95c1.461-1.462,1.461-3.841,0-5.303-1.417-1.418-3.889-1.416-5.304,0L3.561,7.543c-.992,.991-1.538,2.31-1.538,3.712s.546,2.721,1.538,3.712c.991,.992,2.31,1.538,3.712,1.538s2.721-.546,3.712-1.538l4.773-4.773c.293-.293,.293-.768,0-1.061Z"])',showExtraScrollPaddingTemporarily=()=>{const e=Mine.isi('[data-element-id="scroll-padding"] {height:1000px;}');setTimeout(()=>e(),1e4)},main=async()=>{const verticalMoreIconPath="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z",stopIconPath="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z",cssDesktop=`\n/*${Mine.getCssToHide('[data-element-id="input-row"] div:has([data-element-id="prompt-library-small-button"])')}*/\n${Mine.getCssToQuietQs('[data-element-id="current-chat-title"]',{delayMs:0})}\n\n/* fix textarea position when sidebar open */\n[style="--current-sidebar-width: 384px;"] [style="max-width: 750px;"].w-full {\n  margin-left: 165px !important;\n}\n\n${cssForAttachmentIconWrapper} {cursor:pointer;}\ntextarea[data-element-id="new-system-instruction"],\ntextarea[placeholder*="Function Spec"],\ntextarea[placeholder*="JS code"]\n{\n  font-family: Courier New;\n  height: 400px;\n}\n\n.pb-safe:focus {outline:none;}\n\ndiv:has(>[data-element-id="send-button"]) {display: none;}\n[data-element-id="main-page-buttons-containter"] button {\n  opacity: 0.2;\n  transition: opacity 0.2s !important;\n}\n[data-element-id="main-page-buttons-containter"] button:hover {opacity: 1;}\n\n[data-element-id="user-message"] {\n  max-height: 502px;\n}\n\n[data-element-id="response-block"]:has([data-element-id="model-setting-info"]) {\n  border: 1px solid rgba(255,255,255,0.3);\n  opacity: 0.25;\n  margin-bottom: 25px;\n}\n\n[data-element-id="width-adjust-bar"] {display: none;}\n\n/* typing animation */\n[data-element-id="streaming-block"] [data-element-id="response-block"] div[data-element-id="ai-response"] p:last-of-type:after {\n  animation: blink 1s steps(5,start) infinite;\n  content: "▋";\n  vertical-align: baseline;\n}\n@keyframes blink {\n  0% {opacity: 1}\n  50% {opacity: 0}\n  to {opacity: 1}\n}\n\n\nbutton:has(polyline[points="5.5 12.25 2.25 9 5.5 5.75"]) {\n  margin-top: 55px;\n}\n\n/* context limit reached buton */\n[data-element-id="chat-space-middle-part"] .text-right button {display:none;}\n\n/* fix janky where it bounces down after responding. */\n/* fixed with my scroll override changes i think */\n/*[data-element-id="response-block"]:has([data-element-id="edit-message-button"]) {\n  margin-bottom: 25px;\n}\n*/\n\n[data-element-id="chat-space-middle-part"] {\n  padding-bottom: 126px !important;  /* when resuming a chat, it jumps bc it gets a wierdly tall margin */\n}\n\n/* stop button */\n[data-element-id="chat-space-background"] button:has([d="${stopIconPath}"]) {display:none;}\n\n.sticky div:has(>a[href^="https://blog.typingmind.com/"]) {\n  visibility: hidden;\n}\nbutton:has([d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"]):focus {outline:none;}\n#nav-buy-button {display:none;}\n#chat-input-textbox {\n  padding-left: 12px;\n}\n#chat-input-textbox + button {display:none;}\n.transition-all {\n  transition-property: none !important;\n}\n\n.user-avatar {\n  background: black;\n}\n\ndiv:has(>.pb-safe) {\n  border-bottom-width: 0;\n  border-top-left-radius: 10px;\n  border-top-right-radius: 10px;\n  opacity: 1;\n  transition: opacity 0.2s;\n}\ndiv:has(>.pb-safe):focus-within,\ndiv:has(>.pb-safe):hover{\n  opacity: 1;\n}\n\nbutton[data-element-id="output-settings-button"] {display:none;}\n    `.trim();isMobile||Mine.isi(cssDesktop);const addHotkeysAsync=async()=>{document.addEventListener("keypress",async e=>{if("body"!==e.target.tagName.toLowerCase())return;const t=async(e,{focusAfter:t=!0,send:n=!1}={})=>{const a=await MineTm.getTaAsync(),o=a.value.trimEnd(),i=`${o?`${o}\n\n`:""}${e}`;if(n)return await MineTm.sendMessageAsync(i),void(t&&a.focus());Mine.updateReactTypableFormValue(a,i),t?(a.focus(),a.setSelectionRange(a.value.length,a.value.length)):a.scrollTo({top:a.scrollHeight,behavior:"smooth"})},n=t=>{if(!MineTm.isEventModifierFree(e))return;const n=window.getSelection()?.toString().trim().replace(/:$/,"");n&&window.open(t(encodeURIComponent(n)))},a={"/":()=>MineTm.isEventModifierFree(e)&&MineTm.getTaAsync().then(e=>e.focus()),k:()=>MineTm.isEventModifierFree(e)&&navigateMessageInDirection("up"),j:()=>MineTm.isEventModifierFree(e)&&navigateMessageInDirection("down"),a:()=>n(e=>`https://www.amazon.com/s?k=${e}`),y:()=>n(e=>`https://www.youtube.com/results?search_query=${e}`),i:()=>n(e=>`https://www.google.com/search?q=${e}&udm=2`),t:()=>{const t=document.getSelection()?.toString();if(!t)return;e.preventDefault();const a=t.trim();!a.includes(" ")&&!a.includes("\n")&&a.length<20&&n(e=>`${window.location.origin}/#chat=${e}`)},g:()=>n(e=>`https://www.google.com/search?q=${e}`),e:async()=>{const n=document.getSelection()?.toString();if(!n)return;e.preventDefault();const a=MineTm.mapEachNonEmptyLine(n.trim(),e=>`> ${e}`),o=e.shiftKey&&!(e.altKey||e.ctrlKey||e.metaKey);await t(a+"\nelaborate",{focusAfter:!1,send:o})},l:()=>n(e=>`https://www.google.com/search?q=${e}&mineLucky=true`),u:()=>{const e=document.getSelection()?.toString()?.trim();if(!e)return;const t=!e.toLowerCase().startsWith("//")&&!e.toLowerCase().startsWith("http://")&&!e.toLowerCase().startsWith("https://");window.open((t?"//":"")+e)},q:async()=>{if(!MineTm.isEventModifierFree(e))return;e.preventDefault();const n=document.getSelection()?.toString();if(!n)return;const a=MineTm.mapEachNonEmptyLine(n.trim(),e=>`> ${e}`);await t(a+"\n")}},o=e.key.toLowerCase();o in a&&await a[o](e)})};setTimeout(addHotkeysAsync,500);const installArgumentRunnerAsync=async()=>{isMobile&&Mine.attachToElementContinuously(async()=>await Mine.waitForQs('[data-element-id="send-button"]',{recheckIntervalMs:1e3,timeoutMs:1/0}),async e=>{const t=async()=>{await postProcessTaForSubmissionAsync(),(await MineTm.getSendButtonAsync()).click(),(await MineTm.getTaAsync()).blur()};return e.addEventListener("touchend",t),()=>e.removeEventListener("touchend",t)});let e,t,n=!1;const a=()=>Mine.attachToElementContinuously(MineTm.getTaAsync,async e=>{e.addEventListener("keydown",async t=>{if(t.metaKey&&t.shiftKey&&"\\"===t.key)return t.preventDefault(),void(async()=>{const t=e.value,{selectionStart:n,selectionEnd:a}=e,o=t.lastIndexOf("\n",n-1)+1,i=t.indexOf("\n",a),s=t.substring(o,-1===i?t.length:i),r=[{start:o+s.match(/^\s*/)[0].length,end:i-(s.match(/\s*$/)[0].length||0)},{start:o,end:-1===i?t.length:i},(()=>{const e=t.split("\n"),n=t.substring(0,o).split("\n").length-1;let a=n;for(;a>0&&e[a-1].trim().length>0;)a--;let i=n;for(;i<e.length-1&&e[i+1].trim().length>0;)i++;return{start:e.slice(0,a).join("\n").length+(a>0?1:0),end:e.slice(0,i+1).join("\n").length}})(),{start:0,end:t.length}].find(e=>e.end-e.start>a-n);if(!r)return;e.setSelectionRange(r.start,r.end);const c=document.createRange(),l=document.createElement("span");l.textContent=t.substring(0,r.start),c.selectNodeContents(l)})();if(t.metaKey&&"d"===t.key){t.preventDefault();const n=e.selectionStart,a=e.value;if(e.selectionStart!==e.selectionEnd)return;let o=n,i=n;for(;o>0&&!/\s/.test(a.charAt(o-1));)o--;for(;i<a.length&&!/\s/.test(a.charAt(i));)i++;return void e.setSelectionRange(o,i)}if(t.metaKey&&"j"===t.key){t.preventDefault();const n=e.selectionStart,a=e.selectionEnd,o=e.value;if(n===a){const t=n;let a=t;for(;a>0&&"\n"!==o.charAt(a-1);)a--;let i=t,s=0;for(;i<o.length&&s<2;)"\n"===o.charAt(i)&&s++,i++;return 2===s&&i--,void e.setSelectionRange(a,i)}const i=o.substring(n,a).replace(/\n\s*/g," ").replace(/\s+/g," ");return e.setSelectionRange(n,a),void(document.execCommand("insertText",!1,i)||e.setRangeText(i,n,a,"end"))}if(t.metaKey&&"Enter"===t.key)return t.preventDefault(),showExtraScrollPaddingTemporarily(),void await MineTm.clickTaMaybeSubmitButtonWithPluginsEnabledEphemerallyAsync();if(MineTm.isEventModifierFree(t)){if("Escape"===t.key)return e.closest(".editing")?(Mine.updateReactTypableFormValue(e,""),void t.preventDefault()):await stopAiResponseAsync();if("Enter"===t.key){if(isMobile)return;e.closest(".editing")&&setTimeout(()=>{const e=`data-mine-processed-${MSG_ENRICH_PUIC_ID_BODY}`,t=Mine.qsaa(`[${e}]`).pop();t?.removeAttribute(e),enrichMessagesPresenationIdemp_lazyHydrated()},200),MineTm.getIsAiResponding()&&await MineTm.maybeClickStopButtonAsync(),await postProcessTaForSubmissionAsync(),showExtraScrollPaddingTemporarily(),(await MineTm.getSendButtonAsync()).click()}}});const a=()=>{const t=MineTm.getCurrentTargetChatModelFromUi();e.placeholder=`Message ${t} at ${((e=new Date)=>{const t=e.getHours();return`${t%12||12}:${e.getMinutes().toString().padStart(2,"0")}${t>=12?"pm":"am"}`})()}`.trim(),t.toLowerCase().includes("Gemini".toLowerCase())?e.style.setProperty("--placeholder-color","#E67E22"):e.style.removeProperty("--placeholder-color")};return["blur","focus"].forEach(t=>e.addEventListener(t,()=>requestAnimationFrame(a))),a(),(()=>{const e=new Date,n=1e3*(60-e.getSeconds())-e.getMilliseconds();setTimeout(()=>{a(),t=setInterval(a,6e4)},n)})(),e.addEventListener("blur",async()=>{await Mine.getAnimationFrameAsync();const t=document.activeElement;t&&['[data-element-id="search-input"]','[placeholder="Search AI agents..."]'].some(e=>t.matches(e))&&(Mine.simulateClick(e),e.focus())}),e.addEventListener("paste",t=>{const n=t.clipboardData.files;if(n.length){t.preventDefault();const a=new DataTransfer;Array.from(n).forEach(e=>a.items.add(e));const o=new DragEvent("drop",{bubbles:!0,cancelable:!0,dataTransfer:a});return void e.dispatchEvent(o)}const a=e.selectionStart;if(0!==a&&"\n"!==e.value[a-1])return;let o=(t.clipboardData||window.clipboardData).getData("text");if(o.length>32e3)return;if(!o.includes("\n"))return;var i;if(i=o.replace(/^"""\n?/,"").replace(/"""$/,""),o=i.trimEnd().replace(/^[\n\r]+/,""),!o?.trim())return;t.preventDefault();const s=`"""\n${o}\n"""\n\n`;e.focus(),document.execCommand("insertText",!1,s),e.scrollTo({top:e.scrollHeight,behavior:"smooth"})}),e.addEventListener("keydown",async t=>{if("v"===t.key&&t.metaKey&&t.ctrlKey){t.preventDefault();const n=await navigator.clipboard.readText();return await MineTm.simulateAddFileAttachment(n),await Mine.getAnimationFrameAsync(),e.focus(),await Mine.sleep(500),void e.focus()}if(!e.value)return;if(!t.metaKey)return;const n=e.value,a=e.selectionStart,o=e.selectionEnd,i=a!==o;if(t.metaKey&&"l"===t.key){t.preventDefault();const i=n.substring(0,a),s=(n.substring(o),i.lastIndexOf("\n")+1),r=n.indexOf("\n",o),c=-1===r?n.length:r+1;if(a===s&&o===c){const t=n.indexOf("\n",c);e.setSelectionRange(a,-1===t?n.length:t+1)}else e.setSelectionRange(s,c);return}if(t.metaKey&&"x"===t.key){if(i)return;t.preventDefault();const o=n.substring(0,a).lastIndexOf("\n")+1,s=n.indexOf("\n",a),r=-1===s?n.length:s+1,c=n.substring(o,r);await Mine.Extension.copyText(c),e.setSelectionRange(o,r),document.execCommand("delete"),e.setSelectionRange(o,o)}}),n||(Mine.isi(Mine.normalizeSpaceIndents('\n                textarea::placeholder {color: var(--placeholder-color, #757575) !important;transition: all 0.2s;}\n                textarea:not(:focus)::placeholder {opacity: 0.5;}\n                [data-element-id="chat-space-end-part"]{opacity: 1;}')),e.focus(),n=!0),MineTm.isMobile&&(async()=>{let t=!1,n=0,a=null;const o=async o=>{if(clearTimeout(a),MineTm.PushToTalk.pushToTalkState.isPttPhysicallyBeingHeld=!1,Date.now()-n<200)return e.focus(),void(t=!1);t=!1;const i=o.changedTouches?.[0],s=!!i&&i.clientX<window.innerWidth/2;e.classList.toggle("recordingReleasedAndFinalizing",!0),await Mine.sleep(1e3),await MineTm.PushToTalk.finishRecordingAsync({enablePlugins:s})};e.addEventListener("touchstart",async o=>{e.value.length||(o.preventDefault(),await(async()=>{t=!0,n=Date.now(),MineTm.PushToTalk.pushToTalkState.isPttPhysicallyBeingHeld=!0,a=setTimeout(async()=>{t&&await MineTm.PushToTalk.startRecordingAsync()},200)})())}),e.addEventListener("touchend",async n=>{e.value.length||(n.preventDefault(),t&&await o(n))}),e.addEventListener("touchcancel",async e=>{t&&await o(e)}),e.addEventListener("contextmenu",t=>!e.value.length&&t.preventDefault())})(),()=>{clearInterval(t)}},{onElementNotFound:async()=>{clearTimeout(e),clearInterval(t),e=setTimeout(()=>a(),500)}});a()};setTimeout(installArgumentRunnerAsync,500);const onSpaUrlChangeCallbacks=[],bindOnSpaUrlChangeAsync=async e=>{if(!onSpaUrlChangeCallbacks.length){const e=history.pushState,t=history.replaceState,n=()=>onSpaUrlChangeCallbacks.forEach(e=>e());history.pushState=function(){e.apply(this,arguments),n()},history.replaceState=function(){t.apply(this,arguments),n()},window.addEventListener("popstate",n)}onSpaUrlChangeCallbacks.push(e)};bindOnSpaUrlChangeAsync(()=>setTimeout(installHomepageMenuAsync,500)),bindOnSpaUrlChangeAsync(()=>notifiedAboutContextSizeMaxed=!1);const initTitleSanitizerServiceAsync=async()=>{const e=["TypingMind.com","TypingMind"];let t=document.title;const n=t=>{if(window.location.href===window.location.origin+"/")return MineTm.basicTypingMindDisplayNameAlias;if(t.includes(" — The best chat UI for AI"))return MineTm.basicTypingMindDisplayNameAlias;if(t.includes(" — LLM Frontend Chat UI for AI models"))return MineTm.basicTypingMindDisplayNameAlias;let n=e.reduce((e,t)=>{const n=new RegExp("( - )?"+t,"gi");return e.replace(n,"")},t);return n.trim()||(n=MineTm.basicTypingMindDisplayNameAlias),n};Object.defineProperty(document,"title",{get:function(){return t},set:function(e){const a=n(e);t=a,document.querySelector("title").textContent=a},configurable:!0}),document.title=n(t)};initTitleSanitizerServiceAsync(),Mine.isi('\n.fade-color-transition {\n  transition: color 0.2s ease-in-out;\n}\n[data-element-id="response-block"] .sticky + div >pre, .original-text pre {\n  background: transparent !important;\n  margin-bottom: 0 !important;\n}\n[data-element-id="response-block"] .sticky ~ div:not(.text-center) {\n  border: 1px solid RGBA(100,100,100,1);\n  border-radius: 0 0 7px 7px !important;\n  border-color: darkslategray;\n  background: rgb(0,0,0,0.4) !important;\n}\n');const selectElementText=e=>{const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)};document.body.clientWidth<1e3&&await ensureSidebarClosedAsync();const processItemsTickAsync=async()=>{Mine.processUnprocessedItems(Mine.qsaa("code.inline"),async e=>{e.classList.add("fade-color-transition"),e.style.color=e.innerText?.includes(" ")?"gray":await Mine.getHashedStringToHexAsync(e.innerText,getComputedStyle(e).backgroundColor),e.addEventListener("click",()=>selectElementText(e))},"code"),Mine.processUnprocessedItems(Mine.qsaa('[data-element-id="ai-response"] li'),e=>e.addEventListener("click",t=>{t.offsetX>=0||selectElementText(e)}),"list"),Mine.processUnprocessedItems(Mine.qsaa('[data-element-id="ai-response"] strong'),e=>e.addEventListener("click",t=>selectElementText(e)),"bolded"),Mine.processUnprocessedItems(Mine.qsaa('[data-element-id="response-block"] img[src^=blob]'),e=>{e.addEventListener("click",()=>{const t=e.getAttribute("src");t.startsWith("http")?window.open(t):fetch(t).then(e=>e.blob()).then(e=>{const t=URL.createObjectURL(e);window.open(t,"_blank")}).catch(e=>console.error("Error opening image:",e))}),e.style.cursor="pointer"},"img")};Mine.setIntervalAndNow(processItemsTickAsync,1e3);const[maybeMineCharKey,maybeMineCharVal]=window.location.hash.slice(1).split("=");if("mine_char"===maybeMineCharKey&&maybeMineCharVal){const[e,t]=maybeMineCharVal.split(",");await MineTm.startChatWithAgentFromHomeAsync(e),"q"!==t&&(await Mine.sleep(1e3),e.startsWith("Pepper")&&Mine.CommandBarBridge.execute("🎧 Call-in"))}Mine.bindHotkey("`",document,async e=>{["INPUT","TEXTAREA"].includes(document.activeElement?.tagName)||(window.location.hash.startsWith("#chat=")||Mine.qs('[data-element-id="workspace-tab-chat"]')?.click(),(await MineTm.getSidebarToggleEleAsync()).click())}),Mine.bindHotkey("Escape",document,async e=>await stopAiResponseAsync());const createWorkerExecutor=()=>{const e=Mine.normalizeSpaceIndents("\n        self.onmessage = e => {\n          const logs = [];\n          const MAX_LENGTH = 10000;\n\n          self.console.log = (...args) => {\n            const formatted = args.map(arg => {\n              if (typeof arg === 'object' && arg !== null) {\n                const stringified = JSON.stringify(arg, null, 2);\n                return stringified.length > MAX_LENGTH\n                  ? stringified.substring(0, MAX_LENGTH) + '...'\n                  : stringified;\n              }\n              return String(arg);\n            }).join(' ');\n\n            logs.push(formatted);\n          };\n\n          try {\n            (new Function(e.data))();\n            self.postMessage(logs);\n          } catch (error) {\n            self.postMessage({ error: error.message });\n          }\n        };\n      "),t=new Blob([e],{type:"application/javascript"}),n=URL.createObjectURL(t),a=new Worker(n);return{execute:e=>new Promise((t,o)=>{a.onmessage=e=>{e.data.error?o(e.data.error):t(e.data.join("\n")),a.terminate(),URL.revokeObjectURL(n)},a.onerror=e=>{o(e.message),a.terminate(),URL.revokeObjectURL(n)},a.postMessage(e)}),terminate:()=>{a.terminate(),URL.revokeObjectURL(n)}}},runCodeAsync=async e=>{const t=createWorkerExecutor();try{return await t.execute(e)}catch(e){throw e}finally{t.terminate()}},runCodeInlineAndGetLogs=async code=>{const logs=[];try{return await eval(`\n(async function(){\n  const console = {\n    log: function(...args) {\n      logs.push('[LOG] '+ args.map(arg =>\n        typeof arg === 'object' && arg !== null\n          ? JSON.stringify(arg, null, 2)\n          : String(arg)\n      ).join(' '));\n    },\n    error: function(...args) {\n      logs.push('[ERROR] ' + args.map(arg => String(arg)).join(' '));\n    },\n    table: function(data) {\n      logs.push('[~TABLE] ' + JSON.stringify(data, null, 2));\n    }\n  };\n  ${code}\n})();\n`),logs.join("\n")}catch(e){return logs.push("[ERROR] "+e.toString()),Mine.toastWarning("Run errored"),console.error(e),logs.join("\n")}},getMaybeSelectionInElement=e=>{const t=window.getSelection(),n=t.rangeCount>0?t.getRangeAt(0):null;return n&&e.contains(n.commonAncestorContainer)?{hasSelection:!0,selectedText:t.toString(),range:n}:null};Mine.puic(({nypf:e})=>Mine.qsaa(`${MineTm.finalizedResponseBlocksQs} [data-element-id="ai-response"] .sticky:${e}`),e=>{const t={"⊕ Absorb":{supportedLanguageIds:["javascript"],isMobileSupported:!1,classname:"absorb-code-btn",run:async({code:e,selectedCode:t=""})=>{let n=e;if(t){const e=t.split("\n");if(e.length<=1)return Mine.toastWarning("[Absorb] [noop] Selection too small"),!1;let a=0,o=e.length-1;for(;a<=o&&!e[a].trim();)a++;for(;o>=a&&!e[o].trim();)o--;const i=e.slice(a,o+1),s=e=>e.match(/^\s*/)[0].length;if(s(i[0])!==s(i[i.length-1]))return Mine.toastWarning("[Absorb] Start/end indent mismatch. Ensure selection contains entire lines (spaces will be handled)."),!1;const r=i.filter(e=>e.trim()).reduce((e,t)=>Math.min(e,s(t)),1/0);n=i.map(e=>e.slice(r)).join("\n")}try{const e=await fetch("http://localhost:3001/absorb-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:n})});if(!e.ok)return!1;const t=await e.json();return t.success?(t.message&&Mine.toastSuccess(`[Absorb] ${t.message}`),!0):(Mine.toastError(`[Absorb failed] ${t.message}`),!1)}catch{return Mine.toastError("[Absorb failed] Could not complete"),!1}}},Graph:{supportedLanguageIds:["dot"],isMobileSupported:!0,classname:"graphviz-btn",run:async({code:e,selectedCode:t=""})=>{var n;window.open((n=e.trim(),"https://dreampuf.github.io/GraphvizOnline/?fullscreen=true&engine=dot#"+encodeURIComponent(n)))}},"▶️ Exec & reply":{supportedLanguageIds:["javascript"],classname:"exec-and-reply-btn",run:async({code:e})=>{const t={remote:Mine.RemoteExec?.execAtControlAsync,local:runCodeInlineAndGetLogs},n=Object.keys(t).find(e=>!!t[e]),a=t[n];let o=n,i=await a(e).then(e=>"local"===n?e.trim():"remote"===n?(o=e.medium,e.output.trim()):void 0).catch(e=>(Mine.toastError(e),null));i||(i='[Execution produced no logs. Tip: "await myFunction()" pattern works best with this sandbox\'d executor]');const s=await MineTm.getTaAsync(),r=`\n  """Execution results (via eval on ${o} site)\n  ${i}\n  """\n  `.trim();Mine.updateReactTypableFormValue(s,r),(await MineTm.getSendButtonAsync()).click()}}},n=e.querySelector("button")?.classList?.toString();Object.entries(t).filter(([e,t])=>!MineTm.isMobile||!1!==t.isMobileSupported).filter(([t,n])=>n.supportedLanguageIds.some(t=>e.innerText.includes(t))).forEach(([t,a])=>{const o=document.createElement("button");o.className=`${a.classname||""} ${n??""}`.trim(),o.textContent=t,o.addEventListener("click",async()=>{o.disabled=!0,o.style.fontStyle="italic",o.style.cursor="progress";const t=e.parentElement.querySelector("code"),n=t.innerText,i=getMaybeSelectionInElement(t),s=i?.selectedText;await a.run({code:n,selectedCode:s}),o.disabled=!1,o.style.fontStyle="",o.style.cursor=""}),e.appendChild(o)})});const applyMonospaceToBlock=(e,t)=>{t.querySelector("code").style.whiteSpace="break-spaces"};let googleSearchApiKey,googleSearchEngineId,isGenericRenderingInitialized=!1;const replaceBodyEleWithHtml=(e,t,n,a={})=>{isGenericRenderingInitialized||(Mine.isi(Mine.normalizeSpaceIndents("\n          .rendered-content {\n            width: 100%;\n            height: 100%;\n            margin: 0;\n            opacity: 0;\n            transition: opacity 0.5s ease-in-out;\n          }\n          .content-container {\n            max-height: 0;\n            overflow: auto;\n            transition: max-height 0.6s ease-in-out;\n          }\n          .content-container.expanded {\n            max-height: 500px; /* Adjust based on expected content heights */\n          }\n          .original-text {\n            max-height: 200px; /* Initial height for the text */\n            opacity: 1;\n            overflow: hidden;\n            transition: max-height 0.4s ease-out, opacity 0.3s ease-out;\n            pointer-events: none;\n          }\n          .original-text.expanded {\n            overflow: auto;\n            pointer-events: auto;\n          }\n          .original-text.collapsing {\n            max-height: 0;\n            opacity: 0;\n          }\n        ")),isGenericRenderingInitialized=!0);const o=document.createElement("div");o.className="original-text",e.parentNode.insertBefore(o,e),o.appendChild(e);const i=document.createElement("div");i.className="content-container",o.parentNode.insertBefore(i,o);const s=n(i,a);return s.className+=" rendered-content",t.parentElement.style.overflow="hidden",setTimeout(()=>{o.classList.add("collapsing"),i.classList.add("expanded"),setTimeout(()=>s.style.opacity="1",100)},100),s},replaceBodyEleWithImage=(e,t,n,a={})=>replaceBodyEleWithHtml(n,t,(t,n)=>{const a=document.createElement("img");return a.title=JSON.stringify({...n,url:e},null,2),a.src=e,t.appendChild(a),a},a),replaceBodyEleWithIframe=(e,t,n,a={})=>replaceBodyEleWithHtml(n,t,(t,n)=>{const a=document.createElement("iframe");return a.src=e,t.appendChild(a),a},a),processLuckyGoogleImageBlockAsync=async(e,t)=>{const n={CACHE_KEY:"googleImageUrlCache",get:()=>{const e=sessionStorage.getItem(n.CACHE_KEY);return e?JSON.parse(e):{}},save:e=>{sessionStorage.setItem(n.CACHE_KEY,JSON.stringify(e))}};let a;try{a=JSON.parse(t.innerText)}catch(e){return}if(!a.query)return;Mine.dim(t.querySelector("code"));const o=a.query,i=a.imgType||null,s=await(async(e,t=null,a=5)=>{const o=JSON.stringify({query:e,imgType:t}),i=n.get();if(i[o])return i[o];googleSearchApiKey||(googleSearchApiKey=await MineTm.getMinePluginBasedSecretAsync("googleSearchApiKey"),googleSearchEngineId=await MineTm.getMinePluginBasedSecretAsync("googleSearchEngineId"));const s=`https://www.googleapis.com/customsearch/v1?key=${googleSearchApiKey}&cx=${googleSearchEngineId}&q=${encodeURIComponent(e)}&searchType=image&num=${a}${t?`&imgType=${t}`:""}`,r=await fetch(s);if(!r.ok)return console.error("API response error:",r.statusText),[];const c=await r.json();if(!c.items||0===c.items.length)return[];const l=c.items.map(e=>e.link);return i[o]=l,n.save(i),l})(o,i);if(0===s.length)return void console.error("No image URLs returned for query");const r=n=>{if(n>=s.length)return void console.error(`All ${s.length} images failed to load for query`);const o=s[n],i=(e=>`https://images.weserv.nl/?url=${encodeURIComponent(e)}`)(o);replaceBodyEleWithImage(i,e,t,{...a,url:o,attemptIndex:n}).onerror=()=>r(n+1)};r(0)},showGraphVizAsync=async(e,t,{isDraftState:n=!1}={})=>{const a=t.innerText.trim(),o=`iframe-${Date.now()}-${Math.floor(1e6*Math.random())}`;return replaceBodyEleWithHtml(t,e,(t,i)=>{const s=document.createElement("iframe");s.style.width="100%",s.style.border="none",s.style.overflow="hidden",s.id=o;const r=window.location.origin;window.addEventListener("message",e=>{e.origin===r&&"resize"===e.data?.type&&e.data?.iframeId===o&&(s.style.height=`${e.data.height}px`)});const c=e=>e.replace(/(digraph\s+\w*\s*\{)/i,'$1\n            graph [fontname="Atkinson Hyperlegible", fontsize=12, splines=curved];\n            node [fontname="Atkinson Hyperlegible", fontsize=12, style=filled, fillcolor="#ffffff", color="#333333"];\n            edge [fontname="Atkinson Hyperlegible", fontsize=10, color="#666666"];\n            bgcolor="#f5f5f5";\n          '),l=e=>{if(e.origin===r&&"ready"===e.data?.type&&e.data?.iframeId===o){const e=c(a);s.contentWindow.postMessage({type:"renderDot",dotCode:e,iframeId:o,preserveView:!1,isStreaming:n},r),window.removeEventListener("message",l)}};if(window.addEventListener("message",l),n&&e.parentElement){let t,n=a;const i=e=>{clearTimeout(t),t=setTimeout(()=>{(e=>{const t=c(e);s.contentWindow?.postMessage({type:"renderDot",dotCode:t,iframeId:o,preserveView:!0,isStreaming:!0},r)})(e)},50)};new MutationObserver(()=>{const t=e.parentElement.querySelector("code");if(t){const e=t.innerText.trim();e!==n&&(n=e,i(e))}}).observe(e.parentElement,{childList:!0,subtree:!0,characterData:!0})}return s.srcdoc=Mine.normalizeSpaceIndents(`\n          <!DOCTYPE html>\n          <html>\n          <head>\n            <meta charset="utf-8">\n            <style>\n              body, html {\n                margin: 0;\n                padding: 0;\n                width: 100%;\n                height: 100vh;\n                overflow: hidden;\n                background: #f5f5f5;\n              }\n              #graph {\n                width: 100%;\n                height: 100%;\n                cursor: grab;\n                overflow: hidden;\n                position: relative;\n                outline: none;\n              }\n              #graph.grabbing {\n                cursor: grabbing;\n              }\n              #graph svg {\n                width: 100%;\n                height: 100%;\n              }\n              .error {\n                padding: 20px;\n                color: #d32f2f;\n                background: #ffebee;\n                border: 1px solid #ffcdd2;\n                border-radius: 4px;\n                font-family: "Atkinson Hyperlegible", sans-serif;\n                white-space: pre-wrap;\n              }\n              .loading {\n                padding: 20px;\n                text-align: center;\n                font-family: "Atkinson Hyperlegible", sans-serif;\n                color: #666666;\n              }\n              .streaming-overlay {\n                position: absolute;\n                top: 12px;\n                right: 12px;\n                background: rgba(255, 255, 255, 0.9);\n                color: #666666;\n                padding: 6px 10px;\n                border-radius: 4px;\n                font-family: "Atkinson Hyperlegible", sans-serif;\n                font-size: 11px;\n                font-weight: 400;\n                z-index: 1000;\n                pointer-events: none;\n                backdrop-filter: blur(1px);\n                box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);\n                border: 1px solid rgba(0, 0, 0, 0.1);\n                opacity: 0.8;\n                max-width: 150px;\n              }\n            </style>\n            <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:wght@400;700&display=swap" rel="stylesheet">\n            <script src="https://unpkg.com/@viz-js/viz@3.2.4/lib/viz-standalone.js"><\/script>\n            <script>\n              const iframeId = "${o}";\n              const parentOrigin = "${r}";\n\n              let lastReportedHeight = 0;\n              const updateParentHeight = () => {\n                const height = Math.max(document.body.scrollHeight, 400);\n                if (height !== lastReportedHeight) {\n                  lastReportedHeight = height;\n                  window.parent.postMessage({\n                    type: 'resize',\n                    height,\n                    iframeId\n                  }, parentOrigin);\n                }\n              };\n\n              let currentViewBox = null;\n              let svgElement = null;\n\n              const autocompleteDotGraph = (partialDot) => {\n                const trimmed = partialDot.trim();\n                if (!trimmed) return 'digraph G {}';\n\n                const lines = trimmed.split('\\n');\n                const lastLine = lines[lines.length - 1];\n                if (/^\\}/.test(lastLine)) return trimmed;\n\n                // Not complete - remove the last (incomplete) line\n                const withoutLastLine = lines.slice(0, -1).join('\\n');\n                let fixed = withoutLastLine;\n\n                // count unclosed braces\n                let braceDepth = 0;\n                let inString = false;\n                let stringChar = null;\n\n                for (let i = 0; i < fixed.length; i++) {\n                  const char = fixed[i];\n                  const prevChar = fixed[i-1];\n\n                  if (!inString && (char === '"' || char === "'")) {\n                    inString = true;\n                    stringChar = char;\n                  } else if (inString && char === stringChar && prevChar !== '\\\\') {\n                    inString = false;\n                  }\n\n                  if (!inString) {\n                    if (char === '{') braceDepth++;\n                    if (char === '}') braceDepth--;\n                  }\n                }\n\n                // Close unclosed string if needed\n                if (inString) fixed += stringChar;\n\n                // Close unclosed braces\n                while (braceDepth > 0) {\n                  fixed += '\\n}';\n                  braceDepth--;\n                }\n\n                // Ensure basic structure\n                if (!fixed.match(/^\\s*(digraph|graph)\\s+/i)) {\n                  fixed = 'digraph G {\\n' + fixed + '\\n}';\n                }\n\n                return fixed;\n              };\n\n              const renderGraphviz = (dotCode, preserveView = false, isStreaming = false) => {\n                if (preserveView && svgElement) {\n                  currentViewBox = svgElement.getAttribute('viewBox');\n                }\n\n                let processedDotCode;\n                try {\n                  processedDotCode = autocompleteDotGraph(dotCode);\n                } catch (error) {\n                  console.error('autocompleteDotGraph failed:', error);\n\n                  // Fallback to original code or minimal graph\n                  processedDotCode = dotCode.trim() || 'digraph G { a -> b; }';\n                }\n\n                Viz.instance().then(viz => {\n                  try {\n                    const svg = viz.renderSVGElement(processedDotCode);\n                    const container = document.getElementById('graph');\n                    container.innerHTML = '';\n                    container.appendChild(svg);\n\n                    // remove the tooltip creator\n                    container.querySelectorAll('title').forEach(title => title.remove());\n\n                    svgElement = container.querySelector('svg');\n                    const bbox = svgElement.getBBox();\n\n                    let currentAnimation = null;\n                    const animateViewBox = (fromVB, toVB, duration = 300) => {\n                      if (currentAnimation) {\n                        cancelAnimationFrame(currentAnimation);\n                        currentAnimation = null;\n                      }\n\n                      const startTime = performance.now();\n                      const fromValues = fromVB.split(' ').map(Number);\n                      const toValues = toVB.split(' ').map(Number);\n\n                      const animate = now => {\n                        const elapsed = now - startTime;\n                        const progress = Math.min(elapsed / duration, 1);\n                        const eased = 1 - Math.pow(1 - progress, 3);\n\n                        const currentValues = fromValues.map((fromVal, i) =>\n                          fromVal + (toValues[i] - fromVal) * eased\n                        );\n\n                        svgElement.setAttribute('viewBox', currentValues.join(' '));\n\n                        if (progress < 1) {\n                          currentAnimation = requestAnimationFrame(animate);\n                        } else {\n                          currentAnimation = null;\n                        }\n                      };\n\n                      currentAnimation = requestAnimationFrame(animate);\n                    };\n\n                    const calculateFitViewBox = () => {\n                      const containerAspect = container.clientWidth / container.clientHeight;\n                      const contentAspect = bbox.width / bbox.height;\n\n                      let fitWidth, fitHeight, fitX, fitY;\n\n                      if (containerAspect > contentAspect) {\n                        fitHeight = bbox.height * 1.1;\n                        fitWidth = fitHeight * containerAspect;\n                        fitX = bbox.x + bbox.width/2 - fitWidth/2;\n                        fitY = bbox.y + bbox.height/2 - fitHeight/2;\n                      } else {\n                        fitWidth = bbox.width * 1.1;\n                        fitHeight = fitWidth / containerAspect;\n                        fitX = bbox.x + bbox.width/2 - fitWidth/2;\n                        fitY = bbox.y + bbox.height/2 - fitHeight/2;\n                      }\n\n                      return \`\${fitX} \${fitY} \${fitWidth} \${fitHeight}\`;\n                    };\n                    const fitViewBox = calculateFitViewBox();\n                    if (isStreaming && currentViewBox) {\n                      // Start with preserved view\n                      svgElement.setAttribute('viewBox', currentViewBox);\n                      animateViewBox(currentViewBox, fitViewBox, 100);\n                    } else {\n                      svgElement.setAttribute('viewBox', fitViewBox);\n                    }\n\n                    const originalViewBox = fitViewBox;\n                    const originalViewBoxValues = originalViewBox.split(' ').map(Number);\n                    const minZoomWidth = originalViewBoxValues[2] * 0.1;\n                    const minZoomHeight = originalViewBoxValues[3] * 0.1;\n\n                    svgElement.setAttribute('viewBox', preserveView && currentViewBox ? currentViewBox : originalViewBox);\n                    svgElement.setAttribute('preserveAspectRatio', 'xMidYMid meet');\n\n                    // Pan functionality\n                    let isPanning = false;\n                    let startX, startY, viewBoxValues;\n\n                    const handleMouseDown = (e) => {\n                      container.focus();\n                      isPanning = true;\n                      container.classList.add('grabbing');\n                      startX = e.clientX;\n                      startY = e.clientY;\n                      viewBoxValues = svgElement.getAttribute('viewBox').split(' ').map(Number);\n                      e.preventDefault();\n                    };\n\n                    const handleMouseMove = (e) => {\n                      if (!isPanning) return;\n\n                      const dx = (startX - e.clientX) * (viewBoxValues[2] / container.clientWidth);\n                      const dy = (startY - e.clientY) * (viewBoxValues[3] / container.clientHeight);\n\n                      let newX = viewBoxValues[0] + dx;\n                      let newY = viewBoxValues[1] + dy;\n\n                      // Constrain to keep graph visible\n                      const maxX = bbox.x + bbox.width - viewBoxValues[2] * 0.1;  // Keep 10% visible\n                      const minX = bbox.x - viewBoxValues[2] * 0.9;\n                      const maxY = bbox.y + bbox.height - viewBoxValues[3] * 0.1;\n                      const minY = bbox.y - viewBoxValues[3] * 0.9;\n\n                      newX = Math.max(minX, Math.min(maxX, newX));\n                      newY = Math.max(minY, Math.min(maxY, newY));\n\n                      svgElement.setAttribute('viewBox',\n                        \`\${newX} \${newY} \${viewBoxValues[2]} \${viewBoxValues[3]}\`\n                      );\n                    };\n\n                    const handleMouseUp = () => {\n                      isPanning = false;\n                      container.classList.remove('grabbing');\n                    };\n\n                    const handleDoubleClick = (e) => {\n                      e.preventDefault();\n                      const scale = 0.4;\n                      const currentVB = svgElement.getAttribute('viewBox');\n                      const vb = currentVB.split(' ').map(Number);\n\n                      const rect = container.getBoundingClientRect();\n                      const mouseX = e.clientX - rect.left;\n                      const mouseY = e.clientY - rect.top;\n\n                      const svgX = vb[0] + (mouseX / container.clientWidth) * vb[2];\n                      const svgY = vb[1] + (mouseY / container.clientHeight) * vb[3];\n\n                      // Check if we can zoom in more\n                      const newWidth = vb[2] * scale;\n                      const newHeight = vb[3] * scale;\n                      const canZoom = newWidth >= minZoomWidth && newHeight >= minZoomHeight;\n\n                      let targetVB;\n                      if (canZoom) {\n                        // Zoom in and center\n                        const newX = svgX - newWidth / 2;\n                        const newY = svgY - newHeight / 2;\n                        targetVB = \`\${newX} \${newY} \${newWidth} \${newHeight}\`;\n                      } else {\n                        // Just center without zooming\n                        const newX = svgX - vb[2] / 2;\n                        const newY = svgY - vb[3] / 2;\n                        targetVB = \`\${newX} \${newY} \${vb[2]} \${vb[3]}\`;\n                      }\n\n                      animateViewBox(currentVB, targetVB, 250);\n                    };\n\n                    const handleWheel = (e) => {\n                      e.preventDefault();\n                      e.stopPropagation();\n\n                      const scale = e.deltaY > 0 ? 1.03 : 0.97;\n                      const vb = svgElement.getAttribute('viewBox').split(' ').map(Number);\n\n                      const newWidth = vb[2] * scale;\n                      const newHeight = vb[3] * scale;\n\n                      // Prevent zooming in too far\n                      if (scale < 1 && (newWidth < minZoomWidth || newHeight < minZoomHeight)) return;\n\n                      // Prevent zooming out too far - graph should fill at least 25% of viewport\n                      if (scale > 1) {\n                        const graphFitsInQuadrant = bbox.width < newWidth / 2 && bbox.height < newHeight / 2;\n                        if (graphFitsInQuadrant) return;\n                      }\n\n                      const rect = container.getBoundingClientRect();\n                      const mouseX = e.clientX - rect.left;\n                      const mouseY = e.clientY - rect.top;\n\n                      const percentX = mouseX / container.clientWidth;\n                      const percentY = mouseY / container.clientHeight;\n\n                      const newX = vb[0] - (newWidth - vb[2]) * percentX;\n                      const newY = vb[1] - (newHeight - vb[3]) * percentY;\n\n                      svgElement.setAttribute('viewBox', \`\${newX} \${newY} \${newWidth} \${newHeight}\`);\n\n                      return false;\n                    };\n\n                    const copySvgAsPng = async () => {\n                      try {\n                        const svg = document.querySelector('#graph svg');\n                        if (!svg) {\n                          console.log('No SVG found to copy');\n                          return;\n                        }\n\n                        // Get the actual content bounds, not the viewBox\n                        const bbox = svg.getBBox(); // This gets the tight bounds of actual content\n\n                        // Add minimal padding (5% of content size)\n                        const padding = Math.max(bbox.width, bbox.height) * 0.05;\n                        const contentX = bbox.x - padding;\n                        const contentY = bbox.y - padding;\n                        const contentWidth = bbox.width + (padding * 2);\n                        const contentHeight = bbox.height + (padding * 2);\n\n                        // High resolution scale\n                        const scale = 4; // 4x for super crisp rendering\n                        const canvas = document.createElement('canvas');\n                        const ctx = canvas.getContext('2d');\n\n                        canvas.width = contentWidth * scale;\n                        canvas.height = contentHeight * scale;\n\n                        // Scale context and fill with pure white\n                        ctx.scale(scale, scale);\n                        ctx.fillStyle = '#ffffff';\n                        ctx.fillRect(0, 0, contentWidth, contentHeight);\n\n                        // Clone SVG and set tight viewBox\n                        const svgClone = svg.cloneNode(true);\n                        svgClone.setAttribute('viewBox', \`\${contentX} \${contentY} \${contentWidth} \${contentHeight}\`);\n                        svgClone.setAttribute('width', contentWidth);\n                        svgClone.setAttribute('height', contentHeight);\n                        svgClone.style.background = 'white';\n\n                        // Serialize with proper encoding\n                        const svgData = new XMLSerializer().serializeToString(svgClone);\n                        const svgDataUrl = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgData)));\n\n                        const img = new Image();\n\n                        img.onload = async function() {\n                          // Draw at exact content dimensions\n                          ctx.drawImage(img, 0, 0, contentWidth, contentHeight);\n\n                          canvas.toBlob(async function(blob) {\n                            try {\n                              await navigator.clipboard.write([\n                                new ClipboardItem({\n                                  'image/png': blob\n                                })\n                              ]);\n\n                              const overlay = document.createElement('div');\n                              overlay.style.cssText = \`\n                                position: fixed;\n                                top: 20px;\n                                right: 20px;\n                                background: #4caf50;\n                                color: white;\n                                padding: 8px 16px;\n                                border-radius: 4px;\n                                font-family: "Atkinson Hyperlegible", sans-serif;\n                                font-size: 12px;\n                                z-index: 10000;\n                                pointer-events: none;\n                                box-shadow: 0 2px 8px rgba(0,0,0,0.2);\n                              \`;\n                              overlay.textContent = \`Graph copied!\`;\n                              document.body.appendChild(overlay);\n\n                              setTimeout(() => overlay.remove(), 2000);\n\n                            } catch (err) {\n                              console.error('Failed to copy: ', err);\n                            }\n                          }, 'image/png', 1.0);\n                        };\n\n                        img.src = svgDataUrl;\n\n                      } catch (err) {\n                        console.error('Copy failed: ', err);\n                      }\n                    };\n\n\n                    const handleKeyDown = (e) => {\n                      const vb = svgElement.getAttribute('viewBox').split(' ').map(Number);\n                      const panDistance = Math.min(vb[2], vb[3]) * 0.15; // 15% of smallest dimension\n\n                      let newX = vb[0];\n                      let newY = vb[1];\n                      let handled = false;\n\n                      switch(e.key) {\n                        case 'c':\n                        case 'C':\n                          if (!e.ctrlKey && !e.metaKey) { // Avoid conflict with Ctrl+C\n                            copySvgAsPng();\n                            handled = true;\n                          }\n                          break;\n                        case 'ArrowLeft':\n                          newX = Math.max(bbox.x - vb[2] * 0.9, vb[0] - panDistance);\n                          handled = true;\n                          break;\n                        case 'ArrowRight':\n                          newX = Math.min(bbox.x + bbox.width - vb[2] * 0.1, vb[0] + panDistance);\n                          handled = true;\n                          break;\n                        case 'ArrowUp':\n                          newY = Math.max(bbox.y - vb[3] * 0.9, vb[1] - panDistance);\n                          handled = true;\n                          break;\n                        case 'ArrowDown':\n                          newY = Math.min(bbox.y + bbox.height - vb[3] * 0.1, vb[1] + panDistance);\n                          handled = true;\n                          break;\n                        case 'r':  // reset\n                        case '0':\n                          const currentVB = svgElement.getAttribute('viewBox');\n                          animateViewBox(currentVB, originalViewBox, 400);\n                          handled = true;\n                          break;\n                      }\n\n                      if (handled) {\n                        e.preventDefault();\n                        if (e.key.startsWith('Arrow')) {\n                          const currentVB = svgElement.getAttribute('viewBox');\n                          const targetVB = \`\${newX} \${newY} \${vb[2]} \${vb[3]}\`;\n                          animateViewBox(currentVB, targetVB, 200); // Faster for arrow keys\n                        }\n                      }\n                    };\n\n                    // Only add event listeners on first render, not streaming updates\n                    if (!isStreaming || !container.hasAttribute('data-listeners-added')) {\n                      // Add event listeners\n                      container.addEventListener('mousedown', handleMouseDown);\n                      window.addEventListener('mousemove', handleMouseMove);\n                      window.addEventListener('mouseup', handleMouseUp);\n                      container.addEventListener('dblclick', handleDoubleClick);\n                      container.addEventListener('wheel', handleWheel, { passive: false });\n                      container.addEventListener('keydown', handleKeyDown);\n                      document.addEventListener('keydown', handleKeyDown);\n\n                      container.addEventListener('touchmove', (e) => {\n                        e.preventDefault();\n                      }, { passive: false });\n\n                      container.setAttribute('data-listeners-added', 'true');\n                    }\n\n                    updateParentHeight();\n                  } catch (error) {\n                    console.error('GraphViz rendering error:', error);\n                    if (isStreaming) {\n                      // Instead of replacing content, add overlay to existing graph\n                      const container = document.getElementById('graph');\n\n                      // Remove any existing overlay first\n                      const overlayClassName = 'streaming-overlay';\n                      const existingOverlay = container.querySelector('.'+overlayClassName);\n                      if (existingOverlay) existingOverlay.remove();\n\n                      // Only add overlay if we have existing content to preserve\n                      const waitingMsg = 'Awaiting completable fragment...';\n                      if (container.querySelector('svg')) {\n                        const overlay = document.createElement('div');\n                        overlay.className = overlayClassName;\n                        overlay.innerHTML = waitingMsg;\n                        container.appendChild(overlay);\n                      } else {\n                        // Fallback for first render\n                        container.innerHTML = '<div class="loading">'+waitingMsg+'</div>';\n                      }\n                    } else {\n                      document.getElementById('graph').innerHTML =\n                        \`<div class="error">GraphViz Error:\n\${error.message}</div>\`;\n                    }\n                    updateParentHeight();\n                  }\n                }).catch(error => {\n                  console.error('GraphViz initialization error:', error);\n                  document.getElementById('graph').innerHTML =\n                    \`<div class="error">Failed to initialize GraphViz:\\n\${error.message}</div>\`;\n                  updateParentHeight();\n                });\n              };\n\n              // Listen for DOT code from parent\n              window.addEventListener('message', (event) => {\n                if (event.origin !== parentOrigin) return;\n                if (event.data?.type === 'renderDot' && event.data?.iframeId === iframeId) {\n                  renderGraphviz(\n                    event.data.dotCode,\n                    event.data.preserveView,\n                    event.data.isStreaming\n                  );\n                }\n              });\n\n              document.addEventListener('DOMContentLoaded', () => {\n                document.getElementById('graph').innerHTML = '<div class="loading">Loading GraphViz...</div>';\n                updateParentHeight();\n\n                // Signal ready to receive DOT code\n                window.parent.postMessage({\n                  type: 'ready',\n                  iframeId\n                }, parentOrigin);\n\n                const maxFlexibleWindowSecs = 3;\n                const windowSizeRecheckIntervalMs = 500;\n                const startTime = Date.now();\n\n                const checkInterval = setInterval(() => {\n                  updateParentHeight();\n                  if (Date.now() - startTime >= maxFlexibleWindowSecs*1000) {\n                    clearInterval(checkInterval);\n                  }\n                }, windowSizeRecheckIntervalMs);\n              });\n            <\/script>\n          </head>\n          <body>\n            <div id="graph" tabindex="0"></div>\n          </body>\n          </html>\n        `),t.appendChild(s),s},{})},showMarkdownAsync=async(e,t,{isDraftState:n=!1,languageId:a=""}={})=>{const o=t.innerText.trim(),i=`iframe-${Date.now()}-${Math.floor(1e6*Math.random())}`;return replaceBodyEleWithHtml(t,e,(t,a)=>{const s=document.createElement("iframe");s.style.width="100%",s.style.border="none",s.style.overflow="hidden",s.id=i;const r=window.location.origin;let c;if(window.addEventListener("message",e=>{e.origin===r&&"resize"===e.data?.type&&e.data?.iframeId===i&&(s.style.height=`${e.data.height+16}px`)}),s.srcdoc=`\n            <!DOCTYPE html>\n            <html>\n            <head>\n              <meta charset="utf-8">\n              <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"><\/script>\n              <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible+Next:wght@300;400;500;600;700&display=swap" rel="stylesheet">\n              <style>\n                body {\n                  margin: 0;\n                  padding: 16px;\n                  font-family: "Atkinson Hyperlegible Next", ui-sans-serif, system-ui, sans-serif;\n                  -webkit-font-smoothing: antialiased;\n                  text-rendering: optimizeLegibility;\n                  line-height: 1.6;\n                  background-color: #0d1117;\n                  color: #c9d1d9;\n                  transition: background-color 0.3s ease;\n                }\n\n                body.flash-success {\n                  animation: flashGreen 0.4s ease;\n                }\n\n                @keyframes flashGreen {\n                  0% { background-color: #0d1117; }\n                  50% { background-color: #0f3d0f; }\n                  100% { background-color: #0d1117; }\n                }\n\n                #markdown-source { display: none; }\n\n                /* Headers */\n                h1, h2, h3, h4, h5, h6 {\n                  margin-top: 0.5em;\n                  margin-bottom: 0.25em;\n                  color: #f0f6fc;\n                }\n                h1 { border-bottom: 2px solid #21262d; padding-bottom: 0.3em; }\n                h2 { border-bottom: 1px solid #21262d; padding-bottom: 0.3em; }\n\n                /* Code */\n                code {\n                  background: #161b22;\n                  color: #f85149;\n                  padding: 0.2em 0.4em;\n                  border-radius: 3px;\n                  font-family: 'SF Mono', Monaco, Consolas, monospace;\n                }\n\n                pre {\n                  background: #161b22;\n                  padding: 16px;\n                  border-radius: 6px;\n                  overflow-x: auto;\n                  border: 1px solid #30363d;\n                }\n\n                pre code {\n                  background: none;\n                  padding: 0;\n                  color: #c9d1d9;\n                }\n\n                /* Text emphasis */\n                strong { color: #58a6ff; }\n                em { color: #79c0ff; }\n\n                /* Lists */\n                ul, ol { padding-left: 20px; }\n                li { margin: 0.25em 0; }\n\n                /* Blockquotes */\n                blockquote {\n                  border-left: 4px solid #30363d;\n                  padding-left: 16px;\n                  margin-left: 0;\n                  color: #8b949e;\n                }\n\n                /* Tables */\n                table {\n                  border-collapse: collapse;\n                  width: 100%;\n                  margin: 1em 0;\n                }\n\n                th, td {\n                  border: 1px solid #30363d;\n                  padding: 8px 12px;\n                  text-align: left;\n                }\n\n                th {\n                  background-color: #161b22;\n                  font-weight: 600;\n                  color: #f0f6fc;\n                }\n\n                /* Links */\n                a { color: #58a6ff; text-decoration: none; }\n                a:hover { text-decoration: underline; }\n\n                /* Horizontal rules */\n                hr {\n                  border: none;\n                  border-top: 1px solid #30363d;\n                  margin: 2em 0;\n                }\n\n                /* Footnotes as superscript */\n                sup { color: #58a6ff; cursor: pointer; }\n              </style>\n\n              <script>\n                const iframeId = "${i}";\n                const parentOrigin = "${r}";\n                let currentMarkdown = '';\n\n                const updateParentHeight = () => {\n                  const height = document.body.scrollHeight;\n                  window.parent.postMessage({\n                    type: 'resize',\n                    height,\n                    iframeId\n                  }, parentOrigin);\n                };\n\n                // todo: maybe get rid of this bc it might cause issues if u are sharing code or something? maybe fine\n                const processFootnotes = (html) => {\n                  // Convert [^note] style footnotes to superscript\n                  return html.replace(/\\[\\^([^\\]]+)\\]/g, '<sup>$1</sup>');\n                };\n\n                const renderMarkdown = (markdown) => {\n                  currentMarkdown = markdown;\n                  const content = document.getElementById('content');\n\n                  try {\n                    // Create custom renderer for links\n                    const renderer = new marked.Renderer();\n                    renderer.link = function(token) {\n                      const href = token.href || '';\n                      const title = token.title || '';\n                      const text = this.parser.parseInline(token.tokens);\n\n                      // Escape attributes\n                      const escapedHref = href.replace(/"/g, '&quot;');\n                      const titleAttr = title ? ' title="' + title.replace(/"/g, '&quot;') + '"' : '';\n\n                      // ALL links open in new tab\n                      return '<a href="' + escapedHref + '"' + titleAttr + ' target="_blank" rel="noopener noreferrer">' + text + '</a>';\n                    };\n\n                    // Use marked with custom renderer\n                    let html = marked.parse(markdown, {\n                      gfm: true,\n                      tables: true,\n                      renderer: renderer,\n                      breaks: true\n                    });\n\n                    // Post-process for footnotes\n                    html = processFootnotes(html);\n\n                    content.innerHTML = html;\n                    updateParentHeight();\n                  } catch (err) {\n                    console.error('Markdown rendering error:', err);\n                    content.innerHTML = '<p style="color: #f85149;">Error rendering markdown</p>';\n                    updateParentHeight();\n                  }\n                };\n\n                const createRichTextForClipboard = () => {\n                  try {\n                    // Create clean HTML for clipboard\n                    let html = marked.parse(currentMarkdown, {\n                      gfm: true,\n                      tables: true\n                    });\n\n                    // Process footnotes for clipboard\n                    html = processFootnotes(html);\n\n                    // Create styled HTML string\n                    const styles = [\n                      'font-family: Verdana, Geneva, sans-serif;',\n                      'color: #333;',\n                      'line-height: 1.6;',\n                      'font-size: 14px;'\n                    ].join(' ');\n\n                    const styledHtml = '<div style="' + styles + '">' + html + '</div>';\n\n                    return styledHtml;\n                  } catch (err) {\n                    console.error('Error creating clipboard content:', err);\n                    return '<div>Error processing content</div>';\n                  }\n                };\n\n                const copyRichText = async () => {\n                  try {\n                    const richHtml = createRichTextForClipboard();\n\n                    // Create blob and clipboard item\n                    const htmlBlob = new Blob([richHtml], { type: 'text/html' });\n                    const textBlob = new Blob([currentMarkdown], { type: 'text/plain' });\n\n                    const clipboardItem = new ClipboardItem({\n                      'text/html': htmlBlob,\n                      'text/plain': textBlob\n                    });\n\n                    await navigator.clipboard.write([clipboardItem]);\n\n                    // Flash animation\n                    document.body.classList.add('flash-success');\n                    setTimeout(() => {\n                      document.body.classList.remove('flash-success');\n                    }, 400);\n\n                    return true;\n                  } catch (err) {\n                    console.error('Failed to copy:', err);\n                    // Fallback to plain text\n                    try {\n                      await navigator.clipboard.writeText(currentMarkdown);\n                      document.body.classList.add('flash-success');\n                      setTimeout(() => {\n                        document.body.classList.remove('flash-success');\n                      }, 400);\n                    } catch (fallbackErr) {\n                      console.error('Fallback copy failed:', fallbackErr);\n                    }\n                    return false;\n                  }\n                };\n\n                const replaceContent = (newMarkdown) => {\n                  renderMarkdown(newMarkdown);\n                };\n\n                window.addEventListener('message', (event) => {\n                  if (event.origin !== parentOrigin) return;\n                  if (event.data?.type !== 'updateContent' || event.data?.iframeId !== iframeId) return;\n\n                  const newMarkdown = event.data.markdown;\n                  replaceContent(newMarkdown);\n                });\n\n                document.addEventListener('DOMContentLoaded', () => {\n                  const observer = new MutationObserver(updateParentHeight);\n                  observer.observe(document.body, {\n                    childList: true,\n                    subtree: true,\n                    attributes: true,\n                    characterData: true,\n                  });\n\n                  // Handle cmd+click for copying\n                  document.addEventListener('click', async (e) => {\n                    if (e.metaKey || e.ctrlKey) {\n                      e.preventDefault();\n                      e.stopPropagation();\n                      await copyRichText();\n                    }\n                  });\n\n                  // Render initial markdown from textarea\n                  const markdownSource = document.getElementById('markdown-source');\n                  if (markdownSource) {\n                    renderMarkdown(markdownSource.value);\n                  }\n                });\n              <\/script>\n            </head>\n            <body>\n              <textarea id="markdown-source">${o.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</textarea>\n              <div id="content"></div>\n              <div id="post-content"></div>\n            </body>\n            </html>\n          `,n&&e.parentElement){let t=o;new MutationObserver(()=>{const n=e.parentElement.querySelector("code");if(n){const e=n.innerText.trim();e!==t&&(t=e,(e=>{clearTimeout(c),c=setTimeout(()=>(e=>{s.contentWindow?.postMessage({type:"updateContent",markdown:e,iframeId:i},r)})(e),50)})(e))}}).observe(e.parentElement,{childList:!0,subtree:!0,characterData:!0})}return t.appendChild(s),s},{})},showHtmlAsync=async(e,t,{isDraftState:n=!1,languageId:a=""}={})=>{const o=t.innerText.trim(),i=`iframe-${Date.now()}-${Math.floor(1e6*Math.random())}`;return replaceBodyEleWithHtml(t,e,(t,s)=>{const r=document.createElement("iframe");r.style.width="100%",r.style.border="none",r.style.overflow="hidden",r.id=i;const c=window.location.origin;let l;if(window.addEventListener("message",e=>{e.origin===c&&"resize"===e.data?.type&&e.data?.iframeId===i&&(r.style.height=`${e.data.height}px`)}),r.srcdoc=Mine.normalizeSpaceIndents(`\n            <!DOCTYPE html>\n            <html>\n            <head>\n              <meta charset="utf-8">\n              <style>\n                body { margin: 0; padding: 0; }\n\n                #content-stack {\n                  position: relative;\n                }\n\n                .content-layer {\n                  transition: opacity 100ms ease-out;\n                  opacity: 0;\n                }\n\n                .content-layer.active {\n                  opacity: 1;\n                }\n\n                .content-layer:not(:last-child) {\n                  position: absolute;\n                  top: 0;\n                  left: 0;\n                  width: 100%;\n                }\n              </style>\n              <script>\n                const iframeId = "${i}";\n                const parentOrigin = "${c}";\n                const languageId = "${a}";\n\n                let layerCounter = 0;\n\n                let lastReportedHeight = 0;\n                const updateParentHeight = () => {\n                  const height = document.body.scrollHeight;\n\n                  if (height !== lastReportedHeight) {\n                    lastReportedHeight = height;\n                    window.parent.postMessage({\n                      type: 'resize',\n                      height,\n                      iframeId\n                    }, parentOrigin);\n                  }\n                };\n\n                const maybeUpdateStyle = () => {\n                  if (languageId === 'svg') {\n                    const svg = document.querySelector('svg');\n                    const backgroundRect = svg?.querySelector('rect');\n\n                    if (backgroundRect) {\n                      const fill = backgroundRect.getAttribute('fill');\n                      const svgWidth = svg.getAttribute('width') || svg.getAttribute('viewBox')?.split(' ')[2];\n                      const svgHeight = svg.getAttribute('height') || svg.getAttribute('viewBox')?.split(' ')[3];\n                      const rectWidth = backgroundRect.getAttribute('width');\n                      const rectHeight = backgroundRect.getAttribute('height');\n\n                      if (rectWidth == svgWidth && rectHeight == svgHeight) {\n                        document.body.style.backgroundColor = fill;\n                      }\n                    }\n                  }\n                };\n\n                const addContentLayer = (newHtml) => {\n                  const stack = document.getElementById('content-stack');\n                  const currentLayerId = ++layerCounter;\n\n                  // Create new layer\n                  const newLayer = document.createElement('div');\n                  newLayer.className = 'content-layer';\n                  newLayer.dataset.layerId = currentLayerId;\n                  newLayer.innerHTML = newHtml;\n\n                  // Get reference to previous layer before adding new one\n                  const previousLayer = stack.querySelector('.content-layer:last-child');\n\n                  // Add new layer to stack\n                  stack.appendChild(newLayer);\n\n                  // Force reflow then fade in\n                  newLayer.offsetHeight;\n                  newLayer.classList.add('active');\n\n                  // Schedule cleanup of previous layer after 100ms\n                  if (previousLayer) {\n                    setTimeout(() => {\n                      // Only remove if it's still the previous layer (not removed by newer update)\n                      if (previousLayer.parentNode === stack) {\n                        previousLayer.remove();\n                      }\n                    }, 100);\n                  }\n\n                  maybeUpdateStyle();\n                  updateParentHeight();\n                };\n\n                const replaceContent = (newHtml) => {\n                  const stack = document.getElementById('content-stack');\n                  stack.innerHTML = \`<div class="content-layer active">\${newHtml}</div>\`;\n                  maybeUpdateStyle();\n                  updateParentHeight();\n                };\n\n                window.addEventListener('message', (event) => {\n                  if (event.origin !== parentOrigin) return;\n                  if (event.data?.type !== 'updateContent' || event.data?.iframeId !== iframeId) return;\n\n                  const newHtml = event.data.html;\n\n                  if (languageId === 'svg') {\n                    addContentLayer(newHtml);\n                  } else {\n                    replaceContent(newHtml);\n                  }\n                });\n\n                document.addEventListener('DOMContentLoaded', () => {\n                  const initialLayer = document.querySelector('.content-layer');\n                  if (initialLayer) {\n                    initialLayer.classList.add('active');\n                  }\n\n                  const maxFlexibleWindowSecs = 3;\n                  const windowSizeRecheckIntervalMs = 500;\n\n                  const startTime = Date.now();\n\n                  const checkInterval = setInterval(() => {\n                    updateParentHeight();\n\n                    if (Date.now() - startTime >= maxFlexibleWindowSecs*1000) {\n                      clearInterval(checkInterval);\n                    }\n                  }, windowSizeRecheckIntervalMs);\n\n                  // Initial check\n                  updateParentHeight();\n                  maybeUpdateStyle();\n                });\n              <\/script>\n              <style>\n                .langId-svg {\n                  text-align: center;\n                }\n              </style>\n            </head>\n            <body>\n              <div id="content-stack" class="langId-${a}">\n                <div class="content-layer">${o}</div>\n              </div>\n            </body>\n            </html>\n          `),n&&e.parentElement){let t=o;new MutationObserver(()=>{const n=e.parentElement.querySelector("code");if(n){const e=n.innerText.trim();e!==t&&(t=e,(e=>{clearTimeout(l),l=setTimeout(()=>(e=>{r.contentWindow?.postMessage({type:"updateContent",html:e,iframeId:i},c)})(e),50)})(e))}}).observe(e.parentElement,{childList:!0,subtree:!0,characterData:!0})}return t.appendChild(r),r},{})};let replicateApiKey;const processAiArtBlockAsync=async(e,t)=>{let n;try{n=JSON.parse(t.innerText)}catch(e){return}if(!n.query)return;Mine.dim(t.querySelector("code"));const a=await async function(e,{modelId:t="stability-ai/sdxl",aspectRatio:n="16:9",disableSafetyChecker:a=!0,goFast:o=!0}={}){replicateApiKey||(replicateApiKey=await MineTm.getMinePluginBasedSecretAsync("replicateApiKey"));const i="https://proxy-mine.fly.dev/?url=",s="https://api.replicate.com/v1",r=i+encodeURIComponent(`${s}/models/${t}/predictions`);let c={};c="black-forest-labs/flux-dev"===t?{prompt:e,guidance:3.5,num_inference_steps:30,aspect_ratio:n,disable_safety_checker:a,go_fast:o}:"black-forest-labs/flux-pro"===t?{prompt:e,guidance:3,steps:25,aspect_ratio:n,output_quality:80,safety_tolerance:6}:{prompt:e,negative_prompt:"low quality, blurry, distorted",num_inference_steps:30,aspect_ratio:n,disable_safety_checker:a};const l={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Token ${replicateApiKey}`},body:JSON.stringify({input:c})},d=await fetch(r,l);if(!d.ok){const e=await d.text();let t;try{t=JSON.parse(e)}catch(n){t={error:e.substring(0,200)+"..."}}throw new Error(`Failed to create prediction: ${JSON.stringify(t)}`)}const m=await d.json(),p=i+encodeURIComponent(`${s}/predictions/${m.id}`);let u,g=0;for(;g<60;){g++;const e=await fetch(p,{headers:{Authorization:`Token ${replicateApiKey}`}});if(!e.ok){const t=await e.text();let n;try{n=JSON.parse(t)}catch(e){n={error:t.substring(0,200)+"..."}}console.error(`Error polling prediction (attempt ${g}):`,n),await new Promise(e=>setTimeout(e,3e3));continue}if(u=await e.json(),"succeeded"===u.status)break;if("failed"===u.status)throw new Error(`Image generation failed: ${u.error||"Unknown error"}`);if("canceled"===u.status)throw new Error("Image generation was canceled");await new Promise(e=>setTimeout(e,3e3))}if(g>=60)throw new Error("Timed out waiting for image generation");const h=u.output;return Array.isArray(h)?h[0]:h}(n.query,{modelId:"black-forest-labs/flux-pro",aspectRatio:"16:9",disableSafetyChecker:!0,goFast:!0}).catch(e=>console.error("Error:",e.message));replaceBodyEleWithImage(a,e,t,n)},codeOutputClassname="mine_code_output",processJavascriptBlockAsync=async(e,t)=>{const n=t.querySelector("code"),a=n.innerText.trim();if([".createElement","<script","<html"].some(e=>a.includes(e)))return;const o=a.split("\n");let i=o[o.length-1];if(i.startsWith("let ")||i.startsWith("const ")||i.match(/^[a-zA-Z0-9]+\s?=/)){const e=i.split("=")[0].split(" ").filter(e=>!!e.trim()).pop();i=`console.log(${e})`,o.push(i)}if(o.slice(o.length-3).some(e=>e.startsWith("console.log("))){let e;try{e=await runCodeAsync(o.join("\n"))}catch(t){if(t.toString().startsWith("ReferenceError:")||t.toString().split("\n")[0].trim().endsWith(" is not defined"))try{const t=[...n.closest('[data-element-id="response-block"]').querySelectorAll(`code:not(.${codeOutputClassname})`)],a=[];for(const e of t){if(e===n)break;a.push(e.innerText)}const i=a.join("\n")+"\n\n"+o.join("\n");e=await runCodeAsync(i)}catch(e){}}if(e){const t=document.createElement("code");t.classList.add(codeOutputClassname),t.innerHTML=e,n.after(t),requestAnimationFrame(()=>{requestAnimationFrame(()=>{t.style.opacity=1})})}}},installPuicCodeBlockAsync=async(e=!0,t=[])=>{const n=e?'[data-element-id="streaming-block"] [data-element-id="ai-response"] .sticky':`${MineTm.finalizedResponseBlocksQs} .sticky`;Mine.puic(({nypf:e})=>Mine.qsaa(`${n}:${e}`),async n=>{const a=n.nextSibling,o=n.innerText.trim().split("\n"),i=1===o.length?"txt":o[0];if(i in t){const o=t[i];await Promise.all(o.map(t=>t(n,a,{isDraftState:e,languageId:i}))),await Mine.sleep(1e3);const s=()=>n.parentElement.querySelector(".collapsing"),r=()=>n.parentElement.querySelector(".expanded");if(!s()||!r())return;const c=document.createElement("button");c.textContent="▼ Previewing";const l=n.querySelector("button")?.classList?.toString();c.className=l,c.classList.add("active");let d=!0;c.addEventListener("click",async()=>{const e=s(),t=r();e.classList.remove("collapsing"),e.classList.add("expanded"),t.classList.remove("expanded"),t.classList.add("collapsing"),d=!d,c.textContent=d?"▼ Previewing":"▶ Preview"}),n.appendChild(c)}},(e?"streaming-":"finalized-")+"code-block-processor")};installPuicCodeBlockAsync(!0,{txt:[applyMonospaceToBlock],text:[applyMonospaceToBlock],markdown:[showMarkdownAsync],md:[showMarkdownAsync],svg:[showHtmlAsync],html:[showHtmlAsync],dot:[showGraphVizAsync],graphviz:[showGraphVizAsync]}),installPuicCodeBlockAsync(!1,{txt:[applyMonospaceToBlock],text:[applyMonospaceToBlock],markdown:[showMarkdownAsync],md:[showMarkdownAsync],html:[showHtmlAsync],svg:[showHtmlAsync],dot:[showGraphVizAsync],graphviz:[showGraphVizAsync],luckygoogleimage:[processLuckyGoogleImageBlockAsync],js:[processJavascriptBlockAsync],javascript:[processJavascriptBlockAsync],aiart:[processAiArtBlockAsync]}),Mine.isi(Mine.normalizeSpaceIndents("\n      .mine_code_output {\n        font-size: 12.25px;\n        display: block;\n        font-style: italic;\n        color: gray;\n        margin-top: 7px;\n        overflow: hidden;\n        transition: opacity 0.2s, background 0.1s;\n        position: absolute;\n        right: 7px;\n        top: 20px;\n        border-left: 2px solid gray;\n        padding: 10px;\n        border-radius: 6px;\n        opacity: 0;\n        background: black;\n      }\n      .mine_code_output:hover {\n        opacity: 0.1 !important;\n      }")),isMobile||installNotesV4Async(),window.addEventListener("beforeunload",stopAiResponseAsync)},installNotesV4Async=async()=>{const e=document.createElement("div");e.innerHTML='\n  <style>\n    .mine_notes_wrapper {\n      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n      opacity: 0.2 !important;\n      position: fixed;\n      right: -12.9%;\n      top: 60px;\n      background: rgb(39, 39, 42);\n      width: 15%;\n      border-radius: 10px 0 0 10px;\n      border-width: 2px;\n      height: 36px;\n      padding: 0;\n      margin: 0;\n      display: flex;\n      flex-direction: column;\n      overflow: hidden;\n    }\n\n    .mine_notes_wrapper:hover {\n      opacity: 1 !important;\n    }\n\n    .mine_notes_wrapper:has(.mine_notes:not(:placeholder-shown)) {\n      right: -2px;\n      height: calc(100vh - 60px - 100px);\n    }\n\n    .mine_status {\n      font-size: 11px;\n      color: #eee;\n      padding: 3px 7px;\n      text-align: right;\n      background: rgba(20, 20, 25, 0.95);\n      border-bottom: 1px solid #444;\n      user-select: none;\n      letter-spacing: 0.5px;\n    }\n\n    .mine_notes {\n      width: 100%;\n      height: 100%;\n      background: transparent;\n      color: white;\n      line-height: 1.1em;\n      padding: 7px;\n      border: none;\n      resize: none;\n      border-radius: 0 0 0 8px;\n      flex-grow: 1;\n    }\n\n    .mine_notes:focus {\n      outline: none !important;\n      box-shadow: none !important;\n    }\n  </style>\n  <div class="mine_notes_wrapper">\n    <div class="mine_status">0 items</div>\n    <textarea class="mine_notes" placeholder="📝 Notes..." title="[M] Notepad"></textarea>\n  </div>\n  ',document.body.append(e);const t=e.querySelector(".mine_notes_wrapper"),n=e.querySelector(".mine_notes"),a=e.querySelector(".mine_status"),o="mine_notes",i=e=>{const t=(e=>{const t=e.trim();return t?t.split(/\n\s*\n+/).filter(e=>e.trim().length>0).length:0})(e);a.textContent=`${t} item${1===t?"":"s"}`},s=()=>{const e=localStorage.getItem(o)||"";n.value=e,i(e)};s();const r=Mine.debounce(()=>{localStorage.setItem(o,n.value),requestAnimationFrame(()=>t.style.borderColor="green")},500);n.addEventListener("input",()=>{t.style.borderColor="orange",i(n.value),r()}),window.addEventListener("storage",e=>{e.key===o&&s()})},unloadMaybeLoadingStyler=()=>Mine.qs("#mine_loader_styler")?.remove();isMobile?unloadMaybeLoadingStyler():([680,748,831].includes(document.body.clientWidth)||MineTm.getSidebarToggleEleAsync().then(async e=>{e.click(),unloadMaybeLoadingStyler()}),window.addEventListener("resize",ensureSidebarClosedAsync)),main();const installCustomConfigItemsAsync=async()=>{let uncollapseAiResponsesFn;bindOnSelectorClick('[data-element-id="config-buttons"]',async()=>{const menu=await Mine.waitForQs('#elements-in-action-buttons [id^="headlessui-menu-items-"]'),myMenuWrapperId="mine-config-addons";if(menu.querySelector(`#${myMenuWrapperId}`))return;const newDiv=document.createElement("div");newDiv.id=myMenuWrapperId,newDiv.style="border-top: 1px solid rgba(255,255,255,0.15);padding-top: 10px;padding-bottom:5px;overflow:auto;max-height:300px;";const buttonConfigs=[null,isMobile?{html:'<button id="mine-debug-eval" class="mine-menu-btn">eval()</button>',loader:async()=>{menu.querySelector("#mine-debug-eval").addEventListener("click",()=>{const p=prompt("Enter javascript to eval()");function exec(code){try{return eval(code)}catch(e){return console.error("Execution error:",e),e.toString()}}p?.trim()&&exec(p)})}}:null,{html:`<button id="mine-collapse-resp" class="mine-menu-btn">${uncollapseAiResponsesFn?"Uncollapse":"Collapse"} responses</button>`,loader:()=>{}},{html:'<button id="mine-del-tts-by-prefix" class="mine-menu-btn">rm tts cache item</button>',loader:()=>{}}].filter(Boolean),style=Mine.normalizeSpaceIndents("\n        <style>\n        .mine-menu-btn {\n          width: 100%;\n          padding-top: 0.5rem;\n          padding-bottom: 0.5rem;\n        }\n        .mine-menu-btn.half {\n          width: 48%;\n        }\n        .mine-menu-btn[disabled] {\n          color: gray;\n        }\n        </style>\n        ");newDiv.innerHTML=style+buttonConfigs.map(e=>e.html).join("\n").trim(),menu.appendChild(newDiv),buttonConfigs.map(e=>e.loader());const hideConfigMenu=()=>(Mine.simulateClick(Mine.qs('[data-element-id="chat-space-background"]')),!0);menu.querySelector("#mine-del-tts-by-prefix").addEventListener("click",()=>window.dispatchEvent(new CustomEvent("del-tts-by-prefix"))),menu.querySelector("#mine-collapse-resp").addEventListener("click",()=>{uncollapseAiResponsesFn?(uncollapseAiResponsesFn(),uncollapseAiResponsesFn=null):uncollapseAiResponsesFn=Mine.isi('[data-element-id="ai-response"] {max-height: 112px;overflow: scroll;}'),hideConfigMenu()})})};setTimeout(installCustomConfigItemsAsync,500),bindOnSelectorClick('[data-element-id="send-button"]',()=>{getIsChatScrolledToNearBottom(1200)||(MineTm.turnOffJsScrollingInstantly(),setTimeout(MineTm.turnOnJsScrollingInstantly,3e3))});const installPinnedMsgScrollerAsync=async()=>{bindOnSelectorClick('button:has([d="M878.3 392.1L631.9 145.7c-6.5-6.5-15-9.7-23.5-9.7s-17 3.2-23.5 9.7L423.8 306.9c-12.2-1.4-24.5-2-36.8-2-73.2 0-146.4 24.1-206.5 72.3a33.23 33.23 0 0 0-2.7 49.4l181.7 181.7-215.4 215.2a15.8 15.8 0 0 0-4.6 9.8l-3.4 37.2c-.9 9.4 6.6 17.4 15.9 17.4.5 0 1 0 1.5-.1l37.2-3.4c3.7-.3 7.2-2 9.8-4.6l215.4-215.4 181.7 181.7c6.5 6.5 15 9.7 23.5 9.7 9.7 0 19.3-4.2 25.9-12.4 56.3-70.3 79.7-158.3 70.2-243.4l161.1-161.1c12.9-12.8 12.9-33.8 0-46.8zM666.2 549.3l-24.5 24.5 3.8 34.4a259.92 259.92 0 0 1-30.4 153.9L262 408.8c12.9-7.1 26.3-13.1 40.3-17.9 27.2-9.4 55.7-14.1 84.7-14.1 9.6 0 19.3.5 28.9 1.6l34.4 3.8 24.5-24.5L608.5 224 800 415.5 666.2 549.3z"])',async e=>{(await Mine.waitFor(()=>{const e=Mine.qsaa('[data-element-id="pop-up-modal"] [data-element-id="response-block"]');return e.length?e:null})).forEach(e=>e.addEventListener("touchend",async()=>{const t=e.innerText,n=Mine.qsaa('[data-element-id="response-block"]').filter(t=>t!==e).find(e=>e.innerText===t);n&&(await Mine.waitFor(()=>!Mine.qs('[data-element-id="pop-up-modal"]')),await Mine.sleep(1e3),n.scrollIntoView({behavior:"smooth"}))}))})};isMobile&&installPinnedMsgScrollerAsync();const highlightQuoteSource=(e,t)=>{if(!e||!t)return null;let n=null;const a=e=>{if(e.nodeType===Node.TEXT_NODE)return(e=>{const a=e.textContent.indexOf(t);if(a>=0){if(e.parentElement&&"MARK"===e.parentElement.tagName&&e.parentElement.textContent===t)return n=e.parentElement,!0;const o=document.createRange();o.setStart(e,a),o.setEnd(e,a+t.length);const i=(()=>{const e=document.createElement("mark");return e.className=MINE_QUOTE_SRC_CLASSNAME,e})();return o.surroundContents(i),n=i,!0}return!1})(e);if(e.nodeType===Node.ELEMENT_NODE){if("MARK"===e.tagName&&e.textContent===t)return n=e,!0;if(e.childNodes)for(let t=0;t<e.childNodes.length;t++)if(a(e.childNodes[t]))return!0}return!1};return a(e),n},MINE_QUOTE_CLASSNAME="mine_quote",MINE_QUOTE_SRC_CLASSNAME="mine_quote_src",MINE_TRIPLE_QUOTE_CLASSNAME="mine_triple_quote_block",MINE_TRIPLE_QUOTE_TITLEBAR_CLASSNAME="mine_triple_quote_titlebar_block",MINE_TRIPLE_QUOTE_CONTENT_CLASSNAME="mine_triple_quote_content_block",MINE_SYSTEM_NOTE_QUOTE_CLASSNAME="mine_system_note_block",installQuotabilityAsync=async()=>{Mine.isi(Mine.normalizeSpaceIndents(`\n      .${MINE_TRIPLE_QUOTE_CLASSNAME} {\n        display: inline-block;\n        width: 100%;\n        color: gray;\n        background-color: rgba(0, 0, 0, 0.2);\n        border-radius: 5px;\n        border: 1px solid #333;\n        overflow: auto;\n        min-width: min-content;\n        margin-bottom: -6px;\n      }\n      .${MINE_TRIPLE_QUOTE_TITLEBAR_CLASSNAME} {\n        height: 26px;\n        background-color: #444;\n        padding: 2px 10px;\n        font-size: 14px;\n        color: ghostwhite;\n        display: flex;\n        align-items: center;\n        white-space: nowrap;\n      }\n      .${MINE_TRIPLE_QUOTE_CONTENT_CLASSNAME} {\n        padding: 10px;\n        max-height: 219px;\n        overflow: auto;\n        font-size: 15px;\n        line-height: 18px;\n      }\n\n      .${MINE_QUOTE_CLASSNAME} {\n        font-style: italic;\n        color: gray;\n        cursor: pointer;\n      }\n\n      .${MINE_QUOTE_SRC_CLASSNAME} {\n        background: mediumslateblue;\n        border-radius: 3px;\n        color: black !important;\n        cursor: pointer;\n      }\n\n      .${MINE_SYSTEM_NOTE_QUOTE_CLASSNAME} {\n        color: #888888;\n        font-style: italic;\n      }\n      `)),bindOnSelectorClick(`.${MINE_QUOTE_CLASSNAME}`,async e=>highlightForQuoteEle(e,!0)),bindOnSelectorClick(`.${MINE_QUOTE_SRC_CLASSNAME}`,async e=>window.getSelection().isCollapsed&&Mine.qsaa(".mine_quote").find(t=>t.innerText===`> ${e.innerText}`)?.scrollIntoView({behavior:"smooth"}))},highlightForQuoteEle=(e,t=!1)=>{const n=e.closest('[data-element-id="user-message"]'),a=Mine.qsaa('[data-element-id="ai-response"], [data-element-id="user-message"]'),o=Array.from(a).filter(e=>e.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_FOLLOWING),i=e.innerText.substring(1).trim(),s=o.reverse().find(e=>e.innerText.includes(i));if(!s)return;const r=highlightQuoteSource(s,i);t&&(r??s).scrollIntoView({behavior:"smooth"})},quotify=e=>{const t=e.innerHTML.split("\n").map(e=>{if(e.trim().startsWith("&gt; ")||e.trim().startsWith("> ")){const t=e.replace(/^>\s/,"&gt; ").replace(/&gt;\s/,"&gt; ");return`<span class="${MINE_QUOTE_CLASSNAME}">${t}</span>`}return e});e.innerHTML=t.join("\n"),[...e.querySelectorAll(`.${MINE_QUOTE_CLASSNAME}`)].forEach(e=>highlightForQuoteEle(e))},tripleQuotify=e=>{let t=e.innerHTML;t=t.replace(/(?:"""|\`\`\`)([^\n]*?)\s*\n([\s\S]*?)\n\s*(?:"""|\`\`\`)/g,(e,t,n)=>{const a=t.trim();return`<div class="${MINE_TRIPLE_QUOTE_CLASSNAME}">${a?`<div class="${MINE_TRIPLE_QUOTE_TITLEBAR_CLASSNAME}">${a}</div>`:""}<div class="${MINE_TRIPLE_QUOTE_CONTENT_CLASSNAME}">${n.trim()}</div></div>`}),e.innerHTML=t},systemMessagify=e=>{let t=e.innerHTML;t=t.replace(/^\[System note\]\s(.*?)$/gm,(e,t)=>`<div class="${MINE_SYSTEM_NOTE_QUOTE_CLASSNAME}">[System note] ${t}</div>`),e.innerHTML=t},hrIfy=e=>{let t=e.innerHTML;t=t.replace(/^---$/gm,"<hr/>"),e.innerHTML=t};{const{trigger:e}=await Mine.puic(({nypf:e})=>MineTm.isBeingScrolled?[]:Mine.qsaa(`[data-element-id="user-message"] div:${e}`),e=>{quotify(e),tripleQuotify(e),systemMessagify(e),hrIfy(e)},MSG_ENRICH_PUIC_ID_BODY);enrichMessagesPresenationIdemp_lazyHydrated=e,Mine.attachToElementContinuously(async()=>await Mine.waitForQs(".dynamic-chat-content-container",{recheckIntervalMs:1e3,timeoutMs:6e5}),async e=>Mine.addEventListenerForDirectChildrenChange(e,e=>{e.added?.length&&Mine.getAnimationFrameAsync().then(()=>enrichMessagesPresenationIdemp_lazyHydrated())}))}installQuotabilityAsync();const installCitabilityAsync=()=>{Mine.isi(Mine.normalizeSpaceIndents('\n      blockquote {\n        transition: all 0.2s;\n        background: rgb(0, 0, 0, 0.2);\n        border-radius: 9px;\n      }\n      .mine-cite-verified {\n        border-color: darkslateblue;\n      }\n      .mine-cite-verified::after {\n        content: "quotes you";\n        display: inline-block;\n        background: darkslateblue;\n        color: white;\n        padding: 3px 4px;\n        border-radius: 0 4px 9px 9px;\n        font-size: 10px;\n        margin-left: -18px;\n        font-family: Arial, sans-serif;\n        letter-spacing: 0.3px;\n        opacity: 0;\n        transform: scaleY(0);\n        transform-origin: top;\n        animation: fadeInBadge 0.2s ease-out forwards;\n      }\n\n      @keyframes fadeInBadge {\n        from {\n          opacity: 0;\n          transform: scaleY(0);\n        }\n        to {\n          opacity: 1;\n          transform: scaleY(1);\n        }\n      }\n    '));const e=async e=>{Mine.pui(Mine.qsaa("blockquote"),e=>{const t=e.innerText,n=Mine.qsaa('[data-element-id="user-message"]').find(e=>e.innerText.includes(t));n&&e.classList.add("mine-cite-verified")})};document.addEventListener("numMsgsInChatChanged",e),setTimeout(e,3e3)};!isMobile&&installCitabilityAsync();const installCodeHoverAsync=async()=>{const e=()=>Mine.pui(Mine.qsaa("code"),e=>(e=>{const t=e.closest("*:has(>.sticky)").querySelector(".sticky")?.innerText.trim().toLowerCase().startsWith("taskpaper");t&&(e.innerHTML=e.innerText.split("\n").map(e=>{let t=0;if(e.startsWith("\t")){const n=e.match(/^(\t+)/);t=n?n[1].length:0}else{const n=e.match(/^( +)/);t=n?Math.floor(n[1].length/2):0}const n={0:"inherit",1:"gray",2:"dimgray",3:"#444444"};return`<span style='display:block; color:${n[Math.min(t,Object.keys(n).length-1)]};'>${e||"&nbsp;"}</span>`}).join(""));const n=Mine.qsaa("span",e);e.addEventListener("mouseover",e=>{if("SPAN"!==e.target.tagName)return;const a=e.target.textContent.trim();a&&n.filter(e=>e.textContent.trim()===a).forEach(e=>(e=>{t||(e.style.border="1px solid hotpink",e.style.margin="-1px",e.style.borderRadius="3px")})(e))}),e.addEventListener("mouseout",e=>{"SPAN"===e.target.tagName&&n.forEach(e=>(e=>{e.style.border="",e.style.margin="",e.style.borderRadius=""})(e))})})(e),"code-token-colorizer");e(),document.addEventListener("numMsgsInChatChanged",()=>e())};!isMobile&&setTimeout(()=>installCodeHoverAsync(),2e3);const installFavicoAsync=async()=>{const e="https://i.ibb.co/hLZVQdK/image-15-1.png",t=e=>{Array.from(Mine.qsaa("link[rel*='icon']")).forEach(e=>e.remove());const t=document.createElement("link");t.type="image/x-icon",t.rel="shortcut icon",t.href=e,document.head.appendChild(t),document.body.appendChild(t.cloneNode())};for(let n=0;n<5;n++)setTimeout(()=>t(e),1e3*n);let n;const a=()=>document.title.startsWith("(*) ");document.addEventListener("visibilitychange",()=>{document.hidden?(t(e),new Promise(e=>{let o=0,i=!1;n=setInterval(()=>{const s=a(),r=MineTm.getIsAiResponding();return s?(clearInterval(n),void e("newMsg")):(r&&!i&&(t("https://i.ibb.co/NdsWDYhX/image.png"),i=!0),i&&!r?(clearInterval(n),void e(a()?"newMsg":"normal")):void(60===++o&&(clearInterval(n),e("normal"))))},1e3)}).then(n=>{t("newMsg"===n?"https://i.ibb.co/XJnJv5p/image-18.png":e)})):(n&&(clearInterval(n),n=null),t(e))})};installFavicoAsync();const installToggleHideStuffOnDblActionAsync=async()=>{let e;Mine.isi("#chat-input-textbox:not(:empty) {max-width: 1000px !important;}"),MineTm.isMobile&&document.body.addEventListener("dblclick",async e=>{const t=e.target;"TEXTAREA"===t.tagName||"INPUT"===t.tagName||t.isContentEditable||await Mine.CommandBar.open()});let t,n=!1;const a=[...MineTm.fsQssToMakeInvisible,...MineTm.fsQssToMakeInvisibleAndUndisplay],o=Mine.normalizeSpaceIndents(`\n    ${a.join(",\n")} {\n      opacity: 1;\n      transition: opacity 200ms ease-in-out;\n    }\n    ${a.map(e=>`.fs-hide ${e}`).join(",\n")} {\n      opacity: 0;\n      pointer-events: none;\n    }\n    ${a.filter(e=>!MineTm.fsQssToMakeInvisible.includes(e)).map(e=>`.fs-undisplay ${e}`).join(",\n")} {display: none !important;}\n    `);Mine.isi(o);let i=!1;const s=async()=>{await MineTm.getTaAsync(),clearTimeout(e),n?(await Mine.sleep(200),t&&(t(),t=null),document.body.classList.remove("fs-undisplay"),document,document.body.classList.remove("fs-hide"),e=setTimeout(s,15e3)):(i||(Mine.isi(Mine.normalizeSpaceIndents('\n            [data-element-id="chat-input-actions"] {\n              max-height: 100px;\n              transition: max-height 0.2s;\n            }\n            ')),i=!0),t||(t=Mine.isi(MineTm.fsOtherCss)),await MineTm.getAnimationFrameAsync(),document.body.classList.add("fs-hide"),setTimeout(()=>document.body.classList.add("fs-undisplay"),200)),n=!n};s(),document.addEventListener("mineToggleFullscreen",()=>s())};installToggleHideStuffOnDblActionAsync();const installAttachmentClickActionAsync=async()=>{bindOnSelectorClick(cssForAttachmentIconWrapper,async(e,t)=>{const n=e.closest('[class*="message-index-"]');if(!n)return Mine.toastWarning("Couldn't find it");const a=[...n.classList].find(e=>e.startsWith("message-index-")).split("-").pop(),o=(await MineTm.getCurrentChatIdbMetaAsync())?.idbe,i=[...n.querySelectorAll(cssForAttachmentIconWrapper)].indexOf(e);(e=>{const t=e.startsWith("data:text/plain;base64,")?atob(e.replace("data:text/plain;base64,","")):e,n=new Blob([t],{type:"text/plain"}),a=URL.createObjectURL(n);window.open(a,"_blank"),URL.revokeObjectURL(a)})(o.messages[Number(a)].content.filter(e=>"tm_text_file"===e.type||"tm_blob_file"===e.type)[i].metadata.base64)})};installAttachmentClickActionAsync();const installListAutoPreColonTitleSelectorAsync=async()=>{bindOnSelectorClick('[data-element-id="response-block"]',async(e,t)=>{const n=window.getSelection();if(!n.isCollapsed)return;const a=t.target.closest("li");if(!a)return;const o=t.target.closest("p, div");if(!o||!a.contains(o))return;const i=a.closest("ul, ol");if(!i)return;if(!Array.from(i.children).every(e=>e.textContent.includes(":")))return;const s=o.textContent,r=s.indexOf(":");if(-1===r)return;const c=t.clientX-o.getBoundingClientRect().left;if(Math.floor(c/(o.offsetWidth/s.length))<r){const e=document.createRange();e.setStart(o.firstChild,0),e.setEnd(o.firstChild,r),n.removeAllRanges(),n.addRange(e)}})};isMobile||installListAutoPreColonTitleSelectorAsync();const installLongSendBtnWithPluginsAsync=async()=>{const e=function(e,t=1e3,n){let a,o;return i=>{const s=i.target.closest(e);s&&(i.preventDefault(),i.stopPropagation(),"mousedown"===i.type||"touchstart"===i.type?(o=Date.now(),a=setTimeout(()=>n(s),t)):"mouseup"!==i.type&&"touchend"!==i.type||clearTimeout(a))}}('[data-element-id="send-button"]',500,async e=>{await MineTm.setPluginsStateAsync(!0),await Mine.waitFor(()=>!Mine.qs('[data-element-id="send-button"]'),{recheckIntervalMs:500}),await Mine.sleep(1e3),await MineTm.setPluginsStateAsync(!1)});document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),document.addEventListener("mouseup",e),document.addEventListener("touchend",e)};setTimeout(installLongSendBtnWithPluginsAsync,500);const installHomepageMenuAsync=async()=>{const e=MineTm.getCurrentChatId();if(e&&await MineTm.getChatIndexedDbValueAsync(e))return;const t=await Mine.waitForQs('[data-element-id="pinned-characters-container"]');if(!t)return;const n="mine-menuContainer";if(!Mine.qs(`#${n}`)&&t){const e=document.createElement("div");e.id=n,e.style="text-align: center; color: gray; margin-top: 10px; cursor: default;",e.innerHTML=`<div id="menu-status" style="font-size: 2em;font-family: Palatino;opacity:0;transition:all 0.3s;"><span style="filter:brightness(0%) invert(100%);opacity:0.5;">${MineTm.appNameShort}</span></div>`,t.appendChild(e),setTimeout(()=>Mine.qs("#menu-status").style.opacity=1,10),isMobile&&(async()=>{const t=document.createElement("button");t.innerHTML="Go Live",t.addEventListener("click",async()=>{t.disabled=!0,await Mine.waitFor(()=>MineTm.initGoLiveAsync),MineTm.initGoLiveAsync()}),e.appendChild(t)})(),(async()=>{const t=await MineTm.getMinePluginBasedSecretAsync("tmChatBufferPassword");if(!t)return;const n=await fetch("https://pepperpotts.fly.dev/tm/isChatBufferAvailable",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:t})});let a;try{a=await n.json()}catch(e){a={isSuccess:!1}}if(!n.ok)return void(a.message&&alert("[fail] "+a.message));if(!a.isSuccess)return alert(`[fail] cant get isChatBufferAvailable: ${a.message}`);if(!a.isChatBufferAvailable)return;const o=document.createElement("br");e.appendChild(o);const i=document.createElement("button");i.innerHTML="Download buffered chat",i.addEventListener("click",e=>{i.disabled=!0,i.style.fontStyle="italic",MineTm.downloadAndGoToBufferedChatAsync(e)}),i.style.transition="opacity 0.2s ease-in",i.style.opacity="0",e.appendChild(i),setTimeout(()=>i.style.opacity="1",10)})()}};installHomepageMenuAsync();const installSidebarChatsMetaEnricherAsync=async()=>{const e=await Mine.waitForQs('[data-element-id="sidebar-middle-part"]');if(!e)return;const t=async e=>{e=e.trim();const t="keyval";return new Promise((n,o)=>{const i=indexedDB.open("keyval-store");i.onerror=e=>o(`IndexedDB error: ${e.target.error}`),i.onsuccess=i=>{const s=i.target.result.transaction([t],"readonly").objectStore(t).openCursor();s.onerror=e=>o(`Cursor error: ${e.target.error}`),s.onsuccess=t=>{if(!a)return n(null);const o=t.target.result;if(!o)return n(null);{const{key:t,value:a}=o;if(t.startsWith("CHAT_")&&a.favoritedAt&&a?.chatTitle?.trim()===e){const e=a.messages.filter(e=>e.isPinned).length;return n({numDms:a.messages.length,numPinned:e})}o.continue()}}}})},n="data-mine-prefix";Mine.isi(Mine.normalizeSpaceIndents(`\n      [${n}]::before {\n        content: attr(${n});\n        display: inline-block;\n        white-space: pre;\n        color: slategray;\n      }\n      `));let a=!1;Mine.addEventListenerForSubtreeAddOrRemove(e,Mine.debounce(async()=>{a=!0;const e=Mine.qsaa('[data-element-id="custom-chat-item"] .truncate.font-normal,[data-element-id="selected-chat-item"] .truncate.font-normal');if(!e.length)return void(a=!1);let o=!1;for(const a of e){if(o){a?.removeAttribute(n);continue}const e=a.innerText.trim(),i=await t(e);if(!i){o=!0,a?.removeAttribute(n);continue}const{numDms:s,numPinned:r}=i;null==i||a?.setAttribute(n,`${s}d${r?`${r}p`:""} `)}},10))},installPluginExecutionDetailsPrettifier=async()=>{};setTimeout(installPluginExecutionDetailsPrettifier,1e3),window.location.hash&&!window.location.href.includes("&")&&setTimeout(async()=>{await Mine.waitFor(()=>document.title&&document.title!==MineTm.basicTypingMindDisplayNameAlias&&MineTm.getAllResponseBlocks().length,{recheckIntervalMs:500}).catch(()=>null)},isMobile?1e3:500);const installAutoInitialSubmitterAsync=async()=>{if(!new URLSearchParams(new URL(MineTm.pageLoadHref).search).get("message"))return;const e=await MineTm.getTaAsync();await Mine.waitFor(()=>!!e.value),await postProcessTaForSubmissionAsync(),await MineTm.getSendButtonAsync(),await MineTm.clickTaMaybeSubmitButtonWithPluginsEnabledEphemerallyAsync()};installAutoInitialSubmitterAsync();const installCodeCopyOnSpecialClickAsync=async()=>{document.addEventListener("click",async e=>{if(!e.metaKey||e.shiftKey)return;const t=e.target,n=async e=>{e.style.transition="all 200ms",e.style.setProperty("background-color","rgb(47,79,79,0.5)","important"),await Mine.sleep(200),e.style.background=""},a=t.closest(`.${MINE_TRIPLE_QUOTE_CONTENT_CLASSNAME}`);if(a)return await Mine.Extension.copyText(a.innerText),void await n(a);const o=t.closest("pre:has(code)");if(o){const e=t.closest("div:has(.sticky)").querySelector("button");if("Copy code"!==e.innerText.trim())return;return e.click(),void await n(o)}const i=t.closest("details");return i?(await Mine.Extension.copyText(i.innerText),void await n(i)):void 0})};installCodeCopyOnSpecialClickAsync();const installLastChatOpenerAsync=async()=>{"true"===Mine.getQueryParam("mineUseLastChat")&&MineTm.goToLastRecentChatAsync()};installLastChatOpenerAsync();const installBufferedChatOpenerAsync=async()=>{"true"===Mine.getQueryParam("mineDownloadAndGoToBufferedChat")&&await MineTm.downloadAndGoToBufferedChatAsync()};installBufferedChatOpenerAsync();const installChatAboutAsync=async()=>{const e=Mine.getQueryParam("mineAbout");e&&await MineTm.searchChatsAsync(e,{openFirstResult:!0,preferRedirect:!0})};installChatAboutAsync();const installSelectionSaver=async()=>{let e=null,t=null;document.addEventListener("selectionchange",()=>{const a=window.getSelection();if(!a.rangeCount)return;const o=a.getRangeAt(0).startContainer.parentElement.closest('[data-element-id="streaming-block"]');if(o)return e=a.toString(),void(t=o);e&&t&&(document.contains(t)||(setTimeout(n,250),t=null))});const n=()=>{if(!e?.trim())return;const t=Mine.qsaa('[data-element-id="ai-response"]').at(-1);if(!t)return;const n=[],a=document.createTreeWalker(t,NodeFilter.SHOW_TEXT);let o;for(;o=a.nextNode();)n.push(o);let i="";const s=n.map(e=>{const t={node:e,start:i.length,end:i.length+e.textContent.length};return i+=e.textContent,t}),r=i.indexOf(e);if(-1===r)return;const c=r+e.length,l=s.find(({start:e,end:t})=>r>=e&&r<=t),d=s.find(({start:e,end:t})=>c>=e&&c<=t);if(!l||!d)return;const m=document.createRange();m.setStart(l.node,r-l.start),m.setEnd(d.node,c-d.start);const p=window.getSelection();p.removeAllRanges(),p.addRange(m)}};installSelectionSaver();const animateStreamingResponseHeightAsync=async()=>{Mine.isi(Mine.normalizeSpaceIndents('\n      [data-element-id="response-block"] [data-element-id="ai-response"] {\n        transition: height 0.2s cubic-bezier(0.25, 0.8, 0.3, 1), all 0.2s ease !important;\n        overflow: hidden !important;\n      }\n      '));const e=new Set,t=new MutationObserver(()=>{const t=Mine.qs('[data-element-id="streaming-block"] [data-element-id="ai-response"]');if(!t||e.has(t))return;const n=t.closest('[data-element-id="streaming-block"]');if(!n)return;const a=t.scrollHeight;if(!a)return;t.style.height=`${a}px`;const o=new MutationObserver(()=>(e=>{const t=parseInt(e.style.height)||0,n=e.scrollHeight;t!==n&&requestAnimationFrame(()=>{e.style.height=n-10+"px",e.style.height=`${n}px`})})(t));o.observe(t,{childList:!0,characterData:!0,subtree:!0}),e.add(t);const i=new MutationObserver(n=>{for(const a of n)for(const n of a.removedNodes)if(n.matches('[data-element-id="streaming-block"]'))return o.disconnect(),i.disconnect(),void e.delete(t)});i.observe(n.parentElement,{childList:!0})});let n;Mine.attachToElementContinuously(async()=>await Mine.waitForQs('[data-element-id="chat-space-middle-part"]',{recheckIntervalMs:1e3,timeoutMs:6e5}),async e=>{t.observe(e,{childList:!0,subtree:!0});const a=(e=>{let t,a;n=new Date;let o=0;const i=i=>{new Date-n<3e3||(Math.abs(e.scrollTop-o)<1e3?t&&(t(),t=null):(t??=Mine.isi('\n          [data-element-id="user-message"] {\n            background: royalblue !important;\n          }\n        '),clearTimeout(a),a=setTimeout(()=>{t&&(t(),t=null,o=e.scrollTop)},150)))};return e.addEventListener("scroll",i,{passive:!0}),()=>{e.removeEventListener("scroll",i),t&&t(),a&&clearTimeout(a)}})(e);return()=>{a(),t.disconnect()}})};setTimeout(animateStreamingResponseHeightAsync,1e3);const setUpPepperAgentAsync=async()=>{const e=[];if(isMobile)e.push({title:"[onIPhoneActionButton]",description:"Simulate iPhone action button press",run:async()=>MineTm.liveMode.sttWidget?[MineTm.liveMode.SttModes.PHONE_CALL,MineTm.liveMode.SttModes.PUSH_TO_TALK].includes(MineTm.liveMode.sttWidget?.mode)?(MineTm.haltAnyCurrentActivityIdempotently(),await MineTm.liveMode.toggleMuteAsync({interruptSpeech:!0}),{success:!0,successMsg:"Now "+(MineTm.liveMode.isCallMuted?"muted":"unmuted")}):void 0:(MineTm.initGoLiveAsync({mode:MineTm.liveMode.SttModes.PUSH_TO_TALK}),{success:!0,successMsg:"Started Push-to-talk live mode."})});else{let t=!1;const n=async()=>{const e=await MineTm.getTaAsync();if(e.value)return Mine.toast("[noop] input is not clear");if(!t&&!document.hasFocus())return Mine.toast("[noop] requires document focus"),!1;const n=new KeyboardEvent(t?"keyup":"keydown",{key:"Tab",bubbles:!0,cancelable:!0});return e.dispatchEvent(n),t=!t,!0};e.push({title:"[onIPhoneActionButton]",description:"Simulate iPhone action button press",run:async()=>({success:await n()})})}e.push({title:"[MineDependencyUpdated]",run:async()=>(await MineTm.updateAllTmExtensions(),{success:!0})}),new Mine.PepperAgent("typingmind",e)};setUpPepperAgentAsync();const handleRegenerateHotkey=async e=>{if(e.metaKey&&e.altKey&&"KeyE"===e.code)return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),await MineTm.regenLastResponseAsync(),!1};document.addEventListener("keydown",handleRegenerateHotkey,!0);const installChromeFullscreenFixedPositionAsync=async()=>{let e=window.innerHeight;window.addEventListener("resize",()=>{const t=window.innerHeight,n=t-e;if(e=t,88!==Math.abs(n))return;const a=Mine.qs('[data-element-id="chat-space-middle-part"]');a?.scrollTo({top:a.scrollTop-n,behavior:"instant"})})};!MineTm.isMobile&&installChromeFullscreenFixedPositionAsync();const installMobileSimulatorDoubleTapZoomDisable=async()=>{const e=document.createElement("meta");e.name="viewport",e.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no",document.head.appendChild(e)};MineTm.isMobile&&installMobileSimulatorDoubleTapZoomDisable();const relevantHealthChecksAsync=async()=>{MineTm.getCurrentTargetChatModelFromUi().toLowerCase().includes("gemini")||await(async()=>{const e=await fetch("https://status.anthropic.com/"),t=await e.text();return!(new DOMParser).parseFromString(t,"text/html").querySelector(".unresolved-incidents")})()||Mine.toastWarning("Anthropic may be down")};MineTm.isMobile&&Mine.isi('[data-element-id="scroll-padding"] {min-height: 200px;}');const installAutoInfiniteScroll=()=>{let e;Mine.qs('[data-element-id="chat-space-middle-part"]').addEventListener("scroll",()=>{clearTimeout(e),e=setTimeout(()=>{const e=Mine.qs('button:has([d="M4.293 15.707a1 1 0 010-1.414l5-5a1 1 0 011.414 0l5 5a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414 0zm0-6a1 1 0 010-1.414l5-5a1 1 0 011.414 0l5 5a1 1 0 01-1.414 1.414L10 5.414 5.707 9.707a1 1 0 01-1.414 0z"])');if(!e)return;const t=e.getBoundingClientRect();t.top>=0&&t.left>=0&&t.bottom<=window.innerHeight&&t.right<=window.innerWidth&&e.click()},250)})};setTimeout(installAutoInfiniteScroll,3e3);const installNicerInputSection=async()=>{const e="opacity 0.15s ease-out, filter 0.15s ease-in !important";Mine.isi(Mine.normalizeSpaceIndents(`\n      [data-element-id="chat-space-middle-part"] + div {\n        position: fixed;\n        width: 100%;\n        bottom: 0;\n        transition: ${e};\n      }\n      [data-element-id="chat-space-end-part"] {\n        box-shadow: none;\n        background: transparent !important;\n      }\n    `)),await Mine.sleep(3e3),Mine.isi(Mine.normalizeSpaceIndents(`\n      body:not(.isScrolledToBottom) [data-element-id="chat-space-middle-part"] + div:not(:hover):not(:has(*:focus)) { \n        opacity: 0.4;\n        filter: blur(3px);\n        transition: opacity 0.5s ease-out, filter 0.5s ease-in !important;\n      }\n      [data-element-id="chat-space-middle-part"] + div:has(*:focus),\n      [data-element-id="chat-space-middle-part"] + div:has(#chat-input-textbox.recording)\n      {\n        opacity: 1 !important;\n        filter: none !important;\n        transition: ${e};\n      }\n    `));const t=Mine.qs('[data-element-id="chat-space-middle-part"]');let n;const a=()=>{document.body.classList.toggle("isScrolledToBottom",t.scrollHeight-t.scrollTop-t.clientHeight<300)};a(),t.addEventListener("scroll",Mine.throttleAndDebounce(()=>{MineTm.isBeingScrolled=!0,clearTimeout(n),n=setTimeout(()=>MineTm.isBeingScrolled=!1,150),a()}))};installNicerInputSection();const installIfAnyTasksInProgressAsync=async()=>{const e=sessionStorage[MineTm.sessionStorageMaybeActiveTaskId];if(e){const t=async e=>await MineTm.compressOlderMessages(e);MineTm.isMobile?t().then():(await Mine.sleep(4e3),Mine.CommandBar.executeFunctionAsStandaloneProcessAsync(`Finalizing ${e}`,async e=>await t(e)))}};installIfAnyTasksInProgressAsync();const installReadabilityFontAsync=async()=>{Mine.isi(Mine.normalizeSpaceIndents('\n      \n      @import url(\'https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible+Next:wght@300;400;500;600;700&display=swap\');\n      [data-element-id="response-block"], #chat-input-textbox {\n        font-family: "Atkinson Hyperlegible Next", ui-sans-serif, system-ui, sans-serif !important;\n        -webkit-font-smoothing: antialiased;\n        text-rendering: optimizeLegibility;\n      }\n    '))};installReadabilityFontAsync();const installNotifierWhenAwayFromTabAsync=async()=>{document.addEventListener("numMsgsInChatChanged",async e=>{if(!document.hidden)return;const t=e.detail.lastMessage;if(!t)return;if("user"===t.role)return;const n=MineTm.getIdbeMessageObjText(t);if(!n)return;const a=n.trim().toLowerCase(),o=/^yes\b/.test(a)?" (~yes)":/^no\b/.test(a)?" (~no)":"";await Mine.toastGlobalAsync(`🤖 DM from AI${o}`)})};installNotifierWhenAwayFromTabAsync();const wallpaperUrls=["https://img.freepik.com/premium-vector/floral-pattern-pretty-flowers-black-background-printing-with-small-white-flowers-ditsy-print_264287-265.jpg","https://png.pngtree.com/thumb_back/fh260/background/20231229/pngtree-abstract-black-cloth-background-with-gentle-waves-of-soft-fabric-texture-image_13920569.png","https://marketplace.canva.com/EAFwYA9k8s4/1/0/1600w/canva-galaxy-desktop-wallpaper-T0lY2vYriqQ.jpg","https://static.vecteezy.com/system/resources/thumbnails/006/422/202/small_2x/white-star-particle-motion-background-faded-wallpaper-animation-with-black-color-flying-bubble-free-video.jpg","https://www.toptal.com/designers/subtlepatterns/uploads/hotel-wallpaper-black.png"];(MineTm.getIsInPersonalEnvironment()||MineTm.isMobile)&&MineTm.setWallpaperAsync("https://i.ibb.co/21NZQX7B/seamless-pattern-leaves-hand-drawn-81310-675.jpg",{enableTransition:!1}),!MineTm.getIsInPersonalEnvironment()&&!MineTm.isMobile&&MineTm.setWallpaperAsync("https://i.ibb.co/RdvSztj/image.png",{enableTransition:!1}),window.addEventListener("beforeunload",async e=>{const t=Mine.qs('[data-element-id="main-content-area"]');t.style.setProperty("transition","opacity 0.1s ease-out","important"),t.style.setProperty("opacity","0","important")});const installPluginHinterAsync=()=>{const e="data-mine-fc-num-args-label";Mine.puic(({nypf:e})=>Mine.qsaa(`[data-element-id="additional-actions-of-response-container"]:has(.italic.truncate):${e}`),t=>{const n=t.querySelector(".italic.truncate");if(!n)return;let a;try{a=JSON.parse(n.innerText.trim())}catch(t){}a&&Array.isArray(a)&&n.setAttribute(e,"("+Mine.pluralize(a.length,"item")+")")}),Mine.isi(`[data-element-id="additional-actions-of-response-container"] .italic.truncate[${e}]::before{\n      content:attr(${e});\n      padding-right: 4px;\n    }`)};installPluginHinterAsync();const installThinkingPreviewerAsync=async()=>{Mine.isi('\n    [data-element-id="thinking-block"] summary::after {\n      content: attr(data-char-count);\n      font-size: 0.85em;\n      margin-left: 8px;\n    }\n    '),Mine.puic(({nypf:e})=>Mine.qsaa(`[data-element-id="thinking-block"]:${e}`),e=>(e=>{const t=e.querySelector("summary");if(!t)return;if(!t.textContent.toLowerCase().includes("thinking"))return;t.setAttribute("data-char-count"," (? words...)");let n=0,a=0,o=!1,i=!0;const s=()=>{if(o)if(n<a){const e=a-n,o=e>20?Math.ceil(e/10):1;n=Math.min(n+o,a);const r=i?"...":"",c=` (${Mine.pluralize(n,"word")}${r})`;t.setAttribute("data-char-count",c),setTimeout(s,30)}else o=!1},r=(t=!0)=>{const n=e.children[1];if(!n)return;i=t;const r=n.textContent.trim(),c=r?r.split(/\s+/).length:0;c!==a&&(a=c,o||(o=!0,s()))};r(!0);const c=setInterval(()=>{if(!t.textContent.toLowerCase().includes("thinking"))return i=!1,o=!1,r(!1),void clearInterval(c);r(!0)},100)})(e))};installThinkingPreviewerAsync()})();