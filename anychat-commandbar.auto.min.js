function getFormattedTime(e=new Date){const t=e.getHours(),a=e.getMinutes();return`${t%12||12}:${String(a).padStart(2,"0")}${t<12?"am":"pm"}`}const installMineIfNeededAsync=async()=>{if(window.Mine)return;const e=`https://raw.githubusercontent.com/imaverage/usp/main/Mine.auto.min.js?cb=${Date.now()}`,t=await fetch(e);if(!t.ok)throw new Error(`Failed to fetch Mine.js: ${t.status}`);const a=new Blob([await t.text()],{type:"application/javascript"}),n=URL.createObjectURL(a);return new Promise((e,t)=>{const a=document.createElement("script");a.src=n,a.onload=()=>{URL.revokeObjectURL(n),e()},a.onerror=e=>t(new Error("Failed to load dependency lib")),document.head.appendChild(a)})},installRemotePageApiBridge=async()=>{await Mine.waitFor(()=>window.AppGlobalApiForTools,{timeoutMs:6e4,retryecheckIntervalMs:200}),window.AppGlobalApiForTools.MineExtensionAskRemotePageApiAsync=async(e,t,a={})=>await Mine.Extension.askRemotePageApiAsync(e,t,a)},main=async()=>{await installMineIfNeededAsync(),installRemotePageApiBridge().then();const e=["USER PROFILE","INTERFACE"];Mine.CB.sgcfa(async()=>{const t="/",a="/c/",n="/"===window.location.pathname,i="ok i haven't read your previous response yet; i wanted to give you another opportunity to ultrathink really hard to give me the most impactful high efficacy response and then we'll start from there. if your previous response is already perfect, just repeat that verbatim. no need to acknowledge your previous response (previous response will automatically be deleted)";if(!window.MineCC)return[{title:getFormattedTime(),subtitle:"in non-chat page",isStatusBar:!0},{title:"Go to Home",hotkeySequence:"h",analytics:{manualTimeSavedMs:5e3},run:async()=>{window.location.pathname="/"}}];const[s,o]=await Promise.all([MineCC.getCurrentChatResolvedAsync(),MineCC.getAppContextAsync()]),r=s?.systemPrompt===o?.defaultSystemPrompt?"":(()=>{const e=s?.systemPrompt?.length??0,t=o?.defaultSystemPrompt?.length??0,a=0===t?e>0?100:0:(e-t)/t*100,n=Math.abs(a);return`ðŸ“œ sys.p. Î”(${a>=0?"+":"-"}${n>=1e3?`${Math.round(n/1e3)}k`:n.toLocaleString(void 0,{minimumFractionDigits:1,maximumFractionDigits:1})}%)`})(),c=s?.updatedAt?Mine.getHumanizedDurationMs(Date.now()-s.updatedAt,{ignoredUnits:["ms"]}):"",l=s?.messages?.map(e=>"user"===e.role&&Array.isArray(e.content)?e.content.filter(e=>!["text","thinking","tool_result"].includes(e.type)&&!e.superseded).map(t=>({message:e,contentRaw:t})):[]).flat()||[],u=l.length,d=s?.dynamicContextInstances?.length||0,m=(window.location.origin.includes("localhost"),s?.messages.filter(e=>e.starred).length),y=(()=>{const e=Mine.qs('[data-id="analytics-percentage"]');if(!e)return"";const t=parseFloat(e.innerText)||0,a=Math.round(t/25);return`${["ðŸŒ‘","ðŸŒ˜","ðŸŒ—","ðŸŒ–","ðŸŒ•"][Math.max(0,Math.min(4,a))]} ${t}% full`})(),p=(()=>{try{return window.self!==window.top}catch(e){return!0}})(),h=[{title:[getFormattedTime(),s?.messages.length?"ðŸ’¬ "+Mine.pluralize(s?.messages.length,"msg"):"",c?`ðŸ’¤ ${c}`:""].filter(Boolean).join(" â€¢ "),subtitle:["/"===window.location.pathname?`${Mine.pluralize(o.numChats,"chat")}`:"",s?`ðŸ§  ${s?.model}`:"",s?`ðŸ’¡ ${s?.modelParams?.reasoningEffort} effort`:"",y,s?r:"",s?.toolsAllEnabled?"ðŸ› ï¸ "+Mine.pluralize(s.enabledTools.length,"tool"):"",m?`ðŸ“Œ ${Mine.pluralize(m,"pin")}`:"",s?.userNotes?.trim()?"ðŸ“ notes":"",u?`ðŸ–‡ï¸ ${Mine.pluralize(u,"attmt")}`:"",d?`ðŸ”Œ ${Mine.pluralize(d,"dci")}`:""].filter(Boolean).join(" â€¢ "),isStatusBar:!0},...l.map((e,t)=>({site:a,title:`ðŸ“Ž Go to attachment: ${t+1}`,hotkeySequence:t===l.length-1?"a+l":0===t?"a+f":"",subtitle:"> "+e.contentRaw.filename,analytics:{manualTimeSavedMs:15e3},run:async()=>{Mine.qs(`[data-message-id="${e.message.id}"]`).scrollIntoView({behavior:"smooth"})}})),{site:t,title:"Toggle Fullscreen",hotkeySequence:"f",analytics:{manualTimeSavedMs:7e3},run:async()=>{Mine.qs('[aria-label="Toggle fullscreen"]').click()}},{site:a,title:"Toggle topics index",hotkeySequence:"i",analytics:{manualTimeSavedMs:7e3},run:async()=>{Mine.qs('[aria-label="Navigate topics"]').click()}},{site:a,title:"ðŸ“ Notes | toggle",hotkeySequence:"n",analytics:{manualTimeSavedMs:7e3},run:async()=>{const e=Mine.qs('[aria-label="Toggle notes"]'),t=e.classList.contains("bg-accent");e.click(),t||(await Mine.sleep(500),Mine.qs('[data-element-id="notebar-textarea"]').focus())}},{site:a,title:"ðŸ–‡ï¸ Attachments panel | toggle",hotkeySequence:"a",analytics:{manualTimeSavedMs:7e3},run:async()=>{Mine.qs('[aria-label="Toggle attachments"]').click()}},{site:a,title:"ðŸ“ Notes | next item | send",hotkeySequence:"n+n",analytics:{manualTimeSavedMs:7e3},run:async()=>{const e=Mine.qs('[data-element-id="notebar-textarea"]');if(!e||!e.value.trim())return;const t=e.value.trimStart().split(/\n\s*\n+/),a=t.shift(),n=t.join("\n\n").trimStart();a&&a.trim()&&(MineCC.sendMessageAsync(a.trim()).then(),Mine.updateReactTypableFormValue(e,n))}},{site:a,title:"ðŸ“ Notes | all | send",hotkeySequence:"n+a",analytics:{manualTimeSavedMs:7e3},run:async()=>{const e=Mine.qs('[data-element-id="notebar-textarea"]');e&&e.value.trim()&&(MineCC.sendMessageAsync(e.value.trim()).then(),Mine.updateReactTypableFormValue(e,""))}},{site:a,title:"Research exhaustively",hotkeySequence:"r+e",analytics:{manualTimeSavedMs:7e3},run:async()=>{await MineCC.sendMessageAsync("research exhaustively as needed to ascertain",{enablePlugins:!0})}},{site:a,title:"ðŸ§­ Summarize positioning",analytics:{manualTimeSavedMs:3e4},hotkeySequence:"p+o",subtitle:"Request current orientation and positioning",run:async(e={})=>{await MineCC.sendMessageAsync("TLDR: describe our current situation orientation and positioning. what happens if we effectively do nothing now",{append:!0})}},{site:a,title:"Copy last response",analytics:{manualTimeSavedMs:1e4},hotkeySequence:"c+r",run:async(e={})=>{Mine.qsaa('[aria-label="Copy AI response"]').pop().click()}},{site:a,title:"ðŸ“ Notes | append current draft text",subtitle:"Moves draft content to notebar",hotkeySequence:"n+a+p",analytics:{manualTimeSavedMs:7e3},run:async()=>{const e=Mine.qs("#chat-input-textbox"),t=Mine.qs('[data-element-id="notebar-textarea"]');Mine.updateReactTypableFormValue(t,t.value+"\n\n"+e.value),Mine.updateReactTypableFormValue(e,"")}},{site:t,title:"Dynamic context | inject context node",hotkeySequence:"d+c+i+n",analytics:{manualTimeSavedMs:5e4},run:async()=>{const e=await navigator.clipboard.readText(),t=e?.split("\n")[0]||"",a=prompt("Enter context node project name (ideally with ending ':')",t.trim()||"");if(!a?.trim())return;const n=await MineCC.addDynamicContextToCurrentChatAsync({toolId:await(async()=>await MineCC.getToolsDetailsAsync().then(e=>e.find(e=>"getProjectContextNotes"===e.name)?._appMetadata.id))(),requestSettings:{projectTitle:a,topLevelItemsToIgnoreCsv:"logs"},templateVariableName:(i=a,i.replace(/[^a-zA-Z0-9\s]/g," ").split(/\s+/).filter(Boolean).map((e,t)=>0===t?e.toLowerCase():e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(""))});var i;return n.error?Mine.toastError(n.error):n.isSuccess?void 0:Mine.toastError("couldn't inject item")}},...[!1,!0].map(e=>({title:"Inject links (pulled into attachments)"+(e?" and get Implications":""),hotkeySequence:"i+l"+(e?"+i":""),subtitle:"Uses clipboard as default input"+(e?"; asks for implications":""),analytics:{manualTimeSavedMs:e?4e4:2e4},run:async t=>{const a=e=>[...new Set(e.match(/https?:\/\/[^\s"']+/g)||[])];let n=a(await navigator.clipboard.readText()||"");if(n.length||(n=a(prompt("Enter text containing links (none found in clipboard):","")||"")),Mine.qs("textarea").focus(),!n.length)return Mine.toastError("No links found to process");let i=0;const s=n.length,o=()=>t?.setStatus(`Injecting link ${i+1}/${s}`);o(),await Promise.all(n.map(async e=>{try{const t=await MineCC.runToolAsync("getLinkedArtifactDetails",{url:e}),a=JSON.parse(t);await MineCC.addFileAttachmentAsync(JSON.stringify(a,null,2))}catch(t){console.warn(`Failed to process ${e}`,t)}finally{i++,o()}})),e&&MineCC.sendMessageAsync("any implications of these for us?",{enablePlugins:!0,append:!0}).then()}})),{site:t,title:"ðŸ¤™ðŸ» Go live",subtitle:"Use with headphones",hotkeySequence:"g+l",analytics:{manualTimeSavedMs:5e3},run:async(e={})=>{await Mine.waitFor(()=>!!MineTmStub.initGoLiveAsync),await MineTmStub.initGoLiveAsync({triggeredViaDirectUserInteraction:!0})}},{site:t,title:"Dynamic context | refresh all",hotkeySequence:"d+c+r",analytics:{manualTimeSavedMs:15e3},run:async()=>{await MineCC.currentChatDciRefreshAllActiveAsync()}},{site:a,title:"Compress session",hotkeySequence:"c+s",analytics:{manualTimeSavedMs:15e3},run:async()=>{const e=await MineCC.compressChatSessionAsync();if(!e||e.error||!e.isSuccess)return Mine.toastWarning(`[noop] ${e.error||"wasnt able to"}`)}},{site:a,title:"Compress | since last marker (preserve attachments)",hotkeySequence:"c+l+m",analytics:{manualTimeSavedMs:3e4},run:async()=>{await MineCC.getCurrentChatResolvedAsync().then(e=>{const t=e.messages.findLastIndex(e=>"marker"===e.type);if(t<0)throw"no marker found";const a=e.messages.find((e,a)=>a>t&&"user"===e.role);if(!a)throw"cant find target user message";const n=document.querySelector(`[data-message-id="${a.id}"] button[aria-label="Compress from here (preserve attachments)"]`);if(!n)throw"cant find target compress button";n.click()})}},{site:a,title:"ðŸ§¼ Fix/polish code",hotkeySequence:"f+c",analytics:{manualTimeSavedMs:1e4},run:async()=>{const e=Mine.normalizeSpaceIndents("\n            ```âš™ï¸ Fix/polish the code\n            * no console logs unless absolutely necessary (and dont leak anything sensitive)\n            * no unnecessary try catch\n            * no unnecessary parenthesis/brackets\n            * no unnecessary comments (but preserve mine). do not repeat implementation details in comments\n            * prefer fat arrow notation\n            * prefer clear explicit naming (with type suffix if in untyped environment)\n            * use semicolons and such\n            * 2-space indents\n            * favor early returns\n            * favor trailing commas\n            * readable variable names, favoring const (for JS)\n            * inline simple returns (for JS)\n            * DRY, modular code\n            * simplified\n            * keep all contextual instructions/comments about integrating the code OUTSIDE of the code block\n            * if I gave you code, then try to have minimal changes to what I provided\n            ```\n            ").trim();await MineCC.sendMessageAsync(e,{append:!0})}},{site:a,title:"ðŸ”‰ Speak response",subtitle:"Speak the last AI response as soon as its ready",hotkeySequence:"s+r",analytics:{manualTimeSavedMs:15e3},run:async e=>{e?.setStatus("waiting for AI response"),await Mine.waitFor(()=>!Mine.qs('[aria-label="Stop generating"]'),{timeoutMs:3e5}),e?.setStatus(),Mine.qsaa('[aria-label="Speak response"]').pop().click()}},...["Settings","Tools","Home"].map(e=>({site:t,title:`Go to: ${e}`,hotkeySequence:`g+${e.toLowerCase()[0]}`,analytics:{manualTimeSavedMs:7e3},run:async t=>{"home"===e.toLowerCase()?window.location.pathname="/":Mine.qsaa("button").find(t=>t.innerText.trim()===e).click()}})),...Object.entries({"Claude Opus":{id:"[latest]claude-opus",hotkeySequence:"m+c+o"},"Claude Sonnet":{id:"[latest]claude-sonnet",hotkeySequence:"m+c+s"},"Claude Haiku":{id:"[latest]claude-haiku",hotkeySequence:"m+c+h"},"Gemini Pro":{id:"[latest]gemini-pro",hotkeySequence:"m+g+p"},"Gemini Pro (legacy)":{id:"Gemini 3 Pro Preview",hotkeySequence:"m+g+p+l"},"Gemini Flash":{id:"[latest]gemini-flash",hotkeySequence:"m+g+f"},"Gemini Image":{id:"[latest]gemini-pro-image",hotkeySequence:"m+g+i"},"xAI Grok":{id:"[latest]grok",hotkeySequence:"m+x+g"}}).flatMap(([e,n])=>[{site:t,title:`ðŸ§  Switch to model: ${e}`,hotkeySequence:n.hotkeySequence,subtitle:n.id,analytics:{manualTimeSavedMs:1e4},run:async()=>{await MineCC.switchToModelAsync(n.id),Mine.qs("textarea").focus()}},{site:a,title:`ðŸ§  Switch to model: ${e} and Regenerate`,hotkeySequence:`${n.hotkeySequence}+r`,subtitle:n.id,analytics:{manualTimeSavedMs:15e3},run:async()=>{await MineCC.switchToModelAsync(n.id),Mine.qs("textarea").focus(),MineCC.regenerateLastResponseAsync().then()}}]),{site:a,title:"Rename chat title | automatically",hotkeySequence:"r",analytics:{manualTimeSavedMs:1e4},run:async()=>{Mine.qs('[aria-label="Auto-generate title"]').click()}},{site:a,title:"Optimize response",subtitle:"Have it optimize for value",hotkeySequence:"o+r",analytics:{manualTimeSavedMs:1e4},run:async()=>{await MineCC.sendMessageAsync(i)}},...[Mine.qsaa("button").find(e=>"Recover Chat"===e.innerText)].filter(Boolean).map(e=>({title:"Undelete chat",hotkeySequence:"z",analytics:{manualTimeSavedMs:5e3},run:async()=>e.click()})),{site:a,title:"ðŸ´ Fork chat",analytics:{manualTimeSavedMs:1e4},run:async()=>{Mine.qsaa('[aria-label="Fork from here"]').pop().click()}},{site:a,title:"Open links in last response",analytics:{manualTimeSavedMs:1e4},hotkeySequence:"o+l",run:async()=>{const e=Mine.qsaa("[data-message-id]").pop();if(!e)return;const t=Mine.deduplicate([...e.querySelectorAll("a")].map(e=>e.href));for(const e of t)await Mine.Extension.openTab({url:e})}},{site:a,title:"ðŸ“Œ Go to pinned | first",analytics:{manualTimeSavedMs:1e4},hotkeySequence:"p+f",run:async()=>{Mine.qsaa(".starred-message")[0]?.scrollIntoView({behavior:"smooth"})}},{site:a,title:"ðŸ“Œ Go to pinned | last",subtitle:m?`${Mine.pluralize(m,"pin")}`:"No pinned messages.",analytics:{manualTimeSavedMs:1e4},hotkeySequence:"p+l",run:async()=>{Mine.qsaa(".starred-message").pop()?.scrollIntoView({behavior:"smooth"})}},{site:t,title:"New chat",hotkeySequence:"n+c",analytics:{manualTimeSavedMs:1e4},run:async()=>{Mine.qsaa("button").find(e=>"New Chat"===e.innerText).click()}},{site:a,title:"Reset context here",subtitle:"Clear context before last user exchange",hotkeySequence:"r+c+h",analytics:{manualTimeSavedMs:1e4},run:async()=>{Mine.qsaa('[data-message-role="user"]').pop().querySelector('[aria-label="Clear context before"]').click()}},{site:t,title:"ðŸ—‘ï¸ Destructive exit",subtitle:n?"Closes tab":"Deletes this chat and closes the tab",hotkeySequence:"x",analytics:{manualTimeSavedMs:1e4},run:async()=>{if(n)return void Mine.Extension.closeTab();const e=await MineCC.getCurrentChatResolvedAsync();if(!e)throw"current chat not found";const t=e.messages.filter(e=>e.starred).length;t&&!confirm(`You have ${Mine.pluralize(t,"pin")}. Are you sure you still want to delete this chat?`)||(await MineCC.deleteCurrentChatAsync(),Mine.Extension.closeTab())}},{site:t,title:"Edit System Prompt",hotkeySequence:"s+p",analytics:{manualTimeSavedMs:5e3},run:async()=>{Mine.qs('[aria-label="Chat settings"]').click()}},...["d+l","d"].map(e=>({site:a,title:"âž– Delete last exchange",hotkeySequence:e,analytics:{manualTimeSavedMs:15e3},run:async()=>{await MineCC.deleteLastExchangeAsync(),Mine.qs("#chat-input-textbox").focus()}})),...[!1,!0].map(n=>({site:n?a:t,title:"System prompt | â¬› Redact personal info"+(n?" and Regenerate":""),subtitle:`sections: ${e.join(", ")}`,hotkeySequence:"s+p+r"+(n?"+r":""),analytics:{manualTimeSavedMs:15e3},run:async()=>{await(async()=>{const t=()=>"/"===window.location.pathname;if(t()&&(await MineCC.activateANewChatAsync(),await Mine.waitFor(()=>!t()),await Mine.sleep(500)),!await MineCC.redactSystemPromptSectionAsync(e[0]))return Mine.toastWarning("couldnt redact USER PROFILE");await MineCC.redactSystemPromptSectionAsync(e[1]),Mine.qs("textarea").focus()})(),n&&MineCC.regenerateLastResponseAsync().then()}})),...[!1,!0].map(e=>({site:e?a:t,title:"System prompt | â¬œ Clear"+(e?" and Regenerate":""),hotkeySequence:"s+p+c"+(e?"+r":""),analytics:{manualTimeSavedMs:7e3},run:async()=>{await MineCC.clearSystemPromptAsync(),Mine.qs("textarea").focus(),e&&MineCC.regenerateLastResponseAsync().then()}})),{site:a,title:"Workflow | absorb nutrients",hotkeySequence:"a+n",analytics:{manualTimeSavedMs:12e4},run:async e=>{await MineCC.sendMessageAsync("lets absorb its nutrients. think really hard on this",{append:!0}),await(e?.getShouldInterruptAsync())||await MineCC.sendMessageAsync(i,{append:!0})}},{site:t,title:"ðŸ‘¾ Play GoodOldTetris",hotkeySequence:"p+g",analytics:{manualTimeSavedMs:7e3},run:async()=>{window.open("https://www.goodoldtetris.com/")}},{site:t,title:"ðŸ‘¾ Play Impossible Task Game",hotkeySequence:"p+i+g",analytics:{manualTimeSavedMs:6e4},run:async()=>{const e=Mine.normalizeSpaceIndents("\n            ```ðŸ‘¾ Impossible Task Game Instructions\n            1. Host sets an achievable goal with clear success criteria and deadline (like \"Get icecream by midnight\"). It should be simple, but can be challenging\n            2. Player proposes a solution (like \"walk to the ice cream store next door and get some\")\n            3. Host introduces new obstacles that nullify the previous solution, providing logical reasoning that's entertaining, engaging, and potentially pragmatically educational (like the store being closed because the FDA discovered that their ice cream's unique blue color comes from copper sulfate contamination - a common issue in older dairy facilities where copper pipes, originally chosen for their superior heat conductivity in pasteurization, get corroded by milk's natural acidity). Each obstacle should:\n              - Be engaging and plausible\n              - Be creative and novel (avoid reusing or extending previous obstacles)\n              - Teach something interesting with practical value when possible (industry facts, scientific principles, historical events)\n            4. Player adapts with new solution\n            5. Repeat steps 3-4 until either:\n              - Player succeeds through clever thinking\n              - Player or host relents\n\n            Keep in mind\n            - Original task/goal never changes. Do not pick the example scenario. Topics should not be nerdy or very technical.\n            - Each obstacle must be logically connected and somewhat plausible\n            - No recycling previous obstacle types\n            - Host must maintain plausible path to success\n\n            Other notes\n            - Use markdown, emojis, or formatting to keep responses visually engaging\n            - Add `---` separators between major scene changes or sections\n            - Bold key developments as they occur\n\n            Best played with time pressure and escalating complexity.\n            ```\n\n            Let's play! You can be the host\n            ").trim();await MineCC.sendMessageAsync(e,{append:!0})}},{site:a,title:"Scroll to last message",hotkeySequence:"l",analytics:{manualTimeSavedMs:1e4},run:async()=>{Mine.qsaa('[data-message-role="user"]').pop().scrollIntoView({behavior:"smooth"})}},{site:a,title:"Scroll to top",hotkeySequence:"t",analytics:{manualTimeSavedMs:1e4},run:async()=>{Mine.qs("[data-message-role]").scrollIntoView({behavior:"smooth"})}},{site:t,title:"Choose a model",hotkeySequence:"m",analytics:{manualTimeSavedMs:1e4},run:async()=>{Mine.qs('.chat-toolbar-container [data-element-id="model-selector-trigger"]').click()}},{site:t,title:"Export everything",hotkeySequence:"e+e",analytics:{manualTimeSavedMs:3e4},run:async()=>{await MineCC.exportEverythingAsync()}},{site:a,title:"â›³ Marker | add",hotkeySequence:"m+a",analytics:{manualTimeSavedMs:1e4},run:async()=>{await MineCC.addMarkerAsync()}},{site:a,title:"â›³ Marker | add as...",hotkeySequence:"m+a+s",analytics:{manualTimeSavedMs:1e4},run:async()=>{const e=prompt("Set Marker title as...");e?.trim()&&await MineCC.addMarkerAsync(e)}},{site:a,title:"â›³ Marker | last",hotkeySequence:"m+l",analytics:{manualTimeSavedMs:2e4},run:async()=>{const e=Mine.qsaa(".marker-divider").pop();e&&(e.scrollIntoView({behavior:"smooth"}),await Mine.sleep(750))}},{site:a,title:"â›³ Add marker as...",hotkeySequence:"a+m+a",analytics:{manualTimeSavedMs:1e4},run:async()=>{const e=prompt("Marker title");e?.trim()&&await MineCC.addMarkerAsync(e)}},{site:t,title:"â˜ï¸ Sync | upload",hotkeySequence:"s+u",analytics:{manualTimeSavedMs:15e3},run:async()=>{await MineCC.appSyncUploadAsync()}},{site:a,title:"Display last Thought details",hotkeySequence:"d+d",analytics:{manualTimeSavedMs:5e3},run:async()=>{Mine.qsaa("details.thinking-details summary").pop().click()}},{site:a,title:"ðŸ—ï¸ Keys | ðŸ”„ cycle magazine",subtitle:`using ${(o.currentChat?.apiKeyIndexCurrent||0)+1}/${o.currentChat?.apiKeysSize} for active AI provider`,hotkeySequence:"k+c",analytics:{manualTimeSavedMs:3e4},run:async()=>{await MineCC.cycleCurrentChatApiKeysAsync({suppressToasts:!1})}},{site:a,title:"ðŸ“Œ Pin/unpin this message",hotkeySequence:"p",analytics:{manualTimeSavedMs:1e4},run:async()=>{const e=function(){const e=window.getSelection();if(e&&e.rangeCount>0&&!e.isCollapsed){let t=e.getRangeAt(0).commonAncestorContainer;for(;t&&t!==document.body;){if(1===t.nodeType&&t.hasAttribute("data-message-id"))return t;t=t.parentNode}}const t=document.querySelectorAll("[data-message-id]:hover");return t.length?t[t.length-1]:null}();e&&Mine.qs('[aria-label*="tar message"]',e).click()}},{title:"Pipe to text",isForUnhandledCommand:!0,run:async e=>{const t=e.userQuery,a=Mine.qs("textarea");Mine.updateReactTypableFormValue(a,t);const n=new KeyboardEvent("keydown",{key:"Enter",code:"Enter",keyCode:13,bubbles:!0,cancelable:!0}),i=new KeyboardEvent("keyup",{key:"Enter",code:"Enter",keyCode:13,bubbles:!0,cancelable:!0});a.dispatchEvent(n),a.dispatchEvent(i)}}];return p&&(h.push({site:t,title:"Reload this iframed chat",analytics:{manualTimeSavedMs:7e3},run:async()=>{window.location.reload()}}),h.push({site:t,title:"Open this iframed chat in new tab",analytics:{manualTimeSavedMs:7e3},run:async()=>{window.open(window.location.href)}})),h}),await Mine.waitFor(()=>window.MineCC,{timeoutMs:1e4});const t=await MineCC.getUserDefinedDataAsync(),a="personal"===t?.Environment?.Profile?.name||"personal"===Mine?.Environment?.Profile?.name,n=/iphone|ipod/i.test(navigator.userAgent);if(a&&!n){(()=>{const e=new BroadcastChannel("cora_audio_mutex");let t=null;const a=()=>{if(!t){e.postMessage("claim_throne");try{t=new(window.AudioContext||window.webkitAudioContext);const e=t.createOscillator(),a=t.createGain();a.gain.value=1e-4,e.connect(a),a.connect(t.destination),e.start(),console.log("ðŸ”ˆ Claimed audio dominance")}catch(e){console.error("Audio dominance failed",e)}}};e.onmessage=e=>{"claim_throne"===e.data&&t&&(console.log("ðŸ”‡ Yielding audio dominance"),t.close().catch(()=>{}),t=null)},a(),window.addEventListener("focus",a),window.addEventListener("click",a)})();const e=navigator.platform.toLowerCase().includes("mac")?"mac":navigator.platform.toLowerCase().includes("linux")?"linux":navigator.platform.toLowerCase().includes("win")?"windows":"unknown";new Mine.PepperAgent(`cora.chat-os-${e}`,[{title:"Get current chat id",description:"Get current chat id",run:async()=>{let e;return e="/"===window.location.pathname?"[new tab]":(await MineCC.getCurrentChatResolvedAsync()).id,{success:!0,successMsg:e}}},{title:"Get current chat title",description:"Get current chat title",run:async()=>{let e;return e="/"===window.location.pathname?"":(await MineCC.getCurrentChatResolvedAsync()).title,{success:!0,successMsg:e}}},{title:"Find chats",description:"Find chats",run:async({query:e=""}={})=>({success:!0,data:await MineCC.searchChatsAsync(e),successMsg:""})},{title:"Get is chat busy",description:"Get is chat busy",run:async()=>({success:!0,data:await MineCC.getIsChatProcessingStateAsync(),successMsg:""})},{title:"Restart app",description:"Restart app",run:async()=>(setTimeout(()=>window.location.reload(),1e3),{success:!0,data:null,successMsg:"will do in 1s"})},{title:"Activate a new chat",description:"Activate a new chat",run:async({}={})=>{const{chatId:e}=await MineCC.activateANewChatAsync({autoCompressionStrategy:"slowly"});return{success:!0,data:{chatId:e},successMsg:""}}},{title:"Send message",description:"Send message",run:async({chatId:e,query:t,attachments:a=[],source:n,ephemeral:i=!1,returnTtsData:s=!1,returnMeta:o=!1,enablePrimer:r=!1,primerAdditionalInstructions:c=null,optimizeAttachments:l=!0}={})=>{if(!e||!n||!a.length&&!t)return{success:!1,errorMsg:"missing arguments"};const u={returnAiResponse:!0,enablePlugins:!0,chatId:e,source:n,attachments:a,ephemeral:i,returnTtsData:s,returnMeta:o,enablePrimer:r,primerAdditionalInstructions:c,optimizeAttachments:l};let d=null;const m=await MineCC.sendMessageAsync(t,u).catch(e=>(d=e.toString(),null));return{success:!d,data:m,errorMsg:d,successMsg:""}}}],{authApiKey:t?.pagentSocketAuthApiKey})}};main().then();